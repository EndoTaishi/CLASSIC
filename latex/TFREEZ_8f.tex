\hypertarget{TFREEZ_8f}{}\section{T\+F\+R\+E\+E\+Z.\+f File Reference}
\label{TFREEZ_8f}\index{T\+F\+R\+E\+E\+Z.\+f@{T\+F\+R\+E\+E\+Z.\+f}}


Purpose\+: Address freezing of water ponded on ground surface.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{TFREEZ_8f_a4bbb5275f553d198b8e0d750e75d3c3d}{tfreez} (Z\+P\+O\+N\+D, T\+P\+O\+N\+D, Z\+S\+N\+O\+W, T\+S\+N\+O\+W, A\+L\+B\+S\+N\+O, R\+H\+O\+S\+N\+O, H\+C\+P\+S\+N\+O, G\+Z\+E\+R\+O, H\+M\+F\+G, H\+T\+C\+S, H\+T\+C, W\+T\+R\+S, W\+T\+R\+G, F\+I, Q\+F\+R\+E\+Z, W\+S\+N\+O\+W, T\+A, T\+B\+A\+R, I\+S\+A\+N\+D, I\+G, I\+L\+G, I\+L1, I\+L2, J\+L)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Purpose\+: Address freezing of water ponded on ground surface. 



\subsection{Function/\+Subroutine Documentation}
\hypertarget{TFREEZ_8f_a4bbb5275f553d198b8e0d750e75d3c3d}{}\index{T\+F\+R\+E\+E\+Z.\+f@{T\+F\+R\+E\+E\+Z.\+f}!tfreez@{tfreez}}
\index{tfreez@{tfreez}!T\+F\+R\+E\+E\+Z.\+f@{T\+F\+R\+E\+E\+Z.\+f}}
\subsubsection[{tfreez}]{\setlength{\rightskip}{0pt plus 5cm}subroutine tfreez (
\begin{DoxyParamCaption}
\item[{real, dimension (ilg)}]{Z\+P\+O\+N\+D, }
\item[{real, dimension (ilg)}]{T\+P\+O\+N\+D, }
\item[{real, dimension (ilg)}]{Z\+S\+N\+O\+W, }
\item[{real, dimension (ilg)}]{T\+S\+N\+O\+W, }
\item[{real, dimension(ilg)}]{A\+L\+B\+S\+N\+O, }
\item[{real, dimension(ilg)}]{R\+H\+O\+S\+N\+O, }
\item[{real, dimension(ilg)}]{H\+C\+P\+S\+N\+O, }
\item[{real, dimension (ilg)}]{G\+Z\+E\+R\+O, }
\item[{real, dimension  (ilg,ig)}]{H\+M\+F\+G, }
\item[{real, dimension  (ilg)}]{H\+T\+C\+S, }
\item[{real, dimension   (ilg,ig)}]{H\+T\+C, }
\item[{real, dimension  (ilg)}]{W\+T\+R\+S, }
\item[{real, dimension  (ilg)}]{W\+T\+R\+G, }
\item[{real, dimension    (ilg)}]{F\+I, }
\item[{real, dimension (ilg)}]{Q\+F\+R\+E\+Z, }
\item[{real, dimension (ilg)}]{W\+S\+N\+O\+W, }
\item[{real, dimension    (ilg)}]{T\+A, }
\item[{real, dimension  (ilg,ig)}]{T\+B\+A\+R, }
\item[{integer, dimension (ilg,ig)}]{I\+S\+A\+N\+D, }
\item[{integer}]{I\+G, }
\item[{integer}]{I\+L\+G, }
\item[{integer}]{I\+L1, }
\item[{integer}]{I\+L2, }
\item[{integer}]{J\+L}
\end{DoxyParamCaption}
)}\label{TFREEZ_8f_a4bbb5275f553d198b8e0d750e75d3c3d}

\begin{DoxyParams}{Parameters}
{\em zpond} & Depth of ponded water $[m] (z_p)$\\
\hline
{\em tpond} & Temperature of ponded water $[C] (T_p)$\\
\hline
{\em zsnow} & Depth of snow pack $[m] (z_g)$\\
\hline
{\em tsnow} & Temperature of the snow pack $[C] (T_s)$\\
\hline
{\em albsno} & Albedo of snow \mbox{[} \mbox{]}\\
\hline
{\em rhosno} & Density of snow pack $[kg m^{-3}] (\rho_s)$\\
\hline
{\em hcpsno} & Heat capacity of snow pack $[J m^{-3} K^{-1}] (C_s)$\\
\hline
{\em gzero} & Heat flow into soil surface $[W m^{-2}]$\\
\hline
{\em htcs} & Internal energy change of snow pack due to conduction and/or change in mass $[W m^{-2}]$ (Is)\\
\hline
{\em wtrs} & Water transferred into or out of the snow pack $[kg m^{-2} s^{-1}]$\\
\hline
{\em wtrg} & Water transferred into or out of the soil $[kg m^{-2} s^{-1}]$\\
\hline
{\em hmfg} & Energy associated with phase change of water in soil layers $[W m^{-2}]$\\
\hline
{\em htc} & Internal energy change of soil layer due to conduction and/or change in mass $[W m^{-2}]$ (Ig)\\
\hline
{\em fi} & Fractional coverage of subarea in question on modelled area $[ ] (X_i)$\\
\hline
{\em qfrez} & Energy sink for freezing of water at the ground surface $[W m^{-2}]$\\
\hline
{\em wsnow} & Liquid water content of snow pack $[kg m^{-2}] (w_s)$\\
\hline
{\em ta} & Air temperature \mbox{[}K\mbox{]}\\
\hline
{\em tbar} & Temperature of soil layer $[C] (T_g)$\\
\hline
{\em isand} & Sand content flag \\
\hline
\end{DoxyParams}
Freezing of water ponded on the ground surface occurs if an energy sink Q\+F\+R\+E\+Z is produced as a result of the solution of the surface energy balance, or if the pond temperature at the beginning of the subroutine has been projected to be below 0 C. The change of internal energy I in the snow and first soil layer (which for the purposes of diagnostic calculations includes the ponded water) as a result of these processes is calculated as the difference in I between the beginning and end of the subroutine\+:

$\Delta I_s = X_i \Delta(C_s T_s z_s) / \Delta t$ $\Delta I_g = X_i \Delta(C_w T_p z_p)/\Delta t$

where the C terms represent volumetric heat capacities, the T terms temperatures, and the z terms depths of the snow pack and the ponded water respectively, $\Delta t$ is the length of the time step, and $X_i$ the fractional coverage of the subarea under consideration relative to the modelled area.

The energy sink H\+A\+D\+D to be applied to the ponded water is calculated from Q\+F\+R\+E\+Z and the pond temperature T\+P\+O\+N\+D (if it is below 0 C). Two diagnostic variables, H\+C\+O\+O\+L and H\+C\+O\+N\+V, are calculated as the energy sink required to cool the ponded water to 0 C, and that required both to cool and to freeze the ponded water, respectively. If H\+A\+D\+D $\leq$ H\+C\+O\+O\+L, the available energy sink is only sufficient to decrease the temperature of the ponded water. This decrease is applied, and the energy used is added to the internal energy H\+T\+C of the first soil layer.

If H\+A\+D\+D $>$ H\+C\+O\+O\+L but H\+A\+D\+D $\leq$ H\+C\+O\+N\+V, the available energy sink is sufficient to decrease the ponded water temperature to 0 C and to freeze part of it. The energy used in freezing is calculated as H\+A\+D\+D – H\+C\+O\+O\+L, and is used to calculate the depth of frozen water Z\+F\+R\+E\+Z, which is then subtracted from the ponded water depth Z\+P\+O\+N\+D. H\+C\+O\+O\+L is added to H\+T\+C, and Z\+F\+R\+E\+Z is converted from a depth of water to a depth of ice and added to the snow pack. If there is not a pre-\/existing snow pack, the snow albedo is set to the background value for old snow, 0.\+50. The temperature, density and heat capacity of the snow pack are recalculated.

If H\+A\+D\+D $>$ H\+C\+O\+N\+V, the available energy sink is sufficient to cool and freeze the whole depth of ponded water, and also to decrease the temperature of the ice thus formed. The ponded water depth is converted to a depth of ice Z\+F\+R\+E\+Z, and H\+C\+O\+O\+L is added to H\+T\+C. In order to avoid unphysical temperature decreases caused by the length of the time step and the small ponding depth, a limit is set on the allowable decrease. The theoretical temperature of the newly formed ice, T\+T\+E\+S\+T, is calculated from H\+A\+D\+D – H\+C\+O\+N\+V. If there is a pre-\/existing snow pack, the limiting temperature T\+L\+I\+M is set to the minimum of the snow pack temperature T\+S\+N\+O\+W, the first soil layer temperature, and 0 C; otherwise it is set to the minimum of the air temperature, the first soil layer temperature and 0 C. If T\+T\+E\+S\+T $<$ T\+L\+I\+M, the new ice is assigned T\+L\+I\+M as its temperature in the recalculation of T\+S\+N\+O\+W, the excess heat sink H\+E\+X\+C\+E\+S is calculated from H\+A\+D\+D and T\+L\+I\+M and assigned to the ground heat flux G\+Z\+E\+R\+O, and H\+A\+D\+D – H\+E\+X\+C\+E\+S is used to update H\+T\+C. Otherwise the new ice is assigned T\+T\+E\+S\+T as its temperature in the recalculation of T\+S\+N\+O\+W, and H\+A\+D\+D is used to update H\+T\+C. If there is not a pre-\/existing snow pack, the snow albedo is set to the background value. The density, depth and heat capacity of the snow pack are recalculated, and the pond depth and temperature are set to zero.

At the end of the subroutine, the internal energy calculations are completed, and Z\+F\+R\+E\+Z is used to update the diagnostic variable H\+M\+F\+G describing the energy associated with phase changes of water in soil layers, and also the diagnostic variables W\+T\+R\+S and W\+T\+R\+G describing transfers of water into or out of the snow and soil respectively. Finally, the initial step in the calculation of the internal energy change for the ponded water over the following subroutines G\+R\+I\+N\+F\+L and G\+R\+D\+R\+A\+N is performed (the calculation is completed in subroutine T\+M\+C\+A\+L\+C).