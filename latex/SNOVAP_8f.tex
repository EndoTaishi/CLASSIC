\hypertarget{SNOVAP_8f}{}\section{S\+N\+O\+V\+A\+P.\+f File Reference}
\label{SNOVAP_8f}\index{S\+N\+O\+V\+A\+P.\+f@{S\+N\+O\+V\+A\+P.\+f}}


Purpose\+: Sublimation calculations for the snow pack on the ground.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{SNOVAP_8f_a64f8b35d4ad3e8ced53867425e4500d3}{snovap} (R\+H\+O\+S\+N\+O, Z\+S\+N\+O\+W, H\+C\+P\+S\+N\+O, T\+S\+N\+O\+W, E\+V\+A\+P, Q\+F\+N, Q\+F\+G, H\+T\+C\+S, W\+L\+O\+S\+T, T\+R\+U\+N\+O\+F, R\+U\+N\+O\+F\+F, T\+O\+V\+R\+F\+L, O\+V\+R\+F\+L\+W, F\+I, R, S, R\+H\+O\+S\+N\+I, W\+S\+N\+O\+W, I\+L\+G, I\+L1, I\+L2, J\+L)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Purpose\+: Sublimation calculations for the snow pack on the ground. 



\subsection{Function/\+Subroutine Documentation}
\hypertarget{SNOVAP_8f_a64f8b35d4ad3e8ced53867425e4500d3}{}\index{S\+N\+O\+V\+A\+P.\+f@{S\+N\+O\+V\+A\+P.\+f}!snovap@{snovap}}
\index{snovap@{snovap}!S\+N\+O\+V\+A\+P.\+f@{S\+N\+O\+V\+A\+P.\+f}}
\subsubsection[{snovap}]{\setlength{\rightskip}{0pt plus 5cm}subroutine snovap (
\begin{DoxyParamCaption}
\item[{real, dimension(ilg)}]{R\+H\+O\+S\+N\+O, }
\item[{real, dimension (ilg)}]{Z\+S\+N\+O\+W, }
\item[{real, dimension(ilg)}]{H\+C\+P\+S\+N\+O, }
\item[{real, dimension (ilg)}]{T\+S\+N\+O\+W, }
\item[{real, dimension  (ilg)}]{E\+V\+A\+P, }
\item[{real, dimension   (ilg)}]{Q\+F\+N, }
\item[{real, dimension   (ilg)}]{Q\+F\+G, }
\item[{real, dimension  (ilg)}]{H\+T\+C\+S, }
\item[{real, dimension (ilg)}]{W\+L\+O\+S\+T, }
\item[{real, dimension(ilg)}]{T\+R\+U\+N\+O\+F, }
\item[{real, dimension(ilg)}]{R\+U\+N\+O\+F\+F, }
\item[{real, dimension(ilg)}]{T\+O\+V\+R\+F\+L, }
\item[{real, dimension(ilg)}]{O\+V\+R\+F\+L\+W, }
\item[{real, dimension    (ilg)}]{F\+I, }
\item[{real, dimension     (ilg)}]{R, }
\item[{real, dimension     (ilg)}]{S, }
\item[{real, dimension(ilg)}]{R\+H\+O\+S\+N\+I, }
\item[{real, dimension (ilg)}]{W\+S\+N\+O\+W, }
\item[{integer}]{I\+L\+G, }
\item[{integer}]{I\+L1, }
\item[{integer}]{I\+L2, }
\item[{integer}]{J\+L}
\end{DoxyParamCaption}
)}\label{SNOVAP_8f_a64f8b35d4ad3e8ced53867425e4500d3}

\begin{DoxyParams}{Parameters}
{\em rhosno} & Density of snow pack $[kg m^{-3}] (\rho_s)$\\
\hline
{\em zsnow} & Depth of snow pack $[m] (z_g)$\\
\hline
{\em hcpsno} & Heat capacity of snow pack $[J m^{-3} K^{-1}] (C_s)$\\
\hline
{\em tsnow} & Temperature of the snow pack $[C] (T_s)$\\
\hline
{\em evap} & Sublimation rate from snow surface at start of subroutine $[m s^{-1}]$\\
\hline
{\em qfn} & Sublimation from snow pack $[kg m^{-2} s^{-1}]$\\
\hline
{\em qfg} & Evaporation from ground $[kg m^{-2} s^{-1}]$\\
\hline
{\em htcs} & Internal energy change of snow pack due to conduction and/or change in mass $[W m^{-2}] (I_s)$\\
\hline
{\em wlost} & Residual amount of water that cannot be supplied by surface stores $[kg m^{-2}]$\\
\hline
{\em trunof} & Temperature of total runoff \mbox{[}K\mbox{]}\\
\hline
{\em runoff} & Total runoff $[m s^{-1}]$\\
\hline
{\em tovrfl} & Temperature of overland flow \mbox{[}K\mbox{]}\\
\hline
{\em ovrflw} & Overland flow from top of soil column $[m s^{-1}]$\\
\hline
{\em fi} & Fractional coverage of subarea in question on modelled area $[ ] (X_i)$\\
\hline
{\em r} & Rainfall rate incident on snow pack $[m s^{-1}]$\\
\hline
{\em s} & Snowfall rate incident on snow pack $[kg m^{-2} s^{-1}]$\\
\hline
{\em rhosni} & Density of fresh snow $[kg m^{-3}]$\\
\hline
{\em wsnow} & Liquid water content of snow pack $[kg m^{-2}] (w_s)$ \\
\hline
\end{DoxyParams}
These calculations are done if a snowpack is present and there is no rainfall or snowfall occurring. The change of internal energy $I_s$ of the snow pack as a result of the change in its mass is calculated as the difference in $I_s$ between the beginning and end of the subroutine\+:

$\Delta I_s = X_i \Delta [ C_s z_s T_s ] / \Delta t$

where $C_s$ represents the volumetric heat capacity of the snow pack, $T_s$ its temperature, $\Delta t$ the length of the time step, and $X_i$ the fractional coverage of the subarea under consideration relative to the modelled area.

If the sublimation rate E\+V\+A\+P over the snow pack is negative (downward), the deposited depth of snow Z\+A\+D\+D is calculated from E\+V\+A\+P by converting it from a liquid water flux to a fresh snow depth using R\+H\+O\+S\+N\+I, the fresh snow density. The snowpack density is updated as a weighted average of the original snow density R\+H\+O\+S\+N\+O and R\+H\+O\+S\+N\+I. The new snow depth is calculated as the sum of the old snow depth Z\+S\+N\+O\+W and Z\+A\+D\+D. The new volumetric heat capacity of the snow pack is obtained from the heat capacities of ice and water $C_i$ and $C_w$, the snow, ice and water densities $\rho_s$ $\rho_i$, and $\rho_w$, and the water content and depth of the snow pack $w_s$ and $z_s$, as\+:

$C_s = C_i [\rho_s / \rho_i ] + C_w w_s /[\rho_w z_s]$

If the sublimation rate is positive, the depth of the snow pack Z\+L\+O\+S\+T that is sublimated over the time step is calculated from E\+V\+A\+P using R\+H\+O\+S\+N\+O. If Z\+L\+O\+S\+T $\leq$ Z\+S\+N\+O\+W, the snow depth is reduced and H\+C\+P\+S\+N\+O is recalculated. Otherwise the deficit amount Z\+R\+E\+M is calculated from Z\+L\+O\+S\+T â€“ Z\+S\+N\+O\+W and converted to a depth of water. This amount is further converted to an evaporation rate by applying a correction factor of $(L_m+ L_v)/L_v$, where $L_m$ is the latent heat of melting and $L_v$ is the latent heat of vaporization (to account for the fact that the energy is now being used to evaporate water instead of sublimate snow). This necessarily leads to a small discrepancy between the overall vapour flux for the subarea that was originally calculated in C\+L\+A\+S\+S\+T, and the actual change of water storage in the subarea, and therefore this discrepancy is added to the housekeeping variable W\+L\+O\+S\+T for use in the water balance checks done later in C\+H\+K\+W\+A\+T. If there was liquid water in the snow pack, W\+S\+N\+O\+W, it is assigned to overall runoff R\+U\+N\+O\+F\+F, and to overland flow O\+V\+R\+F\+L\+W. The resulting temperatures of the runoff and overland flow, T\+R\+U\+N\+O\+F and T\+O\+V\+R\+F\+L, are recalculated as weighted averages using the original runoff amounts and temperatures, and the original snow temperature T\+S\+N\+O\+W for W\+S\+N\+O\+W. The snow depth, heat capacity, temperature and water content are all set to zero. Finally, since Z\+R\+E\+M now becomes soil evaporation rather than snow sublimation, the diagnostic variables Q\+F\+N and Q\+F\+G, representing the vapour flux from snow and soil respectively, are adjusted to reflect this.