\hypertarget{SNINFL_8f}{}\section{S\+N\+I\+N\+F\+L.\+f File Reference}
\label{SNINFL_8f}\index{S\+N\+I\+N\+F\+L.\+f@{S\+N\+I\+N\+F\+L.\+f}}


Purpose\+: Address infiltration of rain and meltwater into snow pack, and snow ripening.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{SNINFL_8f_a40705488cafaec0ed712b2b926c1d67d}{sninfl} (R, T\+R, Z\+S\+N\+O\+W, T\+S\+N\+O\+W, R\+H\+O\+S\+N\+O, H\+C\+P\+S\+N\+O, W\+S\+N\+O\+W, H\+T\+C\+S, H\+M\+F\+N, P\+C\+P\+G, R\+O\+F\+N, F\+I, I\+L\+G, I\+L1, I\+L2, J\+L)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Purpose\+: Address infiltration of rain and meltwater into snow pack, and snow ripening. 



\subsection{Function/\+Subroutine Documentation}
\hypertarget{SNINFL_8f_a40705488cafaec0ed712b2b926c1d67d}{}\index{S\+N\+I\+N\+F\+L.\+f@{S\+N\+I\+N\+F\+L.\+f}!sninfl@{sninfl}}
\index{sninfl@{sninfl}!S\+N\+I\+N\+F\+L.\+f@{S\+N\+I\+N\+F\+L.\+f}}
\subsubsection[{sninfl}]{\setlength{\rightskip}{0pt plus 5cm}subroutine sninfl (
\begin{DoxyParamCaption}
\item[{real, dimension     (ilg)}]{R, }
\item[{real, dimension    (ilg)}]{T\+R, }
\item[{real, dimension (ilg)}]{Z\+S\+N\+O\+W, }
\item[{real, dimension (ilg)}]{T\+S\+N\+O\+W, }
\item[{real, dimension(ilg)}]{R\+H\+O\+S\+N\+O, }
\item[{real, dimension(ilg)}]{H\+C\+P\+S\+N\+O, }
\item[{real, dimension (ilg)}]{W\+S\+N\+O\+W, }
\item[{real, dimension  (ilg)}]{H\+T\+C\+S, }
\item[{real, dimension  (ilg)}]{H\+M\+F\+N, }
\item[{real, dimension  (ilg)}]{P\+C\+P\+G, }
\item[{real, dimension  (ilg)}]{R\+O\+F\+N, }
\item[{real, dimension    (ilg)}]{F\+I, }
\item[{integer}]{I\+L\+G, }
\item[{integer}]{I\+L1, }
\item[{integer}]{I\+L2, }
\item[{integer}]{J\+L}
\end{DoxyParamCaption}
)}\label{SNINFL_8f_a40705488cafaec0ed712b2b926c1d67d}

\begin{DoxyParams}{Parameters}
{\em r} & Rainfall rate incident on snow pack $[m s^{-1}]$\\
\hline
{\em tr} & Temperature of rainfall \mbox{[}C\mbox{]}\\
\hline
{\em zsnow} & Depth of snow pack $[m] (z_g)$\\
\hline
{\em tsnow} & Temperature of the snow pack $[C] (T_s)$\\
\hline
{\em rhosno} & Density of snow pack $[kg m^{-3}] (\rho_s )$\\
\hline
{\em hcpsno} & Heat capacity of snow pack $[J m^{-3} K^{-1}] (C_s)$\\
\hline
{\em wsnow} & Liquid water content of snow pack $[kg m^{-2}] (w_s)$\\
\hline
{\em htcs} & Internal energy change of snow pack due to conduction and/or change in mass $[W m^{-2}] (I_s)$\\
\hline
{\em hmfn} & Energy associated with freezing or thawing of water in the snow pack $[W m^{-2}]$\\
\hline
{\em pcpg} & Precipitation incident on ground $[kg m^{-2} s^{-1}]$\\
\hline
{\em rofn} & Runoff reaching the ground surface from the bottom of the snow pack $[kg m^{-2} s^{-1}]$\\
\hline
{\em fi} & Fractional coverage of subarea in question on modelled area $[ ] (X_i)$ \\
\hline
\end{DoxyParams}
The rainfall rate, i.\+e. the liquid water precipitation rate incident on the snow pack from the atmosphere, from canopy drip and/or from melting of the top of the snow pack, may cause warming and/or melting of the snow pack as a whole. The overall change of internal energy of the snow pack as a result of the rainfall added to it, $I_s$ or H\+T\+C\+S, is calculated as the difference in Is between the beginning and end of the subroutine\+:

$\Delta I_s = X_i \Delta [C_s z_s T_s]/Delta t$

where $C_s$ represents the volumetric heat capacity of the snow pack, $T_s$ its temperature, $\Delta$ the length of the time step, and $X_i$ the fractional coverage of the subarea under consideration relative to the modelled area.

Four diagnostic variables are evaluated at the outset. H\+R\+C\+O\+O\+L, the energy sink required to cool the whole rainfall amount to 0 C, is calculated from the rainfall rate and temperature, and the heat capacity of water. H\+R\+F\+R\+E\+Z, the energy sink required to freeze all the rainfall, is obtained from the latent heat of melting, the density of water and the rainfall rate. H\+S\+N\+W\+R\+M, the energy required to warm the whole snow pack to 0 C, is calculated from the temperature, heat capacity and depth of the snow pack. H\+S\+N\+M\+L\+T, the energy required to melt all the snow, is obtained from the latent heat of melting and the heat capacity and depth of the snow pack.

If H\+R\+C\+O\+O\+L $\geq$ (H\+S\+N\+W\+R\+M + H\+S\+N\+M\+L\+T), the energy contributed by the temperature of the rainfall is sufficient to warm to 0 C and melt the whole snow pack. H\+R\+C\+O\+O\+L is recalculated as the difference between H\+R\+C\+O\+O\+L and (H\+S\+N\+W\+R\+M + H\+S\+N\+M\+L\+T), and the snow depth is converted to a water depth Z\+M\+E\+L\+T. The energy used to melt the snow is added to the diagnostic variables H\+M\+F\+N, representing the energy associated with water phase changes in the snow pack, and H\+T\+C\+S. The new temperature of the rainfall is calculated by applying H\+R\+C\+O\+O\+L over the new rainfall rate reaching the soil, which now includes the original rainfall rate, the melted snow pack and the liquid water that was contained in the snow pack. The depth, temperature, density, heat capacity and liquid water content of the snow pack are set to zero.

If H\+R\+C\+O\+O\+L $\geq$ H\+S\+N\+W\+R\+M but H\+R\+C\+O\+O\+L $<$ (H\+S\+N\+W\+R\+M + H\+S\+N\+M\+L\+T), the energy contributed by the temperature of the rainfall is sufficient to warm the whole snowpack to 0 C but not to melt all of it. H\+S\+N\+M\+L\+T is therefore recalculated as H\+R\+C\+O\+O\+L -\/ H\+S\+N\+W\+R\+M, and used to determine a melted depth of the snowpack Z\+M\+E\+L\+T, which is subtracted from the snow depth Z\+S\+N\+O\+W. The energy used to melt this depth of snow is added to H\+M\+F\+N and H\+T\+C\+S. The total water now available for retention in the snowpack, W\+A\+V\+A\+I\+L, is obtained as the sum of the mass of melted water and the mass of water originally retained in the snow pack, W\+S\+N\+O\+W. This amount is compared to the water retention capacity of the snow pack, calculated from the maximum retention percentage by weight, W\+S\+N\+C\+A\+P (currently set to 4\%). If W\+A\+V\+A\+I\+L is greater than the water retention capacity, W\+S\+N\+O\+W is set to the capacity value and the excess is reassigned to Z\+M\+E\+L\+T. Otherwise W\+S\+N\+O\+W is set to W\+A\+V\+A\+I\+L and Z\+M\+E\+L\+T is set to zero. The temperature of the snow and the temperature T\+R of the rainfall reaching the ground surface are each set to 0 C, H\+C\+P\+S\+N\+O is recalculated, and Z\+M\+E\+L\+T is added to the rainfall rate R.

If H\+S\+N\+W\+R\+M $\geq$ (H\+R\+C\+O\+O\+L + H\+R\+F\+R\+E\+Z), the energy sink of the snow pack is sufficient to cool to 0 C and freeze all of the rainfall. H\+S\+N\+W\+R\+M is recalculated as the difference between H\+S\+N\+W\+R\+M and (H\+R\+C\+O\+O\+L + H\+R\+F\+R\+E\+Z). The energy used in the freezing, H\+R\+F\+R\+E\+Z, is added to H\+M\+F\+N and H\+T\+C\+S. The rainfall is applied to increasing the density of the snow pack R\+H\+O\+S\+N\+O; if the new density is greater than the density of ice, R\+H\+O\+S\+N\+O is reset to the ice density and Z\+S\+N\+O\+W is recalculated. H\+C\+P\+S\+N\+O is also recalculated, and the new snow temperature is obtained from H\+S\+N\+W\+R\+M, H\+C\+P\+S\+N\+O and Z\+S\+N\+O\+W. R and T\+R are set to zero.

If H\+S\+N\+W\+R\+M $>$ H\+R\+C\+O\+O\+L and H\+S\+N\+W\+R\+M $<$ (H\+R\+C\+O\+O\+L + H\+R\+F\+R\+E\+Z), the energy sink of the snow pack is sufficient to cool the rainfall to 0 C, but not to freeze all of it. H\+R\+F\+R\+E\+Z is therefore recalculated as H\+S\+N\+W\+R\+M â€“ H\+R\+C\+O\+O\+L, and used to determine a depth of rain to be frozen, Z\+F\+R\+E\+Z. The energy used in the freezing is added to H\+M\+F\+N and H\+T\+C\+S. The frozen rainfall is applied to increasing the density of the snow pack as above; if the calculated density exceeds that of ice, R\+H\+O\+S\+N\+O and Z\+S\+N\+O\+W are recalculated. The water available for retention in the snow pack, W\+A\+V\+A\+I\+L, is obtained as the sum of the unfrozen rainfall and W\+S\+N\+O\+W, and compared to the water retention capacity of the snow pack. If W\+A\+V\+A\+I\+L is greater than the water retention capacity, W\+S\+N\+O\+W is set to the capacity value and W\+A\+V\+A\+I\+L is recalculated. Otherwise W\+S\+N\+O\+W is set to W\+A\+V\+A\+I\+L and W\+A\+V\+A\+I\+L is set to zero. The heat capacity of the snow is recalculated, R is calculated from W\+A\+V\+A\+I\+L, and T\+R and T\+S\+N\+O\+W are set to zero.

Finally, the calculation of the change in internal energy is completed, and the rainfall rate leaving the bottom of the snow pack and reaching the soil is added to the diagnostic variables P\+C\+P\+G and R\+O\+F\+N.