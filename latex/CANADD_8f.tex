\hypertarget{CANADD_8f}{}\section{C\+A\+N\+A\+D\+D.\+f File Reference}
\label{CANADD_8f}\index{C\+A\+N\+A\+D\+D.\+f@{C\+A\+N\+A\+D\+D.\+f}}


Purpose\+: Calculate canopy interception of rainfall and snowfall, and determine rainfall/snowfall rates at ground surface as a result of throughfall and unloading.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{CANADD_8f_ae4481b561c2022da57ec7a4dacf6a9df}{canadd} (I\+W\+A\+T\+E\+R, R, T\+R, S, T\+S, R\+A\+I\+C\+A\+N, S\+N\+O\+C\+A\+N, T\+C\+A\+N, C\+H\+C\+A\+P, H\+T\+C\+C, R\+O\+F\+C, R\+O\+V\+G, P\+C\+P\+N, P\+C\+P\+G, F\+I, F\+S\+V\+F, C\+W\+L\+C\+A\+P, C\+W\+F\+C\+A\+P, C\+M\+A\+S\+S, R\+H\+O\+S\+N\+I, T\+S\+U\+R\+X, R\+D\+R\+I\+P, S\+D\+R\+I\+P, I\+L\+G, I\+L1, I\+L2, J\+L)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Purpose\+: Calculate canopy interception of rainfall and snowfall, and determine rainfall/snowfall rates at ground surface as a result of throughfall and unloading. 



\subsection{Function/\+Subroutine Documentation}
\hypertarget{CANADD_8f_ae4481b561c2022da57ec7a4dacf6a9df}{}\index{C\+A\+N\+A\+D\+D.\+f@{C\+A\+N\+A\+D\+D.\+f}!canadd@{canadd}}
\index{canadd@{canadd}!C\+A\+N\+A\+D\+D.\+f@{C\+A\+N\+A\+D\+D.\+f}}
\subsubsection[{canadd}]{\setlength{\rightskip}{0pt plus 5cm}subroutine canadd (
\begin{DoxyParamCaption}
\item[{integer}]{I\+W\+A\+T\+E\+R, }
\item[{real, dimension     (ilg)}]{R, }
\item[{real, dimension    (ilg)}]{T\+R, }
\item[{real, dimension     (ilg)}]{S, }
\item[{real, dimension    (ilg)}]{T\+S, }
\item[{real, dimension(ilg)}]{R\+A\+I\+C\+A\+N, }
\item[{real, dimension(ilg)}]{S\+N\+O\+C\+A\+N, }
\item[{real, dimension  (ilg)}]{T\+C\+A\+N, }
\item[{real, dimension (ilg)}]{C\+H\+C\+A\+P, }
\item[{real, dimension  (ilg)}]{H\+T\+C\+C, }
\item[{real, dimension  (ilg)}]{R\+O\+F\+C, }
\item[{real, dimension  (ilg)}]{R\+O\+V\+G, }
\item[{real, dimension  (ilg)}]{P\+C\+P\+N, }
\item[{real, dimension  (ilg)}]{P\+C\+P\+G, }
\item[{real, dimension    (ilg)}]{F\+I, }
\item[{real, dimension  (ilg)}]{F\+S\+V\+F, }
\item[{real, dimension(ilg)}]{C\+W\+L\+C\+A\+P, }
\item[{real, dimension(ilg)}]{C\+W\+F\+C\+A\+P, }
\item[{real, dimension (ilg)}]{C\+M\+A\+S\+S, }
\item[{real, dimension(ilg)}]{R\+H\+O\+S\+N\+I, }
\item[{real, dimension (ilg)}]{T\+S\+U\+R\+X, }
\item[{real, dimension (ilg)}]{R\+D\+R\+I\+P, }
\item[{real, dimension (ilg)}]{S\+D\+R\+I\+P, }
\item[{integer}]{I\+L\+G, }
\item[{integer}]{I\+L1, }
\item[{integer}]{I\+L2, }
\item[{integer}]{J\+L}
\end{DoxyParamCaption}
)}\label{CANADD_8f_ae4481b561c2022da57ec7a4dacf6a9df}

\begin{DoxyParams}{Parameters}
{\em r} & Rainfall rate over subarea in question $[m s^{-1}]$\\
\hline
{\em tr} & Temperature of rainfall \mbox{[}C\mbox{]}\\
\hline
{\em s} & Snowfall rate over subarea in question $[m s^{-1}]$\\
\hline
{\em ts} & Temperature of snowfall \mbox{[}C\mbox{]}\\
\hline
{\em raican} & Intercepted liquid water stored on the canopy $[kg m^{-2}] (W_{l,c})$\\
\hline
{\em snocan} & Intercepted frozen water stored on the canopy $[kg m^{-2}] (W_{f,c})$\\
\hline
{\em tcan} & Temperature of vegetation canopy $[K] (T_c)$\\
\hline
{\em chcap} & Heat capacity of vegetation canopy $[J m^{-2} K^{-1}] (C_c)$\\
\hline
{\em htcc} & Internal energy change of canopy due to changes in temperature and/or mass $[W m^{-2}] (I_c)$\\
\hline
{\em rofc} & Liquid/frozen water runoff from vegetation $[kg m^{-2} s^{-1}]$\\
\hline
{\em rovg} & Liquid/frozen water runoff from vegetation to ground surface $[kg m^{-2} s^{-1}]$\\
\hline
{\em pcpn} & Precipitation incident on snow pack $[kg m^{-2} s^{-1}]$\\
\hline
{\em pcpg} & Precipitation incident on ground $[kg m^{-2} s^{-1}]$\\
\hline
{\em fi} & Fractional coverage of subarea in question on modelled area $[ ] (X_i)$\\
\hline
{\em fsvf} & Sky view factor of surface under vegetation canopy \mbox{[} \mbox{]}\\
\hline
{\em cwlcap} & Interception storage capacity of vegetation for liquid water $[kg m^{-2}]$\\
\hline
{\em cwfcap} & Interception storage capacity of vegetation for frozen water $[kg m^{-2}] (W_{f,max})$\\
\hline
{\em cmass} & Mass of vegetation canopy $[kg m^{-2}]$\\
\hline
{\em rhosni} & Density of fresh snow $[kg m^{-3}]$\\
\hline
{\em tsurx} & Ground or snow surface temperature of subarea \mbox{[}K\mbox{]} \\
\hline
\end{DoxyParams}
The calculations in this subroutine are performed if the rainfall or snowfall rates over the modelled area are greater than zero, or if the intercepted liquid water R\+A\+I\+C\+A\+N or frozen water S\+N\+O\+C\+A\+N is greater than zero (to allow for unloading). The throughfall of rainfall or snowfall incident on the canopy, R\+T\+H\+R\+U or S\+T\+H\+R\+U, is calculated from F\+S\+V\+F, the canopy gap fraction or sky view factor. The remaining rainfall or snowfall is assigned to interception, as R\+I\+N\+T and S\+I\+N\+T. The resulting temperature of liquid water on the canopy, T\+R\+C\+A\+N, is calculated as a weighted average of R\+A\+I\+C\+A\+N at the canopy temperature T\+C\+A\+N, and R\+I\+N\+T at the rainfall temperature T\+R. The resulting temperature of frozen water on the canopy, T\+S\+C\+A\+N, is calculated as a weighted average of S\+N\+O\+C\+A\+N at the canopy temperature T\+C\+A\+N, and S\+I\+N\+T at the snowfall temperature T\+S.

Calculations are now done to ascertain whether the total liquid water on the canopy exceeds the liquid water interception capacity C\+W\+L\+C\+A\+P. If such is the case, this excess is assigned to R\+D\+R\+I\+P, water dripping off the canopy. The rainfall rate reaching the surface under the canopy is calculated as R\+D\+R\+I\+P + R\+T\+H\+R\+U, and the temperature of this water flux is calculated as a weighted average of R\+D\+R\+I\+P at a temperature of T\+R\+C\+A\+N, and R\+T\+H\+R\+U at the original rainfall temperature T\+R. The remaining intercepted water becomes C\+W\+L\+C\+A\+P. Otherwise, the rainfall rate reaching the surface under the canopy is set to R\+T\+H\+R\+U, and the liquid water on the canopy R\+A\+I\+C\+A\+N is augmented by R\+I\+N\+T.

Interception and unloading of snow on the canopy is calculated using a more complex method. The amount of snow intercepted during a snowfall event over a time step, $\Delta W_{f,i}$ , or S\+L\+O\+A\+D, is obtained from the initial intercepted snow amount $W_{f,c}$ and the interception capacity $W_{f,max}$ , following Hedstrom and Pomeroy (1998), as\+:

$\Delta W_{f,i} = (W_{f,max} – W_{f,c} ) [1 – exp(-S_{int} /W_{f,max} )]$

where $S_{int}$ is the amount of snow incident on the canopy during the time step. The amount of snow not stored by interception, S\+W\+X\+C\+E\+S, is calculated as S\+I\+N\+T – S\+L\+O\+A\+D. Between and during precipitation events, snow is unloaded from the canopy through wind gusts and snow densification. These effects of these processes are estimated using an empirical exponential relationship for the snow unloading rate $W_{f,u}$ or S\+N\+U\+N\+L\+D, again following Hedstrom and Pomeroy (1998)\+:

$W_{f,u} = {W_{f,c} + \Delta W_{f,i} } exp (-U \Delta t)$

where U is a snow unloading coefficient, assigned a value of $0.1 d^{-1}$ or $1.157 * 10^{-6} s{-1}$. The sum of S\+W\+X\+C\+E\+S and S\+N\+U\+N\+L\+D is assigned to S\+D\+R\+I\+P, the snow or frozen water falling off the canopy. The snowfall rate reaching the surface under the canopy is calculated as S\+D\+R\+I\+P + S\+T\+H\+R\+U, and the temperature of this water flux is calculated as a weighted average of S\+D\+R\+I\+P at a temperature of T\+S\+C\+A\+N, and S\+T\+H\+R\+U at the original snowfall temperature T\+S. The frozen water stored on the canopy is recalculated as S\+N\+O\+C\+A\+N + S\+I\+N\+T – S\+W\+X\+C\+E\+S -\/ S\+N\+U\+N\+L\+D. Otherwise, the snowfall rate reaching the surface under the canopy is set to S\+T\+H\+R\+U, and S\+N\+O\+C\+A\+N is augmented by S\+I\+N\+T.

In the final section of the subroutine, the initial heat capacity and temperature of the canopy are saved in temporary variables. The new canopy heat capacity is calculated as a weighted average over the specific heats of the liquid and frozen water stored on the canopy and the canopy mass. The canopy temperature is calculated as a weighted average over the stored liquid and frozen water at the updated temperatures T\+R\+C\+A\+N and T\+S\+C\+A\+N, and the vegetation mass at the original temperature T\+C\+A\+N. Then the change in internal energy $I_c$ of the vegetation canopy as a result of the water movement above is calculated as the difference in $I_c$ before and after these processes\+: \[ \Delta I_c = X_i \Delta [C_c T_c ] / \Delta t \] where $C_c$ represents the canopy heat capacity, $T_c$ the canopy temperature, $\Delta t$ the length of the time step, and $X_i$ the fractional coverage of the subarea under consideration relative to the modelled area.

Finally, the rainfall and snowfall temperatures are converted to degrees C. (In the absence of precipitation, both are set equal to the surface temperature of the subarea to avoid floating point errors in later subroutines.) For subareas with a snow cover (I\+W\+A\+T\+E\+R = 2), the water running off the canopy and the precipitation incident on the snow pack are updated using R\+D\+R\+I\+P and S\+D\+R\+I\+P. For subareas without snow cover (I\+W\+A\+T\+E\+R = 1), the water running off the canopy is updated using R\+D\+R\+I\+P and S\+D\+R\+I\+P, the precipitation incident on the snow pack is augmented by S\+D\+R\+I\+P, and the precipitation incident on bare ground is augmented by R\+D\+R\+I\+P.

Here is the caller graph for this function\+:
% FIG 0


