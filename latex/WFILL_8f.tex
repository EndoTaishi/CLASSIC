\hypertarget{WFILL_8f}{}\section{W\+F\+I\+L\+L.\+f File Reference}
\label{WFILL_8f}\index{W\+F\+I\+L\+L.\+f@{W\+F\+I\+L\+L.\+f}}


Purpose\+: Evaluate infiltration of water into soil under unsaturated conditions.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{WFILL_8f_a1162b1442a4411742ce29b99d59d72cc}{wfill} (W\+M\+O\+V\+E, T\+M\+O\+V\+E, L\+Z\+F, N\+I\+N\+F, Z\+F, T\+R\+M\+D\+R, R, T\+R, P\+S\+I\+F, G\+R\+K\+I\+N\+F, T\+H\+L\+I\+N\+F, T\+H\+L\+I\+Q\+X, T\+B\+A\+R\+W\+X, D\+E\+L\+Z\+X, Z\+B\+O\+T\+X, D\+Z\+F, T\+I\+M\+P\+N\+D, W\+A\+D\+J, W\+A\+D\+D, I\+F\+I\+L\+L, I\+F\+I\+N\+D, I\+G, I\+G\+P1, I\+G\+P2, I\+L\+G, I\+L1, I\+L2, J\+L, N)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Purpose\+: Evaluate infiltration of water into soil under unsaturated conditions. 



\subsection{Function/\+Subroutine Documentation}
\hypertarget{WFILL_8f_a1162b1442a4411742ce29b99d59d72cc}{}\index{W\+F\+I\+L\+L.\+f@{W\+F\+I\+L\+L.\+f}!wfill@{wfill}}
\index{wfill@{wfill}!W\+F\+I\+L\+L.\+f@{W\+F\+I\+L\+L.\+f}}
\subsubsection[{wfill}]{\setlength{\rightskip}{0pt plus 5cm}subroutine wfill (
\begin{DoxyParamCaption}
\item[{real, dimension (ilg,igp2)}]{W\+M\+O\+V\+E, }
\item[{real, dimension (ilg,igp2)}]{T\+M\+O\+V\+E, }
\item[{integer, dimension   (ilg)}]{L\+Z\+F, }
\item[{integer, dimension  (ilg)}]{N\+I\+N\+F, }
\item[{real, dimension    (ilg)}]{Z\+F, }
\item[{real, dimension (ilg)}]{T\+R\+M\+D\+R, }
\item[{real, dimension     (ilg)}]{R, }
\item[{real, dimension    (ilg)}]{T\+R, }
\item[{real, dimension  (ilg,igp1)}]{P\+S\+I\+F, }
\item[{real, dimension(ilg,igp1)}]{G\+R\+K\+I\+N\+F, }
\item[{real, dimension(ilg,igp1)}]{T\+H\+L\+I\+N\+F, }
\item[{real, dimension(ilg,igp1)}]{T\+H\+L\+I\+Q\+X, }
\item[{real, dimension(ilg,igp1)}]{T\+B\+A\+R\+W\+X, }
\item[{real, dimension (ilg,igp1)}]{D\+E\+L\+Z\+X, }
\item[{real, dimension (ilg,igp1)}]{Z\+B\+O\+T\+X, }
\item[{real, dimension   (ilg)}]{D\+Z\+F, }
\item[{real, dimension (ilg)}]{T\+I\+M\+P\+N\+D, }
\item[{real, dimension  (ilg)}]{W\+A\+D\+J, }
\item[{real, dimension  (ilg)}]{W\+A\+D\+D, }
\item[{integer, dimension (ilg)}]{I\+F\+I\+L\+L, }
\item[{integer, dimension (ilg)}]{I\+F\+I\+N\+D, }
\item[{integer}]{I\+G, }
\item[{integer}]{I\+G\+P1, }
\item[{integer}]{I\+G\+P2, }
\item[{integer}]{I\+L\+G, }
\item[{integer}]{I\+L1, }
\item[{integer}]{I\+L2, }
\item[{integer}]{J\+L, }
\item[{integer}]{N}
\end{DoxyParamCaption}
)}\label{WFILL_8f_a1162b1442a4411742ce29b99d59d72cc}

\begin{DoxyParams}{Parameters}
{\em wmove} & Water movement matrix $[m^3 m^{-2}]$\\
\hline
{\em tmove} & Temperature matrix associated with ground water movement \mbox{[}C\}\\
\hline
{\em lzf} & Index of soil layer in which wetting front is located\\
\hline
{\em ninf} & Number of levels involved in water movement\\
\hline
{\em zf} & Depth of the wetting front \mbox{[}m\mbox{]}\\
\hline
{\em trmdr} & Remainder of time step after unsaturated infiltration ceases \mbox{[}s\mbox{]}\\
\hline
{\em r} & Rainfall rate at ground surface $[m s^{-1}]$\\
\hline
{\em tr} & Temperature of rainfall \mbox{[}C\mbox{]}\\
\hline
{\em psif} & Soil water suction across the wetting front \mbox{[}m\mbox{]}\\
\hline
{\em grkinf} & Hydraulic conductivity of soil behind the wetting front $[m s^{-1}]$\\
\hline
{\em thlinf} & Volumetric liquid water content behind the wetting front $[m^3 m^{-3}]$\\
\hline
{\em thliqx} & Volumetric liquid water content of soil layer $[m^3 m^{-3}]$\\
\hline
{\em tbarwx} & Temperature of water in soil layer \mbox{[}C\mbox{]}\\
\hline
{\em delzx} & Permeable depth of soil layer $[m] (\Delta z_{g,w})$\\
\hline
{\em zbotx} & Depth of bottom of soil layer \mbox{[}m\mbox{]}\\
\hline
{\em ifill} & Flag indicating whether unsaturated infiltration is occurring \\
\hline
\end{DoxyParams}
The infiltration rate $F_{inf}$ under conditions of a constant water supply can be expressed, e.\+g. in Mein and Larson (1973), as

$F_{inf} = $K\+\_\+\{inf\} $ [(\Psi_f + z_f)/ z_f ]$

where $K_{inf}$ is the hydraulic conductivity of the soil behind the wetting front, $\Psi_f$ is the soil moisture suction across the wetting front, and $z_f$ is the depth of the wetting front. It can be seen that $F_{inf}$ decreases with increasing $z_f$ to an asymptotic value of $K_{inf}$. Thus, if the rainfall rate r is less than $K_{inf}$, the actual infiltration rate is limited by r, i.\+e. $F_{inf} = r$. Otherwise, $F_{inf}$ will be equal to R until the right-\/hand side of the above equation becomes less than r, after which point the above equation applies and ponding of excess water begins on the surface. The depth of the wetting front at this time $t_p$ can be calculated by setting $F_{inf}$ equal to r in the above equation and solving for $z_f$. This results in\+:

$z_f = \Psi_f /[r/K_{inf} – 1]$

The amount of water added to the soil up to the time of ponding is $t_p r$, or $z_f (\theta_{inf} – \theta_l)$, where $\theta_l$ and $\theta_{inf}$ are respectively the liquid water content of the soil before and after the wetting front has passed. Setting these two equal and solving for $t_p$ results in

$t_p = z_f (\theta_{inf} – \theta_l)/r$

In the 100 loop, a check is done for each successive soil layer to compare the infiltration rate in the layer with the rainfall rate. If $K_{inf} < R$, a test calculation is performed to determine where the depth of the wetting front would theoretically occur at the ponding time $t_p$. If the calculated value of $z_f$ is less than the depth of the top of the soil layer, $z_f$ is set to the depth of the top of the layer; if $z_f$ falls within the soil layer, that value of $z_f$ is accepted. In both cases, the index L\+Z\+F is set to the index of the layer, and the flag I\+F\+I\+N\+D, indicating that $z_f$, has been successfully located, is set to 1. If the infiltration rate in the soil layer is greater than the rainfall rate, $z_f$ is provisionally set to the bottom of the current layer, and L\+Z\+F to the index of the next layer. I\+F\+I\+N\+D remains zero. If the infiltration rate in the layer is vanishingly small, $z_f$ is set to the depth of the top of the current layer, L\+Z\+F to the index of the overlying layer, and I\+F\+I\+N\+D to 1.

If L\+Z\+F is greater than 1, some adjustment to the equation for $t_p$ above is required to account for the fact that the values of $\theta_{inf}$ and $\theta_l$ in the layer containing the wetting front may differ from those in the overlying layers. The equation for $t_p$ above can be rewritten as

$t_p = [z_f [\theta_{inf}(z_f) – \theta_l(z_f)] + w_{adj}]/r$

where $w_{adj}$ is calculated as

$LZF-1$

$w_{adj} = \Sigma[(\theta_{inf. i} – \theta_{l,i} ) – (\theta_{inf} (z_f) – \theta_l (z_f))] \Delta z_{g,w}$

$i=1$

The adjusting volume W\+A\+D\+J is calculated in loop 200, and the time to ponding T\+I\+M\+P\+N\+D in loop 250. If T\+I\+M\+P\+N\+D is greater than the amount of time remaining in the current time step T\+R\+M\+D\+R, then unsaturated infiltration is deemed to be occurring over the entire time step. In this case, the amount of water infiltrating over the time step is assigned to the first level of the water movement matrix W\+M\+O\+V\+E and to the accounting variable W\+A\+D\+D, and the temperature of the infiltrating water is assigned to the first level of the matrix T\+M\+O\+V\+E.

In loop 300 W\+A\+D\+D is partitioned over the soil profile by comparing in turn the liquid water content of each soil layer with the calculated liquid water content behind the wetting front T\+H\+L\+I\+N\+F, and decrementing W\+A\+D\+D layer by layer until a layer is reached in which the remainder of W\+A\+D\+D is insufficient to raise the liquid water content to T\+H\+L\+I\+N\+F. If this condition is reached, L\+Z\+F is set to the index of the soil layer; the depth of the wetting front D\+Z\+F within the layer, obtained as W\+A\+D\+D/(T\+H\+L\+I\+N\+F-\/\+T\+H\+L\+I\+Q\+X), is added to the depth of the bottom of the overlying layer to obtain Z\+F.

In loop 400, the water content in each soil layer J existing above Z\+F is assigned to the J+1 level of the water movement matrix W\+M\+O\+V\+E, and the respective water temperatures are assigned to T\+M\+O\+V\+E.

If T\+I\+M\+P\+N\+D $<$ T\+R\+M\+D\+R, the amount of water infiltrating between the start of the time step and T\+I\+M\+P\+N\+D is again assigned to the first level of the water movement matrix W\+M\+O\+V\+E, and the temperature of the infiltrating water is assigned to the first level of the matrix T\+M\+O\+V\+E. The depth D\+Z\+F of the wetting front within the layer containing it is calculated by subtracting the depth of the bottom of the overlying layer from Z\+F.

In loop 500, the water content in each soil layer J existing above Z\+F is assigned to the J+1 level of the water movement matrix W\+M\+O\+V\+E, and the respective water temperatures are assigned to T\+M\+O\+V\+E.

Finally, the time remaining in the current time step after the period of unsaturated infiltration is recalculated, and the counter N\+I\+N\+F is set to L\+Z\+F+1.