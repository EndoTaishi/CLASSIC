\hypertarget{WEND_8f}{}\section{W\+E\+N\+D.\+f File Reference}
\label{WEND_8f}\index{W\+E\+N\+D.\+f@{W\+E\+N\+D.\+f}}


Purpose\+: Recalculate liquid water content of soil layers after infiltration, and evaluate baseflow.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{WEND_8f_aef71fcd76a2c9c23bd3d07a80231ca8b}{wend} (T\+H\+L\+I\+Q\+X, T\+H\+I\+C\+E\+X, T\+B\+A\+R\+W\+X, Z\+P\+O\+N\+D, T\+P\+O\+N\+D, B\+A\+S\+F\+L\+W, T\+B\+A\+S\+F\+L, R\+U\+N\+O\+F\+F, T\+R\+U\+N\+O\+F, F\+I, W\+M\+O\+V\+E, T\+M\+O\+V\+E, L\+Z\+F, N\+I\+N\+F, T\+R\+M\+D\+R, T\+H\+L\+I\+N\+F, D\+E\+L\+Z\+X, Z\+M\+A\+T, Z\+R\+M\+D\+R, F\+D\+T\+B\+N\+D, W\+A\+D\+D, T\+A\+D\+D, F\+D\+T, T\+F\+D\+T, T\+H\+L\+M\+A\+X, T\+H\+T\+E\+S\+T, T\+H\+L\+D\+U\+M, T\+H\+I\+D\+U\+M, T\+D\+U\+M\+W, T\+U\+S\+E\+D, R\+D\+U\+M\+M\+Y, Z\+E\+R\+O, W\+E\+X\+C\+E\+S, X\+D\+R\+A\+I\+N, T\+H\+P\+O\+R, T\+H\+L\+R\+E\+T, T\+H\+L\+M\+I\+N, B\+I, P\+S\+I\+S\+A\+T, G\+R\+K\+S\+A\+T, T\+H\+F\+C, D\+E\+L\+Z\+W, I\+S\+A\+N\+D, I\+G\+R\+N, I\+G\+R\+D, I\+G\+D\+R, I\+Z\+E\+R\+O, I\+V\+E\+G, I\+G, I\+G\+P1, I\+G\+P2, I\+L\+G, I\+L1, I\+L2, J\+L, N)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Purpose\+: Recalculate liquid water content of soil layers after infiltration, and evaluate baseflow. 



\subsection{Function/\+Subroutine Documentation}
\hypertarget{WEND_8f_aef71fcd76a2c9c23bd3d07a80231ca8b}{}\index{W\+E\+N\+D.\+f@{W\+E\+N\+D.\+f}!wend@{wend}}
\index{wend@{wend}!W\+E\+N\+D.\+f@{W\+E\+N\+D.\+f}}
\subsubsection[{wend}]{\setlength{\rightskip}{0pt plus 5cm}subroutine wend (
\begin{DoxyParamCaption}
\item[{real, dimension(ilg,igp1)}]{T\+H\+L\+I\+Q\+X, }
\item[{real, dimension(ilg,igp1)}]{T\+H\+I\+C\+E\+X, }
\item[{real, dimension(ilg,igp1)}]{T\+B\+A\+R\+W\+X, }
\item[{real, dimension (ilg)}]{Z\+P\+O\+N\+D, }
\item[{real, dimension (ilg)}]{T\+P\+O\+N\+D, }
\item[{real, dimension(ilg)}]{B\+A\+S\+F\+L\+W, }
\item[{real, dimension(ilg)}]{T\+B\+A\+S\+F\+L, }
\item[{real, dimension(ilg)}]{R\+U\+N\+O\+F\+F, }
\item[{real, dimension(ilg)}]{T\+R\+U\+N\+O\+F, }
\item[{real, dimension    (ilg)}]{F\+I, }
\item[{real, dimension (ilg,igp2)}]{W\+M\+O\+V\+E, }
\item[{real, dimension (ilg,igp2)}]{T\+M\+O\+V\+E, }
\item[{integer, dimension   (ilg)}]{L\+Z\+F, }
\item[{integer, dimension  (ilg)}]{N\+I\+N\+F, }
\item[{real, dimension (ilg)}]{T\+R\+M\+D\+R, }
\item[{real, dimension(ilg,igp1)}]{T\+H\+L\+I\+N\+F, }
\item[{real, dimension (ilg,igp1)}]{D\+E\+L\+Z\+X, }
\item[{real, dimension  (ilg,igp2,igp1)}]{Z\+M\+A\+T, }
\item[{real, dimension (ilg,igp1)}]{Z\+R\+M\+D\+R, }
\item[{real, dimension(ilg)}]{F\+D\+T\+B\+N\+D, }
\item[{real, dimension  (ilg)}]{W\+A\+D\+D, }
\item[{real, dimension  (ilg)}]{T\+A\+D\+D, }
\item[{real, dimension   (ilg,igp1)}]{F\+D\+T, }
\item[{real, dimension  (ilg,igp1)}]{T\+F\+D\+T, }
\item[{real, dimension(ilg,ig)}]{T\+H\+L\+M\+A\+X, }
\item[{real, dimension(ilg,ig)}]{T\+H\+T\+E\+S\+T, }
\item[{real, dimension(ilg,ig)}]{T\+H\+L\+D\+U\+M, }
\item[{real, dimension(ilg,ig)}]{T\+H\+I\+D\+U\+M, }
\item[{real, dimension (ilg,ig)}]{T\+D\+U\+M\+W, }
\item[{real, dimension (ilg)}]{T\+U\+S\+E\+D, }
\item[{real, dimension(ilg)}]{R\+D\+U\+M\+M\+Y, }
\item[{real, dimension  (ilg)}]{Z\+E\+R\+O, }
\item[{real, dimension(ilg)}]{W\+E\+X\+C\+E\+S, }
\item[{real, dimension(ilg)}]{X\+D\+R\+A\+I\+N, }
\item[{real, dimension (ilg,ig)}]{T\+H\+P\+O\+R, }
\item[{real, dimension(ilg,ig)}]{T\+H\+L\+R\+E\+T, }
\item[{real, dimension(ilg,ig)}]{T\+H\+L\+M\+I\+N, }
\item[{real, dimension    (ilg,ig)}]{B\+I, }
\item[{real, dimension(ilg,ig)}]{P\+S\+I\+S\+A\+T, }
\item[{real, dimension(ilg,ig)}]{G\+R\+K\+S\+A\+T, }
\item[{real, dimension  (ilg,ig)}]{T\+H\+F\+C, }
\item[{real, dimension (ilg,ig)}]{D\+E\+L\+Z\+W, }
\item[{integer, dimension (ilg,ig)}]{I\+S\+A\+N\+D, }
\item[{integer, dimension  (ilg)}]{I\+G\+R\+N, }
\item[{integer, dimension  (ilg)}]{I\+G\+R\+D, }
\item[{integer, dimension  (ilg)}]{I\+G\+D\+R, }
\item[{integer, dimension (ilg)}]{I\+Z\+E\+R\+O, }
\item[{integer}]{I\+V\+E\+G, }
\item[{integer}]{I\+G, }
\item[{integer}]{I\+G\+P1, }
\item[{integer}]{I\+G\+P2, }
\item[{integer}]{I\+L\+G, }
\item[{integer}]{I\+L1, }
\item[{integer}]{I\+L2, }
\item[{integer}]{J\+L, }
\item[{integer}]{N}
\end{DoxyParamCaption}
)}\label{WEND_8f_aef71fcd76a2c9c23bd3d07a80231ca8b}

\begin{DoxyParams}{Parameters}
{\em thliqx} & Volumetric liquid water content of soil layer $[m^3 m^{-3}]$\\
\hline
{\em thicex} & Volumetric frozen water content of soil layer $[m^3 m^{-3}]$\\
\hline
{\em tbarwx} & Temperature of water in soil layer \mbox{[}C\mbox{]}\\
\hline
{\em zpond} & Depth of ponded water \mbox{[}m\mbox{]}\\
\hline
{\em tpond} & Temperature of ponded water \mbox{[}C\mbox{]}\\
\hline
{\em basflw} & Base flow from bottom of soil column $[kg m^{-2}]$\\
\hline
{\em tbasfl} & Temperature of base flow from bottom of soil column \mbox{[}K\mbox{]}\\
\hline
{\em runoff} & Total runoff from soil column \mbox{[}m\mbox{]}\\
\hline
{\em trunof} & Temperature of total runoff from soil column \mbox{[}K\mbox{]}\\
\hline
{\em wmove} & Water movement matrix $[m^3 m^{-2}]$\\
\hline
{\em tmove} & Temperature matrix associated with ground water movement \mbox{[}C\mbox{]}\\
\hline
{\em thlinf} & Volumetric liquid water content behind the wetting front $[m^3 m^{-3}]$\\
\hline
{\em fi} & Fractional coverage of subarea in question on modelled area \mbox{[} \mbox{]}\\
\hline
{\em trmdr} & Time remaining in current time step \mbox{[}s\mbox{]}\\
\hline
{\em delzx} & Permeable depth of soil layer \mbox{[}m\mbox{]} \\
\hline
\end{DoxyParams}
At levels in the soil profile lower than the bottom of the wetting front, redistribution of soil liquid water proceeds in response to normal gravity and suction forces. Subroutine G\+R\+D\+R\+A\+N is called to calculate these redistributions. The time period T\+U\+S\+E\+D that is passed to G\+R\+D\+R\+A\+N is set in the 100 loop to the time period over which infiltration was occurring during the current time step, except if the wetting front has passed the bottom of the lowest soil layer, in which case T\+U\+S\+E\+D is set to zero (since the flows calculated by G\+R\+D\+R\+A\+N are not required). G\+R\+D\+R\+A\+N is called using dummy variables T\+H\+L\+D\+U\+M, T\+H\+I\+D\+U\+M and T\+D\+U\+M\+W, which are set in loop 125 to the liquid water content, the frozen water content and the water temperature of the soil layers respectively.

After G\+R\+D\+R\+A\+N has been called, the maximum value of the water movement index N\+I\+N\+F is set to the number of soil layers plus 1. The values in the matrix Z\+R\+M\+D\+R, representing for each soil layer the depth that has not been affected by infiltration, are initialized to the soil permeable layer thicknesses D\+E\+L\+Z\+X. The water flows F\+D\+T coming out of G\+R\+D\+R\+A\+N are set to zero at the soil layer interfaces above the wetting front. For the layer containing the wetting front, if the flow at the bottom of the layer is upward, it is set to zero (to avoid possible overflows in liquid water content).

The values in the three-\/dimensional matrix Z\+M\+A\+T are initialized to zero. This matrix contains the depth of each soil layer J (including the dummy soil layer below the lowest layer) that is filled by water from level K in the water movement matrix W\+M\+O\+V\+E. In W\+M\+O\+V\+E, the first level contains the amount of water that has infiltrated at the surface during the time period in question, and each successive level K contains the amount of water in soil layer K-\/1 that has been displaced during the infiltration, down to the soil layer containing the wetting front. Thus, the number of levels in W\+M\+O\+V\+E that are used in the current infiltration calculations, N\+I\+N\+F, is equal to L\+Z\+F+1, where L\+Z\+F is the index of the soil layer containing the wetting front; or to I\+G\+P1, the number of soil layers I\+G plus 1, if L\+Z\+F is greater than I\+G, i.\+e. if the wetting front has penetrated below the bottom of the lowest soil layer into the underlying dummy layer. In the 400 loop, starting at the top of the soil profile, an attempt is made to assign each layer of W\+M\+O\+V\+E, converted into a depth by using the volumetric water content T\+H\+L\+I\+N\+F behind the wetting front for the soil layer, in turn to the K,J level of Z\+M\+A\+T. If the calculated value of Z\+M\+A\+T is greater than the available depth Z\+R\+M\+D\+R of the layer, Z\+M\+A\+T is set to Z\+R\+M\+D\+R, W\+M\+O\+V\+E is decremented by Z\+R\+M\+D\+R converted back to a water amount, and Z\+R\+M\+D\+R is set to zero. Otherwise the calculated value of Z\+M\+A\+T is accepted, Z\+R\+M\+D\+R is decremented by Z\+M\+A\+T, and W\+M\+O\+V\+E is set to zero. At the end of these calculations, any remaining residual amounts in the W\+M\+O\+V\+E matrix are assigned to ponded water, and the ponded water temperature is updated accordingly.

As a result of the above processes, the liquid water content and temperature of each soil layer (excluding the bottom, dummy layer) will be a combined result of infiltration processes (W\+A\+D\+D, T\+A\+D\+D), redistribution processes (W\+D\+R\+A, T\+D\+R\+A), and water in the layer that has remained unaffected (W\+R\+E\+M, T\+R\+E\+M). For each layer, W\+A\+D\+D is calculated by summing over the respective Z\+M\+A\+T values corresponding to that layer multiplied by T\+H\+L\+I\+N\+F, and T\+A\+D\+D by summing over the Z\+M\+A\+T and T\+H\+L\+I\+N\+F values multiplied by the respective T\+M\+O\+V\+E values. W\+R\+E\+M is obtained as the product of the original water content T\+H\+L\+I\+Q\+X multiplied by Z\+R\+M\+D\+R, and T\+R\+E\+M as the product of the water temperature T\+B\+A\+R\+W\+X, T\+H\+L\+I\+Q\+X and Z\+R\+M\+D\+R. For the soil layer containing the wetting front, a check is carried out to determine whether the liquid moisture content resulting from the infiltration and drainage processes, T\+H\+I\+N\+F\+L, is less than the residual liquid moisture content T\+H\+L\+M\+I\+N. If so, the flow F\+D\+T at the bottom of the layer is recalculated as the value required to keep T\+H\+L\+I\+Q\+X at T\+H\+L\+M\+I\+N. W\+D\+R\+A is obtained from the difference between the water fluxes F\+D\+T at the top and bottom of the layer, supplied by G\+R\+D\+R\+A\+N, and T\+D\+R\+A is obtained from the water fluxes F\+D\+T and their corresponding temperatures T\+F\+D\+T. Finally, T\+H\+L\+I\+Q\+X is calculated as the sum of W\+A\+D\+D, W\+R\+E\+M and W\+D\+R\+A normalized by D\+E\+L\+Z\+X, and T\+B\+A\+R\+W\+X as the sum of T\+A\+D\+D, T\+R\+E\+M and T\+D\+R\+A normalized by the product of T\+H\+L\+I\+Q\+X and D\+E\+L\+Z\+X.

Lastly, the base flow B\+A\+S\+F\+L\+W at the bottom of the soil profile and its temperature T\+B\+A\+S\+F\+L are calculated. If the wetting front is located in the dummy soil layer below the soil profile, B\+A\+S\+F\+L\+W is obtained by summing over the Z\+M\+A\+T values for the I\+G\+P1 level, multiplied by the dummy layer T\+H\+L\+I\+N\+F value and the fractional coverage F\+I of the modelled subarea. T\+B\+A\+S\+F\+L is similarly obtained as the weighted average of the original T\+B\+A\+S\+F\+L and the values of T\+M\+O\+V\+E corresponding to the Z\+M\+A\+T values. The overall subarea runoff R\+U\+N\+O\+F\+F and its temperature T\+R\+U\+N\+O\+F are calculated in the same manner without the F\+I weightings. Otherwise, the baseflow and total runoff are obtained from the value of F\+D\+T at the bottom of the I\+G\+D\+R layer, and their temperatures from the values of T\+F\+D\+T and F\+D\+T.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=266pt]{WEND_8f_aef71fcd76a2c9c23bd3d07a80231ca8b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=278pt]{WEND_8f_aef71fcd76a2c9c23bd3d07a80231ca8b_icgraph}
\end{center}
\end{figure}


