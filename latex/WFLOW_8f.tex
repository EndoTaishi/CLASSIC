\hypertarget{WFLOW_8f}{}\section{W\+F\+L\+O\+W.\+f File Reference}
\label{WFLOW_8f}\index{W\+F\+L\+O\+W.\+f@{W\+F\+L\+O\+W.\+f}}


Evaluates infiltration of water into soil under saturated conditions.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{WFLOW_8f_a7a3409d93e2e44adae8e38e9ddd99f97}{wflow} (W\+M\+O\+V\+E, T\+M\+O\+V\+E, L\+Z\+F, N\+I\+N\+F, T\+R\+M\+D\+R, T\+P\+O\+N\+D, Z\+P\+O\+N\+D, R, T\+R, E\+V\+A\+P, P\+S\+I\+F, G\+R\+K\+I\+N\+F, T\+H\+L\+I\+N\+F, T\+H\+L\+I\+Q\+X, T\+B\+A\+R\+W\+X, D\+E\+L\+Z\+X, Z\+B\+O\+T\+X, F\+M\+A\+X, Z\+F, D\+Z\+F, D\+T\+F\+L\+O\+W, T\+H\+L\+N\+L\+Z, T\+H\+L\+Q\+L\+Z, D\+Z\+D\+I\+S\+P, W\+D\+I\+S\+P, W\+A\+B\+S, I\+T\+E\+R, N\+E\+N\+D, I\+S\+I\+M\+P, I\+G\+R\+N, I\+G, I\+G\+P1, I\+G\+P2, I\+L\+G, I\+L1, I\+L2, J\+L, N)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Evaluates infiltration of water into soil under saturated conditions. 



\subsection{Function/\+Subroutine Documentation}
\hypertarget{WFLOW_8f_a7a3409d93e2e44adae8e38e9ddd99f97}{}\index{W\+F\+L\+O\+W.\+f@{W\+F\+L\+O\+W.\+f}!wflow@{wflow}}
\index{wflow@{wflow}!W\+F\+L\+O\+W.\+f@{W\+F\+L\+O\+W.\+f}}
\subsubsection[{wflow}]{\setlength{\rightskip}{0pt plus 5cm}subroutine wflow (
\begin{DoxyParamCaption}
\item[{real, dimension (ilg,igp2)}]{W\+M\+O\+V\+E, }
\item[{real, dimension (ilg,igp2)}]{T\+M\+O\+V\+E, }
\item[{integer, dimension   (ilg)}]{L\+Z\+F, }
\item[{integer, dimension  (ilg)}]{N\+I\+N\+F, }
\item[{real, dimension (ilg)}]{T\+R\+M\+D\+R, }
\item[{real, dimension (ilg)}]{T\+P\+O\+N\+D, }
\item[{real, dimension (ilg)}]{Z\+P\+O\+N\+D, }
\item[{real, dimension        (ilg)}]{R, }
\item[{real, dimension       (ilg)}]{T\+R, }
\item[{real, dimension     (ilg)}]{E\+V\+A\+P, }
\item[{real, dimension     (ilg,igp1)}]{P\+S\+I\+F, }
\item[{real, dimension   (ilg,igp1)}]{G\+R\+K\+I\+N\+F, }
\item[{real, dimension   (ilg,igp1)}]{T\+H\+L\+I\+N\+F, }
\item[{real, dimension   (ilg,igp1)}]{T\+H\+L\+I\+Q\+X, }
\item[{real, dimension   (ilg,igp1)}]{T\+B\+A\+R\+W\+X, }
\item[{real, dimension    (ilg,igp1)}]{D\+E\+L\+Z\+X, }
\item[{real, dimension    (ilg,igp1)}]{Z\+B\+O\+T\+X, }
\item[{real, dimension     (ilg)}]{F\+M\+A\+X, }
\item[{real, dimension       (ilg)}]{Z\+F, }
\item[{real, dimension   (ilg)}]{D\+Z\+F, }
\item[{real, dimension(ilg)}]{D\+T\+F\+L\+O\+W, }
\item[{real, dimension(ilg)}]{T\+H\+L\+N\+L\+Z, }
\item[{real, dimension(ilg)}]{T\+H\+L\+Q\+L\+Z, }
\item[{real, dimension(ilg)}]{D\+Z\+D\+I\+S\+P, }
\item[{real, dimension (ilg)}]{W\+D\+I\+S\+P, }
\item[{real, dimension  (ilg)}]{W\+A\+B\+S, }
\item[{integer, dimension  (ilg)}]{I\+T\+E\+R, }
\item[{integer, dimension  (ilg)}]{N\+E\+N\+D, }
\item[{integer, dimension (ilg)}]{I\+S\+I\+M\+P, }
\item[{integer, dimension  (ilg)}]{I\+G\+R\+N, }
\item[{integer}]{I\+G, }
\item[{integer}]{I\+G\+P1, }
\item[{integer}]{I\+G\+P2, }
\item[{integer}]{I\+L\+G, }
\item[{integer}]{I\+L1, }
\item[{integer}]{I\+L2, }
\item[{integer}]{J\+L, }
\item[{integer}]{N}
\end{DoxyParamCaption}
)}\label{WFLOW_8f_a7a3409d93e2e44adae8e38e9ddd99f97}

\begin{DoxyParams}{Parameters}
{\em wmove} & Water movement matrix $[m^3 m^{-2}]$\\
\hline
{\em tmove} & Temperature matrix associated with ground water movement \mbox{[}C\mbox{]}\\
\hline
{\em lzf} & Index of soil layer in which wetting front is located\\
\hline
{\em ninf} & Number of levels involved in water movement\\
\hline
{\em trmdr} & Time remaining in current time step \mbox{[}s\mbox{]}\\
\hline
{\em tpond} & Temperature of ponded water \mbox{[}C\mbox{]}\\
\hline
{\em zpond} & Depth of ponded water $[m] (z_p)$\\
\hline
{\em r} & Rainfall rate at ground surface $[m s^{-1}]$\\
\hline
{\em tr} & Temperature of rainfall \mbox{[}C\mbox{]}\\
\hline
{\em evap} & Surface evaporation rate $[m s^{-1}]$\\
\hline
{\em psif} & Soil water suction across the wetting front $[m] (\Psi_f)$\\
\hline
{\em grkinf} & Hydraulic conductivity of soil behind the wetting front $[m s^{-1}] (K)$\\
\hline
{\em thlinf} & Volumetric liquid water content behind the wetting front $[m^3 m^{-3}]$\\
\hline
{\em thliqx} & Volumetric liquid water content of soil layer $[m^3 m^{-3}]$\\
\hline
{\em tbarwx} & Temperature of water in soil layer \mbox{[}C\mbox{]}\\
\hline
{\em delzx} & Permeable depth of soil layer $[m] (\Delta z_{z,w})$\\
\hline
{\em zbotx} & Depth of bottom of soil layer \mbox{[}m\mbox{]}\\
\hline
{\em fmax} & Maximum infiltration rate, defined as minimum value of G\+R\+K\+I\+N\+F\\
\hline
{\em zf} & Depth of the wetting front $[m] (z_f)$\\
\hline
{\em igrn} & Flag to indicate whether infiltration is occurring \\
\hline
\end{DoxyParams}
General calculations performed\+: The infiltration rate $F_{inf}$ under saturated conditions is calculated as

$F_{inf} = K_{inf} [(\Psi_f + z_f + z_p)/z_f ]$

where $K_{inf}$ is the hydraulic conductivity of the soil behind the wetting front, $\Psi_f$ is the soil moisture suction across the wetting front, $z_f$ is the depth of the wetting front, and $z_p$ is the depth of water ponded on the surface. Since $\Psi_f$ will vary by soil layer, and $z_f$ and $z_p$ will vary with time, the period of infiltration is divided into two-\/minute segments. A maximum iteration flag N\+E\+N\+D is defined as the number of iteration segments plus 100, as a safeguard against runaway iterations. Since the surface infiltration rate will be limited by the lowest infiltration rate encountered, a maximum infiltration rate F\+M\+A\+X is defined as the minimum value of G\+R\+K\+I\+N\+F, the hydraulic conductivity behind the wetting front, in all of the soil layers above and including that containing the wetting front.

In loop 200, a check is performed to determine whether the liquid water content of the current soil layer, T\+H\+L\+I\+Q\+X, equals or exceeds that behind the wetting front, T\+H\+L\+I\+N\+F. If so, the depth of the wetting front is reset to the depth of the soil layer. The water content of the soil layer is assigned to the level of the water movement matrix W\+M\+O\+V\+E corresponding to the soil layer index plus 1, and the temperature of the water in the layer is assigned to the same level of the matrix T\+M\+O\+V\+E. F\+M\+A\+X is recalculated, and the flags L\+Z\+F and N\+I\+N\+F are each incremented by 1. The flag I\+S\+I\+M\+P is set to 1, indicating that the following calculations are to be bypassed for this iteration.

If I\+S\+I\+M\+P is not 1, the time period D\+T\+F\+L\+O\+W applying to the current iteration loop is set to two minutes or to the remainder of the time step, whichever is less. If G\+R\+K\+I\+N\+F for the current soil layer is not vanishingly small, the flag I\+S\+I\+M\+P is set to -\/2. Otherwise, it is deemed that infiltration is suppressed, and the temperature and depth of water ponded on the surface are simply updated. The temperature of the ponded water is calculated as the weighted average of the current pond temperature and the rainfall added to it. The ponded water remaining after rainfall and evaporation have taken place is calculated as Z\+P\+T\+E\+S\+T. If Z\+P\+T\+E\+S\+T is less than zero, it is deduced that evaporation must have removed the ponded water before the end of the current iteration loop. If this is the case, the time period of the current iteration loop is recalculated as the amount of time required for the difference between the evaporation and the rainfall rates to consume the ponded water, and the pond depth Z\+P\+O\+N\+D is set to zero. Otherwise, Z\+P\+O\+N\+D is set to Z\+P\+T\+E\+S\+T. Finally, I\+S\+I\+M\+P is set to -\/1.

The 400 loop addresses the infiltration process under saturated conditions. Such infiltration is modelled as “piston flow”. First the current infiltration rate F\+I\+N\+F is calculated using the equation given above. If the wetting front has passed the bottom of the lowest soil layer, P\+S\+I\+F Cis neglected. If F\+I\+N\+F is greater than the rainfall rate R, F\+I\+N\+F is set equal to R; if F\+I\+N\+F is greater than C\+F\+M\+A\+X, F\+I\+N\+F is set equal to F\+M\+A\+X. If the wetting front has not passed the bottom of the lowest soil layer, the change in depth of the wetting front D\+Z\+F over the current time interval is calculated from the amount of infiltrating water W\+I\+N\+F and the volumetric water content behind the wetting front, T\+H\+L\+I\+N\+F. The amount of soil water W\+D\+I\+S\+P displaced by this movement of the wetting front is calculated from D\+Z\+F and T\+H\+L\+I\+Q\+X, and the depth to which this water penetrates, D\+Z\+D\+I\+S\+P, is calculated as W\+D\+I\+S\+P/(T\+H\+L\+I\+N\+F – T\+H\+L\+I\+Q\+X). The amount of soil water W\+A\+B\+S entrained by the movement of W\+D\+I\+S\+P itself is calculated as the product of D\+Z\+D\+I\+S\+P and T\+H\+L\+I\+Q\+X. The change in depth of the wetting front, behind which the liquid water content of the soil layer is T\+H\+L\+I\+N\+F, is now the sum of the depth represented by infiltration of water at the surface, D\+Z\+F, and the depth represented by displacement of the pre-\/existing soil water, D\+Z\+D\+I\+S\+P. If this change in depth causes the wetting front to move beyond the bottom of the current soil layer, D\+T\+F\+L\+O\+W is recalculated as the amount of time required for the composite wetting front to reach the bottom of the soil layer, and D\+Z\+F, W\+D\+I\+S\+P, D\+Z\+D\+I\+S\+P and W\+A\+B\+S are likewise recalculated. As in the case for I\+S\+I\+M\+P = -\/1, the temperature of the ponded water on the surface is calculated as the weighted average of the current pond temperature and the rainfall added to it. The ponded water remaining after rainfall, infiltration and evaporation have taken place is calculated as Z\+P\+T\+E\+S\+T. If Z\+P\+T\+E\+S\+T is less than zero, it is deduced that infiltration and evaporation must have removed the ponded water before the end of the current iteration loop. If this is the case, the time period of the current iteration loop is recalculated as the amount of time required for the infiltration and evaporation minus the rainfall to consume the ponded water. The pond depth Z\+P\+O\+N\+D is set to zero; if the wetting front has not passed the bottom of the lowest soil layer, D\+Z\+F, W\+D\+I\+S\+P, D\+Z\+D\+I\+S\+P and W\+A\+B\+S are recalculated. Otherwise, Z\+P\+O\+N\+D is set to Z\+P\+T\+E\+S\+T. Finally, the first layer of the water movement matrix W\+M\+O\+V\+E is incremented with the amount of the infiltrated water, and the first layer of the matrix T\+M\+O\+V\+E with the temperature of the infiltrated water. The last layer of W\+M\+O\+V\+E is incremented by W\+D\+I\+S\+P+\+W\+A\+B\+S, and the depth of the wetting front by D\+Z\+F+\+D\+Z\+D\+I\+S\+P.

In the 500 loop, if I\+S\+I\+M\+P $<$ 0 (i.\+e. water movement has occurred), the time remaining in the current time step is recalculated. If the wetting front is at a soil layer boundary, if the time remaining is non-\/zero, if the wetting front is still within the modelled soil column, and if the calculated water content behind the wetting front is greater than zero, F\+M\+A\+X is updated, and L\+Z\+F and N\+I\+N\+F are incremented by 1. The N\+I\+N\+F level of the T\+M\+O\+V\+E matrix is set to the water temperature of the new soil layer.

At the end of the iteration pass, checks are done in the 600 loop to ascertain whether the number of iteration passes is still less than N\+E\+N\+D, whether either ponded water still exists or rain is still falling, and whether there is still time remaining in the current time step. If these conditions are all fulfilled, the counter N\+P\+N\+T\+S representing the number of points in the current vector of mosaic tiles for which infiltration is still occurring is incremented by 1. Otherwise, the iteration flag for the current tile is changed from 1 to 0, signaling the end of the saturated infiltration calculations for that tile.