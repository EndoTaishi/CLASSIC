\hypertarget{TMELT_8f}{}\section{T\+M\+E\+L\+T.\+f File Reference}
\label{TMELT_8f}\index{T\+M\+E\+L\+T.\+f@{T\+M\+E\+L\+T.\+f}}


Purpose\+: Address melting of the snow pack.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{TMELT_8f_aad6f10137f2154cc02903988c6a60107}{tmelt} (Z\+S\+N\+O\+W, T\+S\+N\+O\+W, Q\+M\+E\+L\+T, R, T\+R, G\+Z\+E\+R\+O, R\+A\+L\+B, H\+M\+F\+N, H\+T\+C\+S, H\+T\+C, F\+I, H\+C\+P\+S\+N\+O, R\+H\+O\+S\+N\+O, W\+S\+N\+O\+W, I\+S\+A\+N\+D, I\+G, I\+L\+G, I\+L1, I\+L2, J\+L)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Purpose\+: Address melting of the snow pack. 



\subsection{Function/\+Subroutine Documentation}
\hypertarget{TMELT_8f_aad6f10137f2154cc02903988c6a60107}{}\index{T\+M\+E\+L\+T.\+f@{T\+M\+E\+L\+T.\+f}!tmelt@{tmelt}}
\index{tmelt@{tmelt}!T\+M\+E\+L\+T.\+f@{T\+M\+E\+L\+T.\+f}}
\subsubsection[{tmelt}]{\setlength{\rightskip}{0pt plus 5cm}subroutine tmelt (
\begin{DoxyParamCaption}
\item[{real, dimension (ilg)}]{Z\+S\+N\+O\+W, }
\item[{real, dimension (ilg)}]{T\+S\+N\+O\+W, }
\item[{real, dimension (ilg)}]{Q\+M\+E\+L\+T, }
\item[{real, dimension     (ilg)}]{R, }
\item[{real, dimension    (ilg)}]{T\+R, }
\item[{real, dimension (ilg)}]{G\+Z\+E\+R\+O, }
\item[{real, dimension  (ilg)}]{R\+A\+L\+B, }
\item[{real, dimension  (ilg)}]{H\+M\+F\+N, }
\item[{real, dimension  (ilg)}]{H\+T\+C\+S, }
\item[{real, dimension (ilg,ig)}]{H\+T\+C, }
\item[{real, dimension    (ilg)}]{F\+I, }
\item[{real, dimension(ilg)}]{H\+C\+P\+S\+N\+O, }
\item[{real, dimension(ilg)}]{R\+H\+O\+S\+N\+O, }
\item[{real, dimension (ilg)}]{W\+S\+N\+O\+W, }
\item[{integer, dimension (ilg,ig)}]{I\+S\+A\+N\+D, }
\item[{integer}]{I\+G, }
\item[{integer}]{I\+L\+G, }
\item[{integer}]{I\+L1, }
\item[{integer}]{I\+L2, }
\item[{integer}]{J\+L}
\end{DoxyParamCaption}
)}\label{TMELT_8f_aad6f10137f2154cc02903988c6a60107}

\begin{DoxyParams}{Parameters}
{\em htc} & Internal energy change of soil layer due to conduction and/or change in mass $[W m^{-2}]$\\
\hline
{\em zsnow} & Depth of snow pack \mbox{[}m\mbox{]}\\
\hline
{\em tsnow} & Temperature of the snow pack \mbox{[}C\mbox{]}\\
\hline
{\em qmelt} & Energy available for melting of snow $[W m^{-2}]$\\
\hline
{\em r} & Rainfall rate $[m s^{-1}]$\\
\hline
{\em tr} & Temperature of rainfall \mbox{[}C\mbox{]}\\
\hline
{\em gzero} & Heat flow into soil surface $[W m^{-2}]$\\
\hline
{\em ralb} & Rainfall rate saved for snow albedo calculations $[m s^{-1}]$\\
\hline
{\em hmfn} & Energy associated with freezing or thawing of water in the snow pack $[W m^{-2}]$\\
\hline
{\em htcs} & Internal energy change of snow pack due to conduction and/or change in mass $[W m^{-2}]$\\
\hline
{\em fi} & Fractional coverage of subarea in question on modelled area \mbox{[} \mbox{]}\\
\hline
{\em hcpsno} & Heat capacity of snow pack $[J m^{-3} K^{-1}]$\\
\hline
{\em rhosno} & Density of snow pack $[kg m^{-3}]$\\
\hline
{\em wsnow} & Liquid water content of snow pack $[kg m^{-2}]$\\
\hline
{\em isand} & Sand content flag \\
\hline
\end{DoxyParams}
Melting of the snow pack occurs if a source of available energy Q\+M\+E\+L\+T is produced as a result of the solution of the surface energy balance, or if the snow pack temperature is projected to go above 0 C in the current time step (the available energy thus produced is added to Q\+M\+E\+L\+T in subroutine T\+S\+P\+O\+S\+T). The change in internal energy in the snow pack is calculated at the beginning and end of the subroutine, and stored in diagnostic variable H\+T\+C\+S (see notes on subroutine S\+N\+O\+A\+D\+D).

The calculations in the 100 loop are performed if Q\+F\+R\+E\+Z and the snow depth Z\+S\+N\+O\+W are both greater than zero. The available energy H\+A\+D\+D to be applied to the snow pack is calculated from Q\+M\+E\+L\+T. The amount of energy required to raise the snow pack temperature to 0 C and melt it completely is calculated as H\+C\+O\+N\+V. If H\+A\+D\+D $\leq$ H\+C\+O\+N\+V, the depth of snow Z\+M\+E\+L\+T that is warmed to 0 C and melted is calculated from H\+A\+D\+D. (It is assumed that melting of an upper layer of snow can occur even if the lower part of the snow pack is still below 0 C.) The amount of water generated by melting the snow, R\+M\+E\+L\+T\+S, is calculated from Z\+M\+E\+L\+T, and the temperature of the meltwater T\+R\+M\+E\+L\+T is set to 0 C. Z\+M\+E\+L\+T is subtracted from Z\+S\+N\+O\+W, the heat capacity of the snow is recalculated, and H\+T\+C\+S is corrected for the amount of heat used to warm the removed portion of the snow pack.

If H\+A\+D\+D $>$ H\+C\+O\+N\+V, the amount of available energy is sufficient to warm and melt the whole snow pack, with some energy left over. The amount of water generated by melting the snow, R\+M\+E\+L\+T\+S, is calculated from Z\+S\+N\+O\+W, and the total amount of water reaching the soil, R\+M\+E\+L\+T, is obtained by adding the liquid water content of the snow pack, W\+S\+N\+O\+W, to R\+M\+E\+L\+T\+S. H\+A\+D\+D is recalculated as H\+A\+D\+D â€“ H\+C\+O\+N\+V, and used to calculate T\+R\+M\+E\+L\+T. The snow depth, heat capacity, temperature and water content are set to zero, and H\+T\+C\+S is corrected for the amount of heat that was used to warm the snow pack to 0 C.

After the I\+F block, the diagnostic variable H\+M\+F\+N describing melting or freezing of water in the snow pack is updated using R\+M\+E\+L\+T\+S, the temperature of the rainfall rate reaching the soil is updated using T\+R\+M\+E\+L\+T, and R\+M\+E\+L\+T is added to the rainfall rate R. Q\+M\+E\+L\+T is set to zero, and a flag variable R\+A\+L\+B, used later in subroutine S\+N\+O\+A\+L\+B\+W, is set to the rainfall rate reaching the ground.

In the 200 loop, a check is performed to see whether Q\+M\+E\+L\+T is still greater than zero and the modelled area is not an ice sheet (I\+S\+A\+N\+D $>$ -\/4). In this case Q\+M\+E\+L\+T is added to the ground heat flux G\+Z\+E\+R\+O, and the internal energy diagnostics H\+T\+C\+S and H\+T\+C for the snow and soil respectively are corrected. The flag variable R\+A\+L\+B is evaluated as above.