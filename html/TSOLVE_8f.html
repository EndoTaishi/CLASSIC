<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>CLASS-CTEM: TSOLVE.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CLASS-CTEM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">TSOLVE.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Purpose: Solution of surface energy balance for non-vegetated subareas.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:afed2fb96199ad1f2aeed9442633cd53f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="TSOLVE_8f.html#afed2fb96199ad1f2aeed9442633cd53f">tsolve</a> (ISNOW, FI, QSWNET, QLWOUT, QTRANS, QSENS, QEVAP, EVAP, TZERO, QZERO, GZERO, QMELT, CDH, CDM, RIB, CFLUX, FTEMP, FVAP, ILMO, UE, H, QLWIN, TPOTA, QA, VA, PADRY, RHOAIR, ALVISG, ALNIRG, CRIB, CPHCH, CEVAP, TVIRTA, ZOSCLH, ZOSCLM, ZRSLFH, ZRSLFM, ZOH, ZOM, FCOR, GCONST, GCOEFF, TSTART, PCPR, TRSNOWG, FSSB, ALSNO, THLIQ, THLMIN, DELZW, RHOSNO, ZSNOW, IWATER, IEVAP, ITERCT, ISAND, ISLFD, ITG, ILG, IG, IL1, IL2, JL, NBS, ISNOALB, TSTEP, TVIRTS, EVBETA, Q0SAT, RESID, DCFLXM, CFLUXM, WZERO, TRTOP, A, B, LZZ0, LZZ0T, FM, FH, ITER, NITER, JEVAP, KF)</td></tr>
<tr class="separator:afed2fb96199ad1f2aeed9442633cd53f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Purpose: Solution of surface energy balance for non-vegetated subareas. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="afed2fb96199ad1f2aeed9442633cd53f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine tsolve </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ISNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>FI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>QSWNET</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>QLWOUT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>QTRANS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>QSENS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>QEVAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>EVAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TZERO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>QZERO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>GZERO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>QMELT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>CDH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>CDM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>RIB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>CFLUX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>FTEMP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>FVAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>ILMO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>UE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>H</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>QLWIN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TPOTA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>QA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>VA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>PADRY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>RHOAIR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>ALVISG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>ALNIRG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>CRIB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>CPHCH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>CEVAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>TVIRTA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>ZOSCLH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>ZOSCLM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>ZRSLFH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>ZRSLFM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>ZOH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>ZOM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>FCOR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCONST</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCOEFF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>TSTART</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>PCPR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,nbs)&#160;</td>
          <td class="paramname"><em>TRSNOWG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,nbs)&#160;</td>
          <td class="paramname"><em>FSSB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,nbs)&#160;</td>
          <td class="paramname"><em>ALSNO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>THLIQ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>THLMIN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>DELZW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>RHOSNO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>ZSNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg)&#160;</td>
          <td class="paramname"><em>IWATER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg)&#160;</td>
          <td class="paramname"><em>IEVAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg,6,50)&#160;</td>
          <td class="paramname"><em>ITERCT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>ISAND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ISLFD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ITG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ILG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>JL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NBS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ISNOALB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TSTEP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>TVIRTS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>EVBETA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>Q0SAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>RESID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>DCFLXM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>CFLUXM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>WZERO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg,nbs)&#160;</td>
          <td class="paramname"><em>TRTOP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>LZZ0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>LZZ0T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>FM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>FH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>ITER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg)&#160;</td>
          <td class="paramname"><em>NITER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg)&#160;</td>
          <td class="paramname"><em>JEVAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>KF</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">isnow</td><td>Flag indicating presence or absence of snow</td></tr>
    <tr><td class="paramname">qswnet</td><td>Net shortwave radiation at surface <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">qlwout</td><td>Upwelling longwave radiation at surface <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/> (L)</td></tr>
    <tr><td class="paramname">qtrans</td><td>Shortwave radiation transmitted into surface <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">qsens</td><td>Sensible heat flux from surface <img class="formulaInl" alt="$[W m^{-2}] (Q_H )$" src="form_1731.png"/></td></tr>
    <tr><td class="paramname">qevap</td><td>Latent heat flux from surface <img class="formulaInl" alt="$[W m^{-2}] (Q_E)$" src="form_1732.png"/></td></tr>
    <tr><td class="paramname">evap</td><td>Evaporation rate at surface <img class="formulaInl" alt="$[kg m^{-2} s^{-1}] (E(0))$" src="form_1733.png"/></td></tr>
    <tr><td class="paramname">tzero</td><td>Temperature at surface <img class="formulaInl" alt="$[K] (T(0))$" src="form_831.png"/></td></tr>
    <tr><td class="paramname">qzero</td><td>Specific humidity at surface <img class="formulaInl" alt="$[kg kg^{-1}] (q(0))$" src="form_1734.png"/></td></tr>
    <tr><td class="paramname">gzero</td><td>Heat flux into surface <img class="formulaInl" alt="$[W m^{-2}] (G(0))$" src="form_1430.png"/></td></tr>
    <tr><td class="paramname">qmelt</td><td>Heat available for melting snow or freezing water at the surface <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">cdh</td><td>Surface drag coefficient for heat <img class="formulaInl" alt="$[ ] (C_{DH}) $" src="form_1735.png"/></td></tr>
    <tr><td class="paramname">cdm</td><td>Surface drag coefficient for momentum [ ]</td></tr>
    <tr><td class="paramname">rib</td><td>Bulk Richardson number at surface [ ]</td></tr>
    <tr><td class="paramname">cflux</td><td>Product of surface drag coefficient and wind speed <img class="formulaInl" alt="$[m s^{-1}]$" src="form_782.png"/></td></tr>
    <tr><td class="paramname">ftemp</td><td>Product of surface-air temperature gradient, drag coefficient and wind speed <img class="formulaInl" alt="$[K m s^{-1}]$" src="form_1736.png"/></td></tr>
    <tr><td class="paramname">fvap</td><td>Product of surface-air humidity gradient, drag coefficient and wind speed <img class="formulaInl" alt="$[kg kg^{-1} m s^{-1}]$" src="form_1737.png"/></td></tr>
    <tr><td class="paramname">ilmo</td><td>Inverse of Monin-Obukhov roughness length <img class="formulaInl" alt="$(m-1]$" src="form_1738.png"/></td></tr>
    <tr><td class="paramname">ue</td><td>Friction velocity of air <img class="formulaInl" alt="$[m s^{-1}]$" src="form_782.png"/></td></tr>
    <tr><td class="paramname">h</td><td>Height of the atmospheric boundary layer [m]</td></tr>
    <tr><td class="paramname">fi</td><td>Fractional coverage of subarea in question on modelled area [ ]</td></tr>
    <tr><td class="paramname">qlwin</td><td>Downwelling longwave radiation at bottom of atmosphere <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">tpota</td><td>Potential temperature of air at reference height <img class="formulaInl" alt="$[K] (T_{a,pot})$" src="form_1739.png"/></td></tr>
    <tr><td class="paramname">qa</td><td>Specific humidity at reference height <img class="formulaInl" alt="$[kg kg^{-1}] (q_a)$" src="form_1237.png"/></td></tr>
    <tr><td class="paramname">va</td><td>Wind speed at reference height <img class="formulaInl" alt="$[m s^{-1}] (v_a)$" src="form_1740.png"/></td></tr>
    <tr><td class="paramname">padry</td><td>Partial pressure of dry air <img class="formulaInl" alt="$[Pa] (p_{dry})$" src="form_1233.png"/></td></tr>
    <tr><td class="paramname">rhoair</td><td>Density of air <img class="formulaInl" alt="$[kg m^{-3}] (\rho_a)$" src="form_1234.png"/></td></tr>
    <tr><td class="paramname">alvisg</td><td>Visible albedo of ground surface [ ]</td></tr>
    <tr><td class="paramname">alnirg</td><td>Near-IR albedo of ground surface [ ]</td></tr>
    <tr><td class="paramname">crib</td><td>Richardson number coefficient <img class="formulaInl" alt="$[K^{-1}]$" src="form_1741.png"/></td></tr>
    <tr><td class="paramname">cphch</td><td>Latent heat of vaporization at surface <img class="formulaInl" alt="$[J kg^{-1}]$" src="form_1539.png"/></td></tr>
    <tr><td class="paramname">cevap</td><td>Soil evaporation efficiency coefficient <img class="formulaInl" alt="$[ ] (\beta)$" src="form_1556.png"/></td></tr>
    <tr><td class="paramname">tvirta</td><td>Virtual potential temperature of air at reference height [K]</td></tr>
    <tr><td class="paramname">zosclh</td><td>Ratio of roughness length for heat to reference height for temperature and humidity [ ]</td></tr>
    <tr><td class="paramname">zosclm</td><td>Ratio of roughness length for momentum to reference height for wind speed [ ]</td></tr>
    <tr><td class="paramname">zrslfh</td><td>Difference between reference height for temperature and humidity and height at which extrapolated wind speed goes to zero [m]</td></tr>
    <tr><td class="paramname">zrslfm</td><td>Difference between reference height for wind speed and height at which extrapolated wind speed goes to zero [m]</td></tr>
    <tr><td class="paramname">zoh</td><td>Surface roughness length for heat [m]</td></tr>
    <tr><td class="paramname">zom</td><td>Surface roughness length for momentum [m]</td></tr>
    <tr><td class="paramname">gconst</td><td>Intercept used in equation relating surface heat flux to surface temperature <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">gcoeff</td><td>Multiplier used in equation relating surface heat flux to surface temperature <img class="formulaInl" alt="$[W m^{-2} K^{-1}]$" src="form_1530.png"/></td></tr>
    <tr><td class="paramname">tstart</td><td>Starting point for surface temperature iteration [K]</td></tr>
    <tr><td class="paramname">fcor</td><td>Coriolis parameter <img class="formulaInl" alt="$[s^{-1}]$" src="form_1742.png"/></td></tr>
    <tr><td class="paramname">pcpr</td><td>Surface precipitation rate <img class="formulaInl" alt="$[kg m^{-2} s^{-1}]$" src="form_779.png"/></td></tr>
    <tr><td class="paramname">iwater</td><td>Flag indicating condition of surface (dry, water-covered or snow-covered)</td></tr>
    <tr><td class="paramname">ievap</td><td>Flag indicating whether surface evaporation is occurring or not</td></tr>
    <tr><td class="paramname">iterct</td><td>Counter of number of iterations required to solve energy balance for four subareas</td></tr>
    <tr><td class="paramname">isand</td><td>Sand content flag </td></tr>
  </table>
  </dd>
</dl>
<p>For the surface temperature iteration, two alternative schemes are offered: the bisection method (selected if the flag ITG = 1) and the Newton-Raphson method (selected if ITG = 2). In the first case, the maximum number of iterations ITERMX is set to 12, and in the second case it is set to 5. An optional windless transfer coefficient EZERO is available, which can be used, following the recommendations of Brown et al. (2006), to prevent the sensible heat flux over snow packs from becoming vanishingly small under highly stable conditions. If the snow cover flag ISNOW is zero (indicating bare ground), EZERO is set to zero; if ISNOW=1, EZERO is set to <img class="formulaInl" alt="$2.0 W m^{-2} K^{-1}$" src="form_1597.png"/>.</p>
<p>FLAG: this comment below likely needs updating!</p>
<p>In the beginning loop, some preliminary calculations are done. The shortwave transmissivity at the surface, TRTOP, is set to zero in the absence of a snow pack, and to the transmissivity of snow TRSNOW otherwise. The net shortwave radiation at the surface, QSWNET, is calculated as the sum of the incoming visible and near-infrared shortwave radiation, weighted according to one minus their respective albedos. This average value is corrected for the amount of radiation transmitted into the surface, obtained using TRTOP. The initial value of the surface temperature TZERO is set to TSTART, which contains the value of TZERO from the previous time step, and the first step in the iteration sequence, TSTEP, is set to 1.0 K. The flag ITER is set to 1 for each element of the set of modelled areas, indicating that its surface temperature has not yet been found. The iteration counter NITER is initialized to 1 for each element. Initial values are assigned to several other variables.</p>
<p>The 100 continuation line marks the beginning of the surface temperature iteration sequence. First the flags NIT (indicating that there are still locations at the beginning of the current iteration step for which the surface temperature has not yet been found) and NUMIT (indicating that there are still locations at the end of the current iteration step for which the surface temperature has not yet been found) are set to zero. Loop 150 is then performed over the set of modelled areas. If ITER=1, NIT is incremented by one, and the initial value of the surface transfer coefficient CFLUXM for this iteration pass is set to its value from the previous pass. The virtual temperature at the surface, <img class="formulaInl" alt="$T(0)_v$" src="form_1662.png"/>, is obtained using the standard expression (see documentation for subroutine CLASST):</p>
<p><img class="formulaInl" alt="$T(0)_v = T(0) [1 + 0.61 q(0)]$" src="form_1743.png"/></p>
<p>where T(0) is the surface temperature and q(0) is the specific humidity at the surface. The surface humidity can be obtained from the saturated specific humidity <img class="formulaInl" alt="$q(0)_{sat}$" src="form_1626.png"/> by making use of the definition of the surface evaporation efficiency <img class="formulaInl" alt="$\beta$" src="form_18.png"/>:</p>
<p><img class="formulaInl" alt="$\beta = [q(0) – q_a]/[q(0)_{sat} - q_a]$" src="form_1744.png"/></p>
<p>where <img class="formulaInl" alt="$q_a$" src="form_1243.png"/> is the specific humidity of the air at the reference height. This expression is inverted to obtain an expression for q(0). The saturated specific humidity <img class="formulaInl" alt="$q(0)_{sat}$" src="form_1626.png"/> is determined from the mixing ratio at saturation, <img class="formulaInl" alt="$w(0)_{sat}$" src="form_1745.png"/>:</p>
<p><img class="formulaInl" alt="$q(0)_{sat} = w(0)_{sat}/[1 + w(0)_{sat}]$" src="form_1746.png"/></p>
<p>The saturation mixing ratio is a function of the saturation vapour pressure <img class="formulaInl" alt="$e(0)_{sat}$" src="form_1747.png"/> at the surface:</p>
<p><img class="formulaInl" alt="$w(0)_{sat} = 0.622 e(0)_{sat}/(p_{dry})$" src="form_1748.png"/></p>
<p>where <img class="formulaInl" alt="$p_{dry}$" src="form_1248.png"/> is the partial pressure of dry air. A standard empirical equation for the saturation vapour pressure dependence on the temperature T is used:</p>
<p><img class="formulaInl" alt="$e_{sat} = 611.0 exp[17.269 (T – T_f)/(T – 35.86)] T \geq T_f$" src="form_1749.png"/> <img class="formulaInl" alt="$e_{sat} = 611.0 exp[21.874 (T – T_f)/(T – 7.66)] T < T_f$" src="form_1750.png"/></p>
<p>where <img class="formulaInl" alt="$T_f$" src="form_1245.png"/> is the freezing point. If there is a snow cover or ponded water present on the surface (IWATER &gt; 0), the surface evaporation efficiency EVBETA is set to 1 and q(0) is set to <img class="formulaInl" alt="$q(0)_{sat}$" src="form_1626.png"/>. Otherwise EVBETA is set to CEVAP, the value obtained in subroutine TPREP on the basis of ambient conditions, and q(0) is calculated as above. If <img class="formulaInl" alt="$q(0) > q_a$" src="form_1751.png"/> and the evaporation flag IEVAP has been set to zero, EVBETA is reset to zero and q(0) is reset to <img class="formulaInl" alt="$q_a$" src="form_1243.png"/>. Finally, <img class="formulaInl" alt="$T(0)_v$" src="form_1662.png"/> is determined using the equation above.</p>
<p>If NIT &gt; 0, a subroutine is called to evaluate the stability- corrected surface drag coefficients for heat and momentum. The subroutine selection is made on the basis of the flag ISLFD. If ISLFD=1, indicating that the calculations are to be consistent with CCCma conventions, subroutine DRCOEF is called; if ISLFD=2, indicating that the calculations are to be consistent with RPN conventions, subroutine FLXSURFZ is called.</p>
<p>In loop 175, the terms of the surface energy balance are evaluated. The energy balance equation is written as:</p>
<p><img class="formulaInl" alt="$K_* + L_* - Q_H – Q_E – G(0) = 0$" src="form_1752.png"/></p>
<p>where <img class="formulaInl" alt="$K_*$" src="form_1394.png"/> is the net shortwave radiation, <img class="formulaInl" alt="$L_*$" src="form_1395.png"/> is the net longwave radiation, <img class="formulaInl" alt="$Q_H$" src="form_1396.png"/> is the sensible heat flux, <img class="formulaInl" alt="$Q_E$" src="form_1397.png"/> is the latent heat flux, and G(0) is the conduction into the surface. <img class="formulaInl" alt="$K_*$" src="form_1394.png"/> was evaluated earlier in loop 50. <img class="formulaInl" alt="$L_*$" src="form_1395.png"/> is obtained as the difference between the downwelling radiation <img class="formulaInl" alt="$L \downarrow$" src="form_1646.png"/> and the upwelling radiation <img class="formulaInl" alt="$L \uparrow$" src="form_1753.png"/>, which in turn is determined using the Stefan- Boltzmann equation:</p>
<p><img class="formulaInl" alt="$L \uparrow = \sigma T(0)^4$" src="form_1754.png"/></p>
<p>where <img class="formulaInl" alt="$\sigma$" src="form_16.png"/> is the Stefan-Boltzmann constant. (It is assumed that natural surfaces, because of their radiative complexity, act as effective black bodies, so that their emissivity can be taken to be 1.) The sensible heat flux is given by</p>
<p><img class="formulaInl" alt="$Q_H = [\rho_a c_p C_{DH} v_a + \epsilon_0] [T(0) – T_{a,pot}]$" src="form_1755.png"/></p>
<p>where <img class="formulaInl" alt="$\rho_a$" src="form_1322.png"/> is the density of the air, <img class="formulaInl" alt="$c_p$" src="form_1276.png"/> is its specific heat, <img class="formulaInl" alt="$C_{DH}$" src="form_1318.png"/> is the surface drag coefficient for heat, and <img class="formulaInl" alt="$v_a$" src="form_1259.png"/> and <img class="formulaInl" alt="$T_{a,pot}$" src="form_1274.png"/> are the wind speed and potential temperature respectively at the reference height. (Note in the code that the variable CFLUX, evaluated in subroutine DRCOEF or FLXSURFZ, represents the product of <img class="formulaInl" alt="$C_{DH}$" src="form_1318.png"/> and <img class="formulaInl" alt="$v_a$" src="form_1259.png"/>.) The windless transfer coefficient <img class="formulaInl" alt="$\epsilon_0$" src="form_1767.png"/>, evaluated at the beginning of the subroutine, is used only under stable conditions, i.e. if <img class="formulaInl" alt="$T(0) < T_{a,pot}$" src="form_1768.png"/>. The evaporation rate at the surface, E(0), is calculated as</p>
<p><img class="formulaInl" alt="$E(0) = \rho_a C_{DH} v_a [Q(0) – q_a]$" src="form_1769.png"/></p>
<p><img class="formulaInl" alt="$Q_E$" src="form_1397.png"/> is obtained by multiplying E(0) by the latent heat of vaporization at the surface. The ground heat flux G(0) is determined as a linear function of T(0) (see documentation for subroutines TNPREP and TSPREP). It can be seen that each of the terms of the surface energy balance is a function of a single unknown, T(0) or TZERO. The residual RESID of the energy balance is now evaluated on the basis of the current estimation for TZERO. If the absolute value of RESID is less than <img class="formulaInl" alt="$5.0 W m^{-2}$" src="form_1652.png"/>, or if the absolute value of the iteration step TSTEP most recently used is less than 0.01 K, the surface temperature is deemed to have been found and ITER is set to 0. If the iteration counter NITER is equal to the maximum number and ITER is still 1, ITER is set to -1.</p>
<p>In the following section, the iteration sequence is moved ahead a step. If ITG = 1, then if NIT &gt; 0 and if ITER for the array element in question is 1, the calculations for the bisection method of solution are performed. If NITER = 1 (indicating that this is the first step in the iteration), then if RESID &gt; 0 (indicating that the current value for TZERO had undershot the correct value), TZERO is incremented by 1 K; otherwise it is decremented by 1 K. If this is not the first step in the iteration, then if RESID &gt;0 and TSTEP &lt; 0 (indicating that TZERO has undershot the correct value and the last temperature increment had been a negative one) or if RESID &lt; 0 and TSTEP &gt; 0 (indicating that TZERO has overshot the correct value and the last temperature increment had been a positive one), TSTEP is divided in half and its sign changed. TSTEP is then added to TZERO. The iteration counter NITER and the flag NUMIT are each incremented by one. The next loop contains an optional set of print statements that are executed if ITER=-1, that is if a solution for the surface temperature has not been found within the prescribed maximum number of iteration steps. Finally, if NUMIT &gt; 0, the iteration cycle is repeated from line 100 on.</p>
<p>If ITG = 2, then if NIT &gt; 0 and if ITER for the array element in question is 1, the calculations for the Newton-Raphson method of iteration are performed. In this approach, the value <img class="formulaInl" alt="$x_{n+1}$" src="form_1653.png"/> used at each iteration step is obtained from the value <img class="formulaInl" alt="$x_n$" src="form_1654.png"/> at the previous step as follows:</p>
<p><img class="formulaInl" alt="$x_{n+1} = x_n – f(x_n)/f'(x_n)$" src="form_1761.png"/></p>
<p>Identifying <img class="formulaInl" alt="$x_n$" src="form_1654.png"/> with TZERO and <img class="formulaInl" alt="$f(x_n)$" src="form_1762.png"/> with the surface energy balance equation, it can be seen that the second term on the right-hand side corresponds to TSTEP; the numerator is equal to RESID and the denominator to the first derivative of the energy balance equation evaluated at TZERO, which in turn is equal to the sum of the derivatives of the individual terms:</p>
<p><img class="formulaInl" alt="$d( L \uparrow )/dT = -4 \sigma T(0)^3$" src="form_1763.png"/></p>
<p><img class="formulaInl" alt="$d(Q_H)/dT = \rho_a c_p {C_{DH} v_a + [T(0) – T_{a,pot}] d(C_{DH} v_a)/dT}$" src="form_1764.png"/></p>
<p><img class="formulaInl" alt="$d(Q_E)/dT = L_v \rho_a{C_{DH} v_a dq(0)/dT+ [q(0) – q_a] d(C_{DH} v_a)/dT}$" src="form_1765.png"/></p>
<p>and dG(0)/dT is equal to the coefficient multiplying TZERO in the equation for G(0). ( <img class="formulaInl" alt="$L_v$" src="form_1502.png"/> is the latent heat of vaporization at the surface.) At the end of the calculations the iteration counter NITER and the flag NUMIT are each incremented by one, and upon exiting the loop, if NUMIT &gt; 0, the iteration cycle is repeated from line 100 on.</p>
<p>After the iteration has been completed, NUMIT is reset to zero and a check is carried out to ascertain whether convergence has not been reached (i.e. whether ITER = -1) for any location. In such cases it is assumed that conditions of near-neutral stability at the surface are the cause of the difficulty in finding a solution. A trial value of TZERO is calculated using the virtual potential temperature of the air. If RESID &gt; <img class="formulaInl" alt="$50 W m^{-2}$" src="form_1766.png"/>, TZERO is set to this trial value. The values of q(0) and the components of the surface energy balance are recalculated as above, except that <img class="formulaInl" alt="$Q_H$" src="form_1396.png"/> and <img class="formulaInl" alt="$Q_E$" src="form_1397.png"/> are assumed as a first approximation to be zero. RESID is determined on this basis. If RESID is positive, it is assigned to <img class="formulaInl" alt="$Q_E$" src="form_1397.png"/>; otherwise RESID is divided equally between <img class="formulaInl" alt="$Q_H$" src="form_1396.png"/> and <img class="formulaInl" alt="$Q_E$" src="form_1397.png"/>, except in the case of an absolutely dry surface, in which case <img class="formulaInl" alt="$Q_E$" src="form_1397.png"/> is set to zero and <img class="formulaInl" alt="$Q_H$" src="form_1396.png"/> to RESID. RESID is reset to zero, E(0) is obtained from <img class="formulaInl" alt="$Q_E$" src="form_1397.png"/>, and <img class="formulaInl" alt="$T(0)_v$" src="form_1662.png"/> is recalculated. The flag JEVAP for the location is set to 1, and NUMIT is incremented by 1. If NUMIT &gt; 0 at the end of this loop, DRCOEF or FLXSURF are called again, and their calculations are performed for any location where JEVAP is 1, to ensure consistency with the new surface temperature and humidity.</p>
<p>At this point a check is performed for unphysical values of the surface temperature, i.e. for values greater than 100 C or less than -100 C. If such values are encountered, an error message is printed and a call to abort is carried out.</p>
<p>Finally, a check is performed to ensure that TZERO is not less than 0 C if ponded water is present on the surface (IWATER = 1) or greater than 0 C if snow is present on the surface (IWATER = 2), or greater than zero if the surface is an ice sheet (ISAND = -4). If any of these cases is true, TZERO is reset to the freezing point, and q(0) and <img class="formulaInl" alt="$T(0)_v$" src="form_1662.png"/> are recalculated. DRCOEF or FLXSURFZ are called, and their calculations are performed for all locations meeting these criteria. The components of the surface energy balance are recalculated; the residual amount is assigned to the energy associated with phase change of water at the surface, QMELT, and RESID is set to zero. If QMELT &lt; 0, i.e. if there is freezing taking place, the evaporation flux QEVAP is added to it and then reset to zero (since if ponded water is freezing, it is unavailable for evaporation).</p>
<p>In the last half of the loop, some final adjustments are made to a few variables. If the evaporation flux is vanishingly small, it is added to RESID and reset to zero. If an anomalous case has arisen in which QMELT &lt; 0 over a snow-covered surface or QMELT &gt; 0 over a snow-free surface, QMELT is added to the heat flux into the surface and then reset to zero. Any remaining residual flux is added to <img class="formulaInl" alt="$Q_H$" src="form_1396.png"/>. The shortwave radiation transmitted into the surface is added back to the net shortwave radiation for diagnostic purposes. The surface vapour flux is converted into units of <img class="formulaInl" alt="$m s^{-1}$" src="form_1730.png"/>. Lastly, the iteration counter ITERCT is updated for the level corresponding to the subarea type and the value of NITER.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Sep 19 2016 10:13:37 for CLASS-CTEM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
