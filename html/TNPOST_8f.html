<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>CLASS-CTEM: TNPOST.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CLASS-CTEM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">TNPOST.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Purpose: Soil heat flux calculations and cleanup after surface energy budget calculations.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a1d7de0e4ebe964e4c638efcb49b3c740"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="TNPOST_8f.html#a1d7de0e4ebe964e4c638efcb49b3c740">tnpost</a> (TBARPR, G12, G23, TPOND, GZERO, QFREZG, GCONST, GCOEFF, TBAR, TCTOP, TCBOT, HCP, ZPOND, TSURF, TBASE, TBAR1P, A1, A2, B1, B2, C2, FI, IWATER, ISAND, DELZ, DELZW, ILG, IL1, IL2, JL, IG)</td></tr>
<tr class="separator:a1d7de0e4ebe964e4c638efcb49b3c740"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Purpose: Soil heat flux calculations and cleanup after surface energy budget calculations. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="a1d7de0e4ebe964e4c638efcb49b3c740"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine tnpost </td>
          <td>(</td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>TBARPR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>G12</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>G23</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TPOND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>GZERO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>QFREZG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCONST</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCOEFF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg,ig)&#160;</td>
          <td class="paramname"><em>TBAR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>TCTOP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>TCBOT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg,ig)&#160;</td>
          <td class="paramname"><em>HCP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>ZPOND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TSURF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TBASE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>TBAR1P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>A1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>A2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>B1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>B2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>C2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>FI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg)&#160;</td>
          <td class="paramname"><em>IWATER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>ISAND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ig)&#160;</td>
          <td class="paramname"><em>DELZ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>DELZW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ILG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>JL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IG</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tbarpr</td><td>Temperatures of soil layers for subarea [C]</td></tr>
    <tr><td class="paramname">g12</td><td>Heat conduction between first and second soil layers <img class="formulaInl" alt="$[W m^{-2}] (G(\Delta z))$" src="form_1427.png"/></td></tr>
    <tr><td class="paramname">g23</td><td>Heat conduction between second and third soil layers <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">tpond</td><td>Temperature of ponded water <img class="formulaInl" alt="$[C] (T_p)$" src="form_1509.png"/></td></tr>
    <tr><td class="paramname">gzero</td><td>Heat conduction into soil surface <img class="formulaInl" alt="$[W m^{-2}] (G(0))$" src="form_1430.png"/></td></tr>
    <tr><td class="paramname">qfrezg</td><td>Energy sink to be applied to freezing of ponded water <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">tbar</td><td>Temperatures of soil layers, averaged over modelled area [K]</td></tr>
    <tr><td class="paramname">tctop</td><td>Thermal conductivity of soil at top of layer <img class="formulaInl" alt="$[W m^{-1} K^{-1}] (\lambda)$" src="form_1527.png"/></td></tr>
    <tr><td class="paramname">tcbot</td><td>Thermal conductivity of soil at bottom of layer <img class="formulaInl" alt="$[W m^{-1} K^{-1}] (\lambda)$" src="form_1527.png"/></td></tr>
    <tr><td class="paramname">hcp</td><td>Heat capacity of soil layer <img class="formulaInl" alt="$[J m^{-3} K^{-1}]$" src="form_812.png"/></td></tr>
    <tr><td class="paramname">delzw</td><td>Permeable thickness of soil layer [m]</td></tr>
    <tr><td class="paramname">zpond</td><td>Depth of ponded water on surface <img class="formulaInl" alt="$[m] (\Delta z_p)$" src="form_1528.png"/></td></tr>
    <tr><td class="paramname">tsurf</td><td>Ground surface temperature [K]</td></tr>
    <tr><td class="paramname">tbase</td><td>Temperature of bedrock in third soil layer [K]</td></tr>
    <tr><td class="paramname">tbar1p</td><td>Lumped temperature of ponded water and first soil layer <img class="formulaInl" alt="$[K] (T_{1p})$" src="form_1529.png"/></td></tr>
    <tr><td class="paramname">a1</td><td>Work array used in calculation of GCONST and GCOEFF</td></tr>
    <tr><td class="paramname">a2</td><td>Work array used in calculation of GCONST and GCOEFF</td></tr>
    <tr><td class="paramname">b1</td><td>Work array used in calculation of GCONST and GCOEFF</td></tr>
    <tr><td class="paramname">b2</td><td>Work array used in calculation of GCONST and GCOEFF</td></tr>
    <tr><td class="paramname">c2</td><td>Work array used in calculation of GCONST and GCOEFF</td></tr>
    <tr><td class="paramname">fi</td><td>Fractional coverage of subarea in question on modelled area [ ]</td></tr>
    <tr><td class="paramname">gconst</td><td>Intercept used in equation relating ground surface heat flux to surface temperature <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">gcoeff</td><td>Multiplier used in equation relating ground surface heat flux to surface temperature <img class="formulaInl" alt="$[W m^{-2} K^{-1}]$" src="form_1530.png"/></td></tr>
    <tr><td class="paramname">iwater</td><td>Flag indicating condition of surface (dry, water-covered or snow-covered)</td></tr>
    <tr><td class="paramname">isand</td><td>Sand content flag</td></tr>
    <tr><td class="paramname">delz</td><td>Overall thickness of soil layer <img class="formulaInl" alt="$[m] (\Delta z)$" src="form_1433.png"/> </td></tr>
  </table>
  </dd>
</dl>
<p>In the 100 loop, the heat flux into the ground (without adjustments that may have been applied owing to phase changes of water at the surface or partitioning the residual of the surface energy balance among the surface flux terms) is calculated from the ground surface temperature TSURF, using the GCOEFF and GCONST terms (see documentation of subroutine TNPREP). This flux is then used to back-calculate the heat conduction between the first and second, and the second and third soil layers.</p>
<p>If the depth of water ponded on the surface is greater than zero, the total thickness of the lumped layer consisting of the first soil layer and the ponded water, <img class="formulaInl" alt="$\Delta z_{1p}$" src="form_1531.png"/>, is calculated as the sum of the two depths. The temperature of the ponded water over the subarea in question is disaggregated from the temperature of the lumped layer, <img class="formulaInl" alt="$T_{1p}$" src="form_1532.png"/>, by making use of the calculated heat fluxes at the top and bottom of the layer, and the assumption (discussed in the documentation of subroutine TNPREP) that that the variation of temperature T with depth z within a soil layer can be modelled using a quadratic equation:</p>
<p><img class="formulaInl" alt="$T(z) = 1/2 T''(0)z^2 + T'(0)z +T(0)$" src="form_1533.png"/></p>
<p>Integrating this equation separately over the ponded water depth <img class="formulaInl" alt="$\Delta z_p$" src="form_1534.png"/> and over the thickness of the lumped layer produces expressions for the ponded water temperature <img class="formulaInl" alt="$T_p$" src="form_1535.png"/> and the temperature of the lumped layer. Making use of the fact that</p>
<p><img class="formulaInl" alt="$T''(0) = [T'(\Delta z) - T'(0)]/\Delta z$" src="form_1536.png"/></p>
<p>where <img class="formulaInl" alt="$\Delta z$" src="form_600.png"/> is a depth interval, and</p>
<p><img class="formulaInl" alt="$G(z) = - \lambda(z)T'(z)$" src="form_1537.png"/> where <img class="formulaInl" alt="$\lambda$" src="form_11.png"/> represents the thermal conductivity, an expression for <img class="formulaInl" alt="$T_p$" src="form_1535.png"/> can be derived:</p>
<p><img class="formulaInl" alt="$T_p = [G(0)/ \lambda(0) – G(\Delta z_{1p})/ \lambda(\Delta z_{1p})] [\Delta z_p^2 - \Delta z_{1p}^2]/ 6 \Delta z_{1p} – G(0) [\Delta z_p - \Delta z_{1p}]/ 2 \lambda(0) – T_{1P}$" src="form_1538.png"/></p>
<p>The temperature TBARPR of the first soil layer over the subarea in question can then be obtained by disaggregating the ponded water temperature from the lumped layer temperature using the respective heat capacities of the ponded water and the soil layer. (The heat capacity of the soil is determined as the weighted average of HCP over the permeable thickness DELZW, and the heat capacity of rock, HCPSND, over the impermeable thickness, DELZ-DELZW.) Both the ponded water temperature and the soil layer temperature are converted to C. Lastly, if there is ponded water on the surface (IWATER = 1) and QFREZG, the surface energy available for phase change of water, is positive (indicating an energy source), or if there is snow on the ground (IWATER = 2) and QFREZG is negative (indicating an energy sink), or if there is no liquid or frozen water on the surface (IWATER = 0), QFREZG is added to the heat flux into the ground, GZERO, and then reset to zero.</p>
<p>In loop 200, the subarea soil layer temperatures TBARPR are set for the remaining soil layers. In all cases the temperature of the layer is set to that for the modelled area, TBAR, converted to C, except in the case of the third soil layer if the standard three-layer configuration is being modelled (with a very thick third soil layer of 3.75 m). In this case TBARPR and the layer heat capacity HCP are considered to apply to the permeable depth DELZW of the layer, and the bedrock temperature TBASE and the rock heat capacity HCPSND apply to the remainder, DELZ-DELZW. The disaggregation of TBARPR from TBAR and TBASE is carried out on this basis. TBARPR for this layer is also converted to C.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="TNPOST_8f_a1d7de0e4ebe964e4c638efcb49b3c740_icgraph.png" border="0" usemap="#TNPOST_8f_a1d7de0e4ebe964e4c638efcb49b3c740_icgraph" alt=""/></div>
<!-- MAP 0 -->
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 5 2017 11:23:11 for CLASS-CTEM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
