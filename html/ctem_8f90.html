<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>CLASS-CTEM Documentation: ctem.f90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CLASS-CTEM Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">ctem.f90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The basic model structure of CTEM includes three live vegetation components (leaf (L), stem (S) and root (R)) and two dead carbon pools (litter or detritus (D) and soil carbon (H)). The amount of carbon in these pools ( <img class="formulaInl" alt="$C_\mathrm{L}$" src="form_938.png"/>, <img class="formulaInl" alt="$C_\mathrm{S}$" src="form_939.png"/>, <img class="formulaInl" alt="$C_\mathrm{R}$" src="form_940.png"/>, <img class="formulaInl" alt="$C_\mathrm{D}$" src="form_941.png"/>, <img class="formulaInl" alt="$C_\mathrm{H}$" src="form_942.png"/>, <img class="formulaInl" alt="$kgC m^{-2}$" src="form_29.png"/>) is tracked prognostically through the fluxes in and out of them. The rate change equations for carbon in these pools are summarized in Sect. rate_change_eqns} after the processes leading to the calculation of fluxes in and out of these pools are introduced in the following sections.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ad0e785d83405070bbea8895c615e7f69"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ctem_8f90.html#ad0e785d83405070bbea8895c615e7f69">ctem</a> (fcancmx,fsnow,sand,clay,il1,il2,iday,radj,tcano,tcans,tbarc,tbarcs,tbarg,tbargs,ta,delzw,ancsveg,ancgveg, rmlcsveg,rmlcgveg,zbotw,thliqc,thliqg,deltat,uwind,vwind,lightng,prbfrhuc,extnprob,stdaln,tbar,popdon,nol2pfts, pfcancmx, nfcancmx,lnduseon,thicec, soildpth, spinfast,todfrac,compete,netrad,precip,grclarea,popdin, dofire,dowetlands, obswetf, isand,faregat, onetile_perPFT, wetfrac, slopefrac,currlat,THP,BI,PSIS,ch4conc,GRAV,RHOW,RHOICE,</td></tr>
<tr class="separator:ad0e785d83405070bbea8895c615e7f69"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The basic model structure of CTEM includes three live vegetation components (leaf (L), stem (S) and root (R)) and two dead carbon pools (litter or detritus (D) and soil carbon (H)). The amount of carbon in these pools ( <img class="formulaInl" alt="$C_\mathrm{L}$" src="form_938.png"/>, <img class="formulaInl" alt="$C_\mathrm{S}$" src="form_939.png"/>, <img class="formulaInl" alt="$C_\mathrm{R}$" src="form_940.png"/>, <img class="formulaInl" alt="$C_\mathrm{D}$" src="form_941.png"/>, <img class="formulaInl" alt="$C_\mathrm{H}$" src="form_942.png"/>, <img class="formulaInl" alt="$kgC m^{-2}$" src="form_29.png"/>) is tracked prognostically through the fluxes in and out of them. The rate change equations for carbon in these pools are summarized in Sect. rate_change_eqns} after the processes leading to the calculation of fluxes in and out of these pools are introduced in the following sections. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="ad0e785d83405070bbea8895c615e7f69"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine ctem </td>
          <td>(</td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>fcancmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>fsnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>sand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>clay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>iday</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>radj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>tcano</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>tcans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>tbarc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>tbarcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>tbarg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>tbargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>delzw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>ancsveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>ancgveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>rmlcsveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>rmlcgveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>zbotw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>thliqc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>thliqg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>deltat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>uwind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>vwind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>lightng</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>prbfrhuc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(inout)&#160;</td>
          <td class="paramname"><em>extnprob</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>stdaln</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>tbar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(inout)&#160;</td>
          <td class="paramname"><em>popdon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ican)&#160;</td>
          <td class="paramname"><em>nol2pfts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>pfcancmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>nfcancmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>lnduseon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>thicec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>soildpth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>spinfast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>todfrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>compete</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>netrad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>precip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>grclarea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(inout)&#160;</td>
          <td class="paramname"><em>popdin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>dofire</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>dowetlands</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>obswetf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>isand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>faregat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>onetile_perPFT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>wetfrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,8), intent(in)&#160;</td>
          <td class="paramname"><em>slopefrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>currlat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>THP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>BI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd), intent(in)&#160;</td>
          <td class="paramname"><em>PSIS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(in)&#160;</td>
          <td class="paramname"><em>ch4conc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>GRAV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>RHOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>RHOICE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">lnduseon</td><td>logical switch to run the land use change subroutine or not.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">compete</td><td>logical boolean telling if competition between pfts is on or not</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dofire</td><td>boolean, if true allow fire, if false no fire.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dowetlands</td><td>if true allow wetland methane emission</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">obswetf</td><td>if true, use read-in observed wetland fraction</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">onetile_perpft</td><td>if you are running with one tile per PFT in mosaic mode, set to true. Changes how competition is run. Specifically it allows competition between tiles. This is not recommended for any case where you don't have one PFT in each tile as it has not been tested for that.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iday</td><td>day of year</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spinfast</td><td>spinup factor for soil carbon whose default value is 1. as this factor increases the soil c pool will come into equilibrium faster. reasonable value for spinfast is between 5 and 10. when spinfast.ne.1 then the balcar subroutine is not run.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il1</td><td>il1=1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il2</td><td>il2=ilg (no. of grid cells in latitude circle)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fsnow</td><td>fraction of snow simulated by class</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sand</td><td>percentage sand</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">clay</td><td>percentage clay</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">radj</td><td>latitude in radians</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tcano</td><td>canopy temperature for canopy over ground subarea, K</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tcans</td><td>canopy temperature for canopy over snow subarea, K</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tbar</td><td>soil temperature, k</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tbarc</td><td>soil temperature for canopy over ground subarea, K</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tbarcs</td><td>soil temperature for canopy over snow subarea</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tbarg</td><td>soil temperature for ground subarea</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tbargs</td><td>soil temperature for snow over ground subarea</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thicec</td><td>frozen mois. content of 3 soil layers, for canopy over snow and canopy over ground subareas</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ta</td><td>air temp, K</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">delzw</td><td>thicknesses of the 3 soil layers</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zbotw</td><td>bottom of soil layers</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">soildpth</td><td>soil depth (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thliqc</td><td>liquid mois. content of 3 soil layers, for canopy over snow and canopy over ground subareas</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thliqg</td><td>liquid mois. content of 3 soil layers, for ground and snow over ground subareas</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">deltat</td><td>CTEM timestep in days</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grclarea</td><td>area of the grid cell, <img class="formulaInl" alt="$km^2$" src="form_509.png"/></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">currlat</td><td>centre latitude of grid cells in degrees</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uwind</td><td>u wind speed, m/s</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vwind</td><td>v wind speed, m/s</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">precip</td><td>daily precipitation (mm/day)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">netrad</td><td>daily net radiation (w/m2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lightng</td><td>total lightning frequency, flashes/km2.year</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">prbfrhuc</td><td>probability of fire due to human causes</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thp</td><td>Total porosity <img class="formulaInl" alt="$(cm^3 cm^{-3})$" src="form_1503.png"/> - daily average</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bi</td><td>Clapp and Hornberger b-term (-)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">psis</td><td>Soil moisture suction at saturation (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pfcancmx</td><td>previous year's fractional coverages of pfts</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nfcancmx</td><td>next year's fractional coverages of pfts</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">todfrac</td><td>max. fractional coverage of ctem's 9 pfts by the end of the day, for use by land use subroutine</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ch4conc</td><td>Atmospheric <img class="formulaInl" alt="$CH_4$" src="form_532.png"/> concentration at the soil surface (ppmv)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stdaln</td><td>an integer telling if ctem is operated within gcm (=0) or in stand alone mode (=1). this is used for fire purposes. see comments just above where disturb subroutine is called.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grav</td><td>Acceleration due to gravity ($m s^{-1} ), (CLASS param) passed in to avoid the common block structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhow</td><td>Density of water ($kg m^{-3}), (CLASS param) passed in to avoid the common block structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhoice</td><td>Density of ice ($kg m^{-3}), (CLASS param) passed in to avoid the common block structure.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">popdon</td><td>if set true use population density data to calculate fire extinguishing probability and probability of fire due to human causes, or if false, read directly from .ctm file</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ancsveg</td><td>net photosynthetic rate for ctems 9 pfts for canopy over snow subarea</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ancgveg</td><td>net photosynthetic rate for ctems 9 pfts for canopy over ground subarea</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rmlcsveg</td><td>leaf respiration rate for ctems 9 pfts forcanopy over snow subarea</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rmlcgveg</td><td>leaf respiration rate for ctems 9 pfts forcanopy over ground subarea</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">extnprob</td><td>fire extingusinging probability</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fcancmx</td><td>max. fractional coverage of ctem's 9 pfts, but this can be modified by land-use change, and competition between pfts</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">popdin</td><td>population density <img class="formulaInl" alt="$(people / km^2)$" src="form_617.png"/></td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nol2pfts</td><td>number of level 2 ctem pfts </td></tr>
  </table>
  </dd>
</dl>
<hr/>
 <h2>Constants and parameters are located in <a class="el" href="ctem__params_8f90.html" title="This module holds CTEM globally accessible parameters These parameters are used in all CTEM subroutin...">ctem_params.f90</a> </h2>
<p>Begin calculations</p>
<p>Generate the sort index for correspondence between 9 pfts and the 12 values in the parameter vectors</p>
<p>If you intend to have competition and LUC between tiles then set onetile_perPFT to true. NOTE: Turning onetile_perPFT to true is usually not the behaviour desired unless you are running with one PFT on each tile and want them to compete for space across tiles. So in general keep this as False. JM Jan 2016.</p>
<p>this is composite/mosaic mode (in mosaic competition only occurs WITHIN a tile)</p>
<p>Calculate bioclimatic parameters for estimating pfts existence</p>
<p>If first day of year then based on updated bioclimatic parameters find if pfts can exist or not. If .not. inibioclim then it is the first year of a run that you do not have the climatological means already in the CTM file. After one year inibioclim is set to true and the climatological means are used from the first year.</p>
<p>Call competition subroutine which on the basis of previous day's npp estimates changes in fractional coverage of pfts</p>
<p>If landuse is on, then implelement luc, change fractional coverages, move biomasses around, and estimate luc related combustion emission losses.</p>
<p>Land use change and competition for mosaics needs mapping and unmapping of the pfts. Composite does not require these extra steps.</p>
<p>Check if number of mosaics is equal to the number of pfts plus one bare, e.g., nmos=iccp1</p>
<p>check for fcancmx(i,j). this should be either 0 or 1 for competition to work.</p>
<p>competition_map scatters and maps the array with indices of (ilg,icc) to (nlat,icc) for preparation for competition</p>
<p>Calculate bioclimatic parameters for estimating pfts existence</p>
<p>If first day of year then based on updated bioclimatic parameters find if pfts can exist or not. If .not. inibioclim then it is the first year of a run that you do not have the climatological means already in the CTM file. After one year inibioclim is set to true and the climatological means are used from the first year.</p>
<p>call competition subroutine which on the basis of previous day's npp estimates changes in fractional coverage of pfts</p>
<p>Competition_unmap unmaps and gathers the array with indices (nlat,icc) back to (ilg,icc) after competition is done</p>
<p>initialize required arrays to zero</p>
<p>Store green and brown leaf, stem, and root biomass, and litter and soil c pool mass in arrays. knowing initial sizes of all pools and final sizes at the end of this subroutine, we check for conservation of mass.</p>
<p>Initialization ends</p>
<p>Find fc and fcs based on fcancmx</p>
<p>Autotrophic respiration</p>
<p>Leaf respiration is calculated in phtsyn subroutine, while stem and root maintenance respiration are calculated here.</p>
<p>We treat canopy over ground and canopy over snow subareas separately because stem temperature (for which we use canopy temperature as a surrogate) can be different for these two subareas.</p>
<p>Find maintenance respiration for canopy over snow sub-area in umol co2/m2/sec</p>
<p>Find maintenance respiration for canopy over ground sub-area</p>
<p>If ailcg/gleafmas is zero, i.e. real leaves are not on, then make maintenance respiration and gpp from storage/imaginary lai equal to zero so that we don't use these numbers in carbon budget.</p>
<p>Find vegetation averaged leaf, stem, and root respiration, and gpp using values from canopy over ground and canopy over snow subareas</p>
<p>Now that we know maintenance respiration from leaf, stem, and root and gpp, we can find growth respiration for each vegetation</p>
<p>Calculate grid-averaged rates of rm, rg, npp, and gpp</p>
<p>Heterotrophic respiration</p>
<p>Find heterotrophic respiration rates (umol co2/m2/sec) for canopy over snow subarea</p>
<p>Find heterotrophic respiration rates for canopy over ground subarea</p>
<p>Find heterotrophic respiration rates from bare ground subarea</p>
<p>Find heterotrophic respiration rates from snow over ground subarea</p>
<p>Find vegetation averaged litter and soil c respiration rates using values from canopy over ground and canopy over snow subareas</p>
<p>Find litter and soil c respiration rates averaged over the bare fraction of the grid cell using values from ground and snow over ground sub-areas.</p>
<p>Find grid averaged litter and soil c respiration rates</p>
<p>Update the litter and soil c pools based on litter and soil c respiration rates found above. also transfer humidified litter to the soil c pool.</p>
<p>Convert u mol co2/m2.sec -&gt; <img class="formulaInl" alt="$kg c/m^2$" src="form_614.png"/> respired over the model time step</p>
<p>Update litter and soil c pools</p>
<p>Estimate soil respiration. this is sum of heterotrophic respiratio and root maintenance respiration.</p>
<p>But over the bare fraction there is no live root.</p>
<p>Find grid averaged humification and soil respiration rates</p>
<p>Find CH4 wetland area (if not prescribed) and emissions:</p>
<p>Calculate the methane that is oxidized by the soil sink</p>
<p>Estimate allocation fractions for leaf, stem, and root components.</p>
<p>Note: fieldsm and wiltsm are calculated in allocate. They are called THFC and PSIWLT in the CLASS part of the model. They are recalculated here in CTEM to avoid passing them through the coupler in the coupled model. The CTEM calculated versions of fieldsm and wiltsm are also used in disturb and phenolgy. JM. Jan 14 2015.</p>
<p>Estimate fraction of npp that is to be used for horizontal expansion (lambda) during the next day (i.e. this will be determining the colonization rate in competition).</p>
<p>We use the following new function to smooth the transition for lambda as an abrupt linear increase does not give good results. JM Jun 2014</p>
<p>If tree and leaves still coming out, or if npp is negative, then do not expand</p>
<p>Maintenance respiration also reduces leaf, stem, and root biomass. when npp for a given pft is positive then this is taken care by allocating +ve npp amongst the leaves, stem, and root component. when npp for a given pft is negative then maintenance respiration loss is explicitly deducted from each component.</p>
<p>Convert npp and maintenance respiration from different components from units of u mol co2/m2.sec -&gt; <img class="formulaInl" alt="$kg c/m^2$" src="form_614.png"/> sequestered or respired over the model time step (deltat)</p>
<p>Remove the cost of making reproductive tissues. This cost can only be removed when NPP is positive.</p>
<p>i.e. if lfstatus.eq.4 and since we do not have any real leaves on then we do not take into account co2 uptake by imaginary leaves in carbon budget. rmlvgstp(i,j) should be zero because we set maintenance respiration from storage/imaginary leaves equal to zero. in loop 180</p>
<p>since no real leaves are on, make allocation fractions equal to zero.</p>
<p>convert net change in leaf, stem, and root biomass into u-mol co2/m2.sec for use in balcar subroutine</p>
<p>to avoid over/underflow problems set gleafmas, stemmass, and rootmass to zero if they get too small</p>
<p>calculate grid averaged value of C related to spatial expansion</p>
<p>Phenology part starts</p>
<p>the phenology subroutine determines leaf status for each pft and calculates leaf litter. the phenology subroutine uses soil temperature (tbar) and root temperature. however, since ctem doesn't make the distinction between canopy over ground, and canopy over snow sub-areas for phenology purposes (for example, leaf onset is not assumed to occur at different times over these sub-areas) we use average soil and root temperature in the phenology subroutine.</p>
<p>calculate average soil temperature and root temperature using values for canopy over ground and canopy over snow sub-areas, for each vegetation type.</p>
<p>Call the phenology subroutine, which determines the leaf growth status, calculates leaf litter, and converts green grass into brown.</p>
<p>while leaf litter is calculated in the phenology subroutine, stem and root turnover is calculated in the turnover subroutine.</p>
<p>Update green leaf biomass for trees and crops and brown leaf biomass for grasses</p>
<p>Update stem and root biomass for litter deductions</p>
<p>Update litter pool with leaf litter calculated in the phenology subroutine and stem and root litter calculated in the turnover subroutine. Also add the reproduction carbon directly to the litter pool</p>
<p>Call the mortaliy subroutine which calculates mortality due to reduced growth and aging. exogenous mortality due to fire and other disturbances and the subsequent litter that is generated is calculated in the disturb subroutine.</p>
<p>set maxage &gt;0 in <a class="el" href="ctem__params_8f90.html" title="This module holds CTEM globally accessible parameters These parameters are used in all CTEM subroutin...">ctem_params.f90</a> to switch on mortality due to age and reduced growth. Mortality is linked to the competition parameterization and generates bare fraction.</p>
<p>Update leaf, stem, and root biomass pools to take into loss due to mortality, and put the litter into the litter pool. the mortality for green grasses doesn't generate litter, instead they turn brown.</p>
<p>call the disturbance subroutine which calculates mortality due to fire and other disturbances. the primary output from from disturbance subroutine is litter generated, c emissions due to fire and area burned, which may be used to estimate change in fractional coverages.</p>
<p>disturbance is spatial and requires area of gcm grid cell and areas of different pfts present in a given grid cell. however, when ctem is operated at a point scale then it is assumed that the spatial scale is 1 hectare = 10,000 m2. the disturbance subroutine may be stopped from simulating any fire by specifying fire extingushing probability equal to 1.</p>
<p>Calculate nbp (net biome production) for each pft by taking into account C emission losses. The disturbance routine produces emissions due to fire and it also calculates emissions due to LUC. These LUC carbon emissions due to combustion associated with LUC are first estimated in LUC. This flux is spread out over the whole year and is therefore subtracted to get NBP of each pft as well as the grid averaged value of NBP. Also LUC related combustion flux is assumed to be spread uniformly over the grid cell and thus reduces NBP of each PFT</p>
<p>Calculate grid. averaged rate of carbon emissions due to fire in u-mol co2/m2.sec. convert all emission losses from <img class="formulaInl" alt="$kg c/m^2$" src="form_614.png"/> emitted in 1 day to u-mol co2/m2.sec. calculate grid averaged carbon emission losses from litter.</p>
<p>calculate total litter fall from each component (leaves, stem, and root) from all causes (normal turnover, drought and cold stress for leaves, mortality, and disturbance) for use in balcar subroutine</p>
<p>units here are <img class="formulaInl" alt="$kg c/m^2 .day$" src="form_1400.png"/></p>
<p>convert units to u-mol co2/m2.sec</p>
<p>calculate grid-average vegetation biomass, litter mass, and soil carbon mass, and litter fall rate</p>
<p>At this stage we have all required fluxes in u-mol co2/m2.sec and initial (loop 140 and 145) and updated sizes of all pools (in <img class="formulaInl" alt="$kg c/m^2$" src="form_614.png"/>). Now we call the balcar subroutine and make sure that C in leaves, stem, root, litter and soil C pool balances within a certain tolerance.</p>
<p>Finally find vegetation structural attributes which can be passed to the land surface scheme using leaf, stem, and root biomass.</p>
<p>Calculation of gavglai is moved from loop 1100 to here since ailcg is updated by bio2str</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 31 2016 14:29:32 for CLASS-CTEM Documentation by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
