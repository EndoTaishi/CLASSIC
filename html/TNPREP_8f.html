<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>CLASS-CTEM: TNPREP.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CLASS-CTEM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">TNPREP.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Purpose: Calculate coefficients for solution of heat conduction into soil.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ab5cfd35272325655f17bcc52acb00535"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="TNPREP_8f.html#ab5cfd35272325655f17bcc52acb00535">tnprep</a> (A1, A2, B1, B2, C2, GDENOM, GCOEFF, GCONST, CPHCHG, IWATER, TBAR, TCTOP, TCBOT, FI, ZPOND, TBAR1P, DELZ, TCSNOW, ZSNOW, ISAND, ILG, IL1, IL2, JL, IG)</td></tr>
<tr class="separator:ab5cfd35272325655f17bcc52acb00535"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Purpose: Calculate coefficients for solution of heat conduction into soil. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="ab5cfd35272325655f17bcc52acb00535"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine tnprep </td>
          <td>(</td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>A1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>A2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>B1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>B2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>C2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GDENOM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCOEFF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCONST</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>CPHCHG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg)&#160;</td>
          <td class="paramname"><em>IWATER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg,ig)&#160;</td>
          <td class="paramname"><em>TBAR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>TCTOP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>TCBOT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>FI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>ZPOND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>TBAR1P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ig)&#160;</td>
          <td class="paramname"><em>DELZ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>TCSNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>ZSNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>ISAND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ILG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>JL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IG</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gdenom</td><td>Work array used in calculation of GCONST and GCOEFF</td></tr>
    <tr><td class="paramname">gcoeff</td><td>Multiplier used in equation relating ground surface heat flux to surface temperature <img class="formulaInl" alt="$[W m^{-2} K^{-1}]$" src="form_1530.png"/></td></tr>
    <tr><td class="paramname">gconst</td><td>Intercept used in equation relating ground surface heat flux to surface temperature <img class="formulaInl" alt="$[W m^{-2}]$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">cphchg</td><td>Latent heat of sublimation <img class="formulaInl" alt="$[J kg^{-1}]$" src="form_1539.png"/></td></tr>
    <tr><td class="paramname">iwater</td><td>Flag indicating condition of surface (dry, water-covered or snow-covered)</td></tr>
    <tr><td class="paramname">tbar</td><td>Temperatures of soil layers, averaged over modelled area [K]</td></tr>
    <tr><td class="paramname">tctop</td><td>Thermal conductivity of soil at top of layer <img class="formulaInl" alt="$[W m^{-1} K^{-1}] (\lambda_t)$" src="form_1540.png"/></td></tr>
    <tr><td class="paramname">tcbot</td><td>Thermal conductivity of soil at bottom of layer <img class="formulaInl" alt="$[W m^{-1} K^{-1}] (\lambda_b)$" src="form_1541.png"/></td></tr>
    <tr><td class="paramname">fi</td><td>Fractional coverage of subarea in question on modelled area [ ]</td></tr>
    <tr><td class="paramname">zpond</td><td>Depth of ponded water on surface [m]</td></tr>
    <tr><td class="paramname">tbar1p</td><td>Lumped temperature of ponded water and first soil layer [K]</td></tr>
    <tr><td class="paramname">tcsnow</td><td>Thermal conductivity of snow <img class="formulaInl" alt="$[W m^{-1} K^{-1}]$" src="form_1231.png"/></td></tr>
    <tr><td class="paramname">zsnow</td><td>Depth of snow pack [m]</td></tr>
    <tr><td class="paramname">isand</td><td>Sand content flag</td></tr>
    <tr><td class="paramname">delz</td><td>Overall thickness of soil layer <img class="formulaInl" alt="$[m] (\Delta_z)$" src="form_1379.png"/> </td></tr>
  </table>
  </dd>
</dl>
<p>In this subroutine, coefficients are derived for an equation relating the heat flux at the ground surface to the ground surface temperature, using the average temperatures and the thermal conductivities of the underlying first three soil layers. It is assumed that the variation of temperature T with depth z within each soil layer can be modelled by using a quadratic equation:</p>
<p><img class="formulaInl" alt="$T(z) = (1/2) a z^2 + b z + c$" src="form_1542.png"/></p>
<p>By substituting 0 for z in the above equation and in the expressions for its first and second derivatives, it can be shown that <img class="formulaInl" alt="$a = T''(0)$" src="form_1543.png"/>, <img class="formulaInl" alt="$b = T'(0)$" src="form_1544.png"/>, and <img class="formulaInl" alt="$c = T(0)$" src="form_1545.png"/>. The term <img class="formulaInl" alt="$T''(0)$" src="form_1546.png"/> can be evaluated from the expression for the first derivative evaluated at the bottom of the soil layer, <img class="formulaInl" alt="$T(\Delta z)$" src="form_1442.png"/>:</p>
<p><img class="formulaInl" alt="$T''(0) = [T'(\Delta z) - T'(0)]/ \Delta z$" src="form_1547.png"/></p>
<p>The temperature gradient <img class="formulaInl" alt="$T'(0)$" src="form_1548.png"/> at the top of each layer is related to the heat flux G(0) through the thermal conductivity <img class="formulaInl" alt="$\lambda_t$" src="form_1549.png"/>; and the temperature gradient and heat flux at the bottom of the layer, <img class="formulaInl" alt="$G(\Delta z)$" src="form_1443.png"/> and <img class="formulaInl" alt="$T(\Delta z)$" src="form_1442.png"/>, are similarly related through the bottom thermal conductivity <img class="formulaInl" alt="$\lambda_b$" src="form_1550.png"/>:</p>
<p><img class="formulaInl" alt="$G(0) = - \lambda_t T'(0)$" src="form_1551.png"/> <img class="formulaInl" alt="$G(\Delta z) = - \lambda_b T'(\Delta z)$" src="form_1552.png"/></p>
<p>The average soil layer temperature, <img class="formulaInl" alt="$T_{av}(\Delta z)$" src="form_1446.png"/>, can be obtained by integrating the resulting equation for T(z) between 0 and <img class="formulaInl" alt="$\Delta z$" src="form_600.png"/>. Making use of all of the above expressions, recognizing that the heat fluxes and temperatures at the bottoms of layers 1 and 2 must equal the heat fluxes and temperatures at the tops of layers 2 and 3 respectively, and neglecting as a first approximation the heat flux at the bottom of the third layer, a linear equation can be derived relating G(0) to T(0) at the soil surface, where the slope and intercept of the equation are functions only of the average temperatures, thicknesses, and top and bottom thermal conductivities of the three soil layers.</p>
<p>In the subroutine loop, first the depth corresponding to TBAR1P (the lumped temperature of the first soil layer and the ponded water) is calculated, as the sum of the first soil layer thickness and the ponded water depth. If the ponded water depth is not vanishingly small, the surface water flag IWATER is set to 1; otherwise it is set to 0 for soils and 2 for ice sheets (indicated by ISAND = -4). If IWATER = 2, indicating a frozen water surface, the latent heat of vaporization, CPHCHG, is set to the value for sublimation (by adding the latent heat of melting to the latent heat of vaporization). If there is a snow pack present, the thermal conductivity at the top of the ground surface is calculated as the harmonic mean of the thermal conductivity at the top of the first soil layer and that of the snow pack. Finally, a series of work arrays is evaluated and is used to calculate the slope and intercept, GCOEFF and GCONST, of the equation relating G(0) to T(0) at the ground surface.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 28 2016 14:59:59 for CLASS-CTEM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
