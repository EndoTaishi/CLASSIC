<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: src/TSPOST.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('TSPOST_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">TSPOST.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Snow temperature calculations and cleanup after surface energy budget calculations.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:aea20a5bd0b4d139bb0537c5e0a79788f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="TSPOST_8f.html#aea20a5bd0b4d139bb0537c5e0a79788f">tspost</a> (GSNOW, TSNOW, WSNOW, RHOSNO, QMELTG, GZERO, TSNBOT, HTCS, HMFN, GCONSTS, GCOEFFS, GCONST, GCOEFF, TBAR, TSURF, ZSNOW, TCSNOW, HCPSNO, QTRANS, FI, DELZ, ILG, IL1, IL2, JL, IG)</td></tr>
<tr class="separator:aea20a5bd0b4d139bb0537c5e0a79788f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Snow temperature calculations and cleanup after surface energy budget calculations. </p>
<dl class="section author"><dt>Author</dt><dd>D. Verseghy, M. Lazare </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="aea20a5bd0b4d139bb0537c5e0a79788f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea20a5bd0b4d139bb0537c5e0a79788f">&#9670;&nbsp;</a></span>tspost()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine tspost </td>
          <td>(</td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>GSNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TSNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>WSNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>RHOSNO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>QMELTG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>GZERO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>TSNBOT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>HTCS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>HMFN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCONSTS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCOEFFS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCONST</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>GCOEFF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>TBAR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TSURF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>ZSNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>TCSNOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>HCPSNO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>QTRANS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>FI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ig)&#160;</td>
          <td class="paramname"><em>DELZ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ILG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>JL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IG</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gzero</td><td>Heat conduction into soil surface <img class="formulaInl" alt="$[W m^{-2}] (G(\Delta z_s))$" src="form_1446.png"/></td></tr>
    <tr><td class="paramname">tsnbot</td><td>Temperature at bottom of snow pack [K]</td></tr>
    <tr><td class="paramname">gsnow</td><td>Heat conduction into surface of snow pack <img class="formulaInl" alt="$[W m^{-2}] (G(0))$" src="form_809.png"/></td></tr>
    <tr><td class="paramname">tsnow</td><td>Snowpack temperature <img class="formulaInl" alt="$[K/C] (T_s)$" src="form_1447.png"/></td></tr>
    <tr><td class="paramname">wsnow</td><td>Liquid water content of snow pack <img class="formulaInl" alt="$[kg m^{-2}] (w_s)$" src="form_1106.png"/></td></tr>
    <tr><td class="paramname">rhosno</td><td>Density of snow <img class="formulaInl" alt="$[kg m^{-3}] (\rho_s)$" src="form_250.png"/></td></tr>
    <tr><td class="paramname">qmeltg</td><td>Available energy to be applied to melting of snow <img class="formulaInl" alt="$[W m^{-2}]$" src="form_248.png"/></td></tr>
    <tr><td class="paramname">htcs</td><td>Internal energy change of snow pack due to conduction and/or change in mass <img class="formulaInl" alt="$[W m^{-2}] (I_s)$" src="form_220.png"/></td></tr>
    <tr><td class="paramname">hmfn</td><td>Energy associated with phase change of water in snow pack <img class="formulaInl" alt="$[W m^{-2}]$" src="form_248.png"/></td></tr>
    <tr><td class="paramname">tsurf</td><td>Snow surface temperature [K]</td></tr>
    <tr><td class="paramname">zsnow</td><td>Depth of snow pack <img class="formulaInl" alt="$[m] (\Delta z_s)$" src="form_1448.png"/></td></tr>
    <tr><td class="paramname">tcsnow</td><td>Thermal conductivity of snow <img class="formulaInl" alt="$[W m^{-1} K^{-1}]$" src="form_280.png"/></td></tr>
    <tr><td class="paramname">hcpsno</td><td>Heat capacity of snow <img class="formulaInl" alt="$[J m^{-3} K^1] (C_s)$" src="form_1206.png"/></td></tr>
    <tr><td class="paramname">qtrans</td><td>Shortwave radiation transmitted through the snow pack <img class="formulaInl" alt="$[W m^{-2}]$" src="form_248.png"/></td></tr>
    <tr><td class="paramname">gconst</td><td>Intercept used in equation relating snow surface heat flux to snow surface temperature <img class="formulaInl" alt="$[W m^{-2}]$" src="form_248.png"/></td></tr>
    <tr><td class="paramname">gcoeff</td><td>Multiplier used in equation relating snow surface heat flux to snow surface temperature <img class="formulaInl" alt="$[W m^{-2} K^{-1}]$" src="form_1181.png"/></td></tr>
    <tr><td class="paramname">fi</td><td>Fractional coverage of subarea in question on modelled area <img class="formulaInl" alt="$[ ] (X_i)$" src="form_129.png"/></td></tr>
    <tr><td class="paramname">gconsts</td><td>Intercept used in equation relating snow surface heat flux to snow surface temperature <img class="formulaInl" alt="$[W m^{-2}]$" src="form_248.png"/></td></tr>
    <tr><td class="paramname">gcoeffs</td><td>Multiplier used in equation relating snow surface heat flux to snow surface temperature <img class="formulaInl" alt="$[W m^{-2} K^{-1}]$" src="form_1181.png"/></td></tr>
    <tr><td class="paramname">tbar</td><td>Temperatures of soil layers, averaged over modelled area [K]</td></tr>
    <tr><td class="paramname">delz</td><td>Overall thickness of soil layer [m] </td></tr>
  </table>
  </dd>
</dl>
<p>In the 100 loop, the heat flux into the snow surface (without adjustments that may have been applied relating to partitioning of the residual of the surface energy balance among the surface flux terms) is calculated from the snow surface temperature TSURF, using the GCOEFFS and GCONSTS terms (see documentation of subroutine TSPREP). The temperature at the bottom of the snow pack, TSNBOT, is then calculated. Currently TSNBOT is determined as a simple average of the temperatures of the snow and the first soil layer, weighted according to their respective depths (and constrained to be <img class="formulaInl" alt="$\leq$" src="form_228.png"/> 0 C), but this is under review. The heat flux into the soil surface is then evaluated from TSNBOT and the GCOEFF and GCONST terms (see documentation of subroutine TNPREP). If the energy to be applied to the melting of snow, QMELTG, is negative (indicating an energy sink), QMELTG is added to the heat flux into the ground, GZERO, and reset to zero. The temperature of the snow pack is then stepped forward using the heat fluxes at the top and bottom of the snow pack, G(0) and <img class="formulaInl" alt="$G(\Delta z_s)$" src="form_1449.png"/>:</p>
<p><img class="formulaInl" alt="$\Delta T_s = [G(0) - G(\Delta z_s)] \Delta t /(C_s \Delta z_s)$" src="form_1450.png"/></p>
<p>where <img class="formulaInl" alt="$C_s$" src="form_1109.png"/> is the snow heat capacity, <img class="formulaInl" alt="$\Delta t$" src="form_145.png"/> the time step and <img class="formulaInl" alt="$\Delta z_s$" src="form_1451.png"/> the snow depth. If the new snow temperature is greater than zero, the excess amount of heat is calculated and added to QMELTG and subtracted from GSNOW, and TSNOW is reset to 0 C. Finally, the shortwave radiation transmitted through the snow pack, QTRANS, is added to GZERO.</p>
<p>In the 200 loop, since liquid water is assumed only to exist in the snow pack if it is at 0 C, a check is carried out to determine whether the liquid water content WSNOW &gt; 0 at the same time as the snow temperature TSNOW &lt; 0. If so, the change of internal energy <img class="formulaInl" alt="$I_s$" src="form_1107.png"/> of the snow pack as a result of this phase change is calculated as the difference in <img class="formulaInl" alt="$I_s$" src="form_1107.png"/> between the beginning and end of the loop:</p>
<p><img class="formulaInl" alt="$\Delta I_s = X_i \Delta [C_s T_s]/ \Delta t$" src="form_1452.png"/></p>
<p>where <img class="formulaInl" alt="$X_i$" src="form_39.png"/> represents the fractional coverage of the subarea under consideration relative to the modelled area. The total energy sink HADD available to freeze liquid water in the snow pack is calculated from TSNOW, and the amount of energy HCONV required to freeze all the available water is calculated from WSNOW. If HADD &lt; HCONV, only part of WSNOW is frozen; this amount WFREZ is calculated from HADD and subtracted from WSNOW, the snow temperature is reset to 0 C, the frozen water is used to update the snow density, and the snow heat capacity is recalculated:</p>
<p><img class="formulaInl" alt="$C_s = C_i [\rho_s /\rho_i] + C_w w_s/[\rho_w \Delta z_s]$" src="form_1453.png"/></p>
<p>where <img class="formulaInl" alt="$C_i$" src="form_829.png"/> and <img class="formulaInl" alt="$C_w$" src="form_1113.png"/> are the heat capacities of ice and water respectively, <img class="formulaInl" alt="$w_s$" src="form_1117.png"/> is the snow water content and <img class="formulaInl" alt="$\rho_s$" src="form_1114.png"/>, <img class="formulaInl" alt="$\rho_i$" src="form_1153.png"/> and <img class="formulaInl" alt="$\rho_w$" src="form_1116.png"/> are the densities of snow, ice and water respectively. If HADD &gt; HCONV, the available energy sink is sufficient to freeze all of WSNOW. HADD is recalculated as HADD – HCONV, WFREZ is set to WSNOW and added to the snow density, WSNOW is set to zero, the snow heat capacity is recalculated and HADD is used to determine a new value of TSNOW. Finally, WFREZ is used to update the diagnostic variables HMFN describing phase changes of water in the snow pack, and the change in internal energy HTCS.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="TSPOST_8f.html">TSPOST.f</a></li>
    <li class="footer">Generated on Wed Jul 3 2019 22:27:19 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
