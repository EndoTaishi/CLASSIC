<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: src/GRDRAN.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('GRDRAN_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">GRDRAN.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Quantifies movement of liquid water between soil layers under non-infiltrating conditions, in response to gravity and tension forces.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a9d02aa9115635af052981eec146b1042"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="GRDRAN_8f.html#a9d02aa9115635af052981eec146b1042">grdran</a> (IVEG, THLIQ, THICE, TBARW, FDT, TFDT, BASFLW, TBASFL, RUNOFF, TRUNOF, QFG, WLOST, FI, EVAP, R, ZPOND, DT, WEXCES, THLMAX, THTEST, THPOR, THLRET, THLMIN, BI, PSISAT, GRKSAT, THFC, DELZW, XDRAIN, ISAND, LZF, IGRN, IGRD, IGDR, IG, IGP1, IGP2, ILG, IL1, IL2, JL, N)</td></tr>
<tr class="separator:a9d02aa9115635af052981eec146b1042"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Quantifies movement of liquid water between soil layers under non-infiltrating conditions, in response to gravity and tension forces. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a9d02aa9115635af052981eec146b1042"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d02aa9115635af052981eec146b1042">&#9670;&nbsp;</a></span>grdran()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine grdran </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IVEG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>THLIQ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>THICE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>TBARW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg,igp1)&#160;</td>
          <td class="paramname"><em>FDT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg,igp1)&#160;</td>
          <td class="paramname"><em>TFDT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>BASFLW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TBASFL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>RUNOFF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TRUNOF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>QFG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>WLOST</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>FI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>EVAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>ZPOND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>DT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>WEXCES</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>THLMAX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>THTEST</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>THPOR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>THLRET</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>THLMIN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg,ig)&#160;</td>
          <td class="paramname"><em>BI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>PSISAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ig)&#160;</td>
          <td class="paramname"><em>GRKSAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg,ig)&#160;</td>
          <td class="paramname"><em>THFC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>DELZW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>XDRAIN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg,ig)&#160;</td>
          <td class="paramname"><em>ISAND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>LZF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>IGRN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>IGRD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>IGDR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IGP1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IGP2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ILG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>JL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>N</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">iveg</td><td>Subarea type flag</td></tr>
    <tr><td class="paramname">thliq</td><td>Volumetric liquid water content of soil layer <img class="formulaInl" alt="$[m^3 m^{-3}] (\theta_l)$" src="form_402.png"/></td></tr>
    <tr><td class="paramname">thice</td><td>Volumetric frozen water content of soil layer <img class="formulaInl" alt="$[m^3 m^{-3}] (\theta_i)$" src="form_729.png"/></td></tr>
    <tr><td class="paramname">tbarw</td><td>Temperature of water in soil layer [C]</td></tr>
    <tr><td class="paramname">fdt</td><td>Water flow at soil layer interfaces during current time step [m]</td></tr>
    <tr><td class="paramname">tfdt</td><td>Temperature of water flowing between soil layers [C]</td></tr>
    <tr><td class="paramname">basflw</td><td>Base flow from bottom of soil column [m]</td></tr>
    <tr><td class="paramname">tbasfl</td><td>Temperature of base flow from bottom of soil column [K]</td></tr>
    <tr><td class="paramname">runoff</td><td>Total runoff from soil column [m]</td></tr>
    <tr><td class="paramname">trunof</td><td>Temperature of total runoff from soil column [K]</td></tr>
    <tr><td class="paramname">qfg</td><td>Evaporation from soil surface (diagnostic) <img class="formulaInl" alt="$[kg m^{-2} s^{-1}]$" src="form_128.png"/></td></tr>
    <tr><td class="paramname">wlost</td><td>Residual amount of water that cannot be supplied by surface stores <img class="formulaInl" alt="$[kg m^{-2}]$" src="form_130.png"/></td></tr>
    <tr><td class="paramname">fi</td><td>Fractional coverage of subarea in question on modelled area [ ] <img class="formulaInl" alt="$(X_i)$" src="form_730.png"/></td></tr>
    <tr><td class="paramname">evap</td><td>Evaporation rate from ground surface <img class="formulaInl" alt="$[m s^{-1}]$" src="form_122.png"/></td></tr>
    <tr><td class="paramname">r</td><td>Rainfall rate at ground surface <img class="formulaInl" alt="$[m s^{-1}]$" src="form_122.png"/></td></tr>
    <tr><td class="paramname">zpond</td><td>Depth of ponded water on soil surface [m]</td></tr>
    <tr><td class="paramname">dt</td><td>Time period over which water movement takes place [s]</td></tr>
    <tr><td class="paramname">igrn</td><td>Flag to indicate whether calculations in subroutine GRINFL are done</td></tr>
    <tr><td class="paramname">lzf</td><td>Index of soil layer in which wetting front is located</td></tr>
    <tr><td class="paramname">igrd</td><td>Flag to indicate whether calculations in this subroutine are to be done</td></tr>
    <tr><td class="paramname">igdr</td><td>Index of soil layer in which bedrock is encountered</td></tr>
    <tr><td class="paramname">thpor</td><td>Pore volume in soil layer <img class="formulaInl" alt="$[m^3 m^{-3}] (\theta_p)$" src="form_731.png"/></td></tr>
    <tr><td class="paramname">thlret</td><td>Liquid water retention capacity for organic soil <img class="formulaInl" alt="$[m^3 m^{-3} ] (\theta_{l,ret})$" src="form_732.png"/></td></tr>
    <tr><td class="paramname">thlmin</td><td>Residual soil liquid water content remaining after freezing or evaporation <img class="formulaInl" alt="$[m^3 m^{-3}] (\theta_{l,min})$" src="form_733.png"/></td></tr>
    <tr><td class="paramname">bi</td><td>Clapp and Hornberger empirical "b" parameter [ ] (b)</td></tr>
    <tr><td class="paramname">psisat</td><td>Soil moisture suction at saturation <img class="formulaInl" alt="$[m] (\Psi_{sat})$" src="form_734.png"/></td></tr>
    <tr><td class="paramname">grksat</td><td>Hydraulic conductivity of soil at saturation <img class="formulaInl" alt="$[m s^{-1}] (K_{sat})$" src="form_735.png"/></td></tr>
    <tr><td class="paramname">thfc</td><td>Field capacity <img class="formulaInl" alt="$[m^3 m^{-3}]$" src="form_221.png"/></td></tr>
    <tr><td class="paramname">delzw</td><td>Permeable depth of soil layer <img class="formulaInl" alt="$[m] (\Delta_{zg,w})$" src="form_736.png"/></td></tr>
    <tr><td class="paramname">xdrain</td><td>Drainage index for water flow at bottom of soil profile [ ]</td></tr>
    <tr><td class="paramname">isand</td><td>Sand content flag </td></tr>
  </table>
  </dd>
</dl>
<p>In loop 50, the flag IGRD is first set to 1 for all grid cells where the calculations in this subroutine are to be performed. The necessary conditions are: that the surface being modelled is not a glacier or ice sheet (ISAND &gt; -4); that the time period DT is greater than zero; that the infiltration calculations in subroutine GRINFL are not simultaneously being performed (IGRN = 0); and that the rainfall rate and the depth of ponded water are both vanishingly small. If any of these conditions is not met, IGRD is set to zero.</p>
<p>In loop 100, if the surface being modelled is not an ice sheet (ISAND = -4) and if the soil layer in question is not completely rock (ISAND = -3), the maximum possible water content of each soil layer, THLMAX, is calculated as the maximum of the available pore volume THPOR – THICE (where THPOR is the total pore volume and THICE is the ice content of the layer), the actual liquid water content THLIQ, and the minimum residual liquid water content THLMIN. The last two conditions are required because in the case of a saturated soil undergoing freezing, since water expands when frozen, the sum of the liquid and frozen volumetric water contents may be greater than the pore volume, and thus THLIQ or THLMIN may be greater than THPOR – THICE. An effective saturated hydraulic conductivity GRKSATF of the soil layer is also defined, applying an empirical correction for the presence of ice. This ice content factor, fice, is calculated from Zhao and Gray (1997) as:</p>
<p><img class="formulaInl" alt="$f_{ice} = [1.0 – min((\theta_p - \theta_{l,min} )/\theta_p , \theta_i / \theta_p )]^2$" src="form_737.png"/></p>
<p>The pore volume of the soil layer is corrected for the presence of ice by defining the effective porevolume THPORF as equivalent to THLMAX.</p>
<p>In loops 150 and 200, the theoretical amounts of water FDT flowing across the soil layer boundaries are calculated. FDT is evaluated as the product of the flow rate F(z) at the given depth z, and the period of time (DT) over which the flow is occurring. At z=0, the water flux is simply equal to the soil surface evaporation rate. Within the soil, the flow rate F at a given depth z is obtained using equation 21 from Verseghy (1991):</p>
<p><img class="formulaInl" alt="$F(z) = K(z) [-b \Psi(z)/\theta_l(z) \times d\theta_l / dz + 1]$" src="form_738.png"/></p>
<p>where K(z) is the hydraulic conductivity and psi(z) is the soil moisture suction at depth z, and b is an empirical parameter developed by Clapp and Hornberger (1978) <a class="el" href="citelist.html#CITEREF_Clapp1978-898">[21]</a>. K(z) and <img class="formulaInl" alt="$\Psi(z)$" src="form_739.png"/> are calculated following Clapp and Hornberger as</p>
<p><img class="formulaInl" alt="$K(z) = K_{sat} (\theta_l/\theta_p)^{(2b + 3)}$" src="form_740.png"/> <img class="formulaInl" alt="$\Psi(z) = \Psi_{sat} (\theta_l/\theta_p)^{(-b )}$" src="form_741.png"/></p>
<p>where <img class="formulaInl" alt="$K_{sat}$" src="form_273.png"/> and <img class="formulaInl" alt="$\Psi_{sat}$" src="form_88.png"/> are the values of <img class="formulaInl" alt="$K$" src="form_742.png"/> and <img class="formulaInl" alt="$\Psi$" src="form_48.png"/> respectively at saturation.</p>
<p>At the bottom of the permeable soil depth, in layer IGDR, if the liquid water content of the soil is greater than the field capacity, the vertical flow out of the bottom of the soil profile is calculated using a relation derived from Soulis et al. (2010):</p>
<p><img class="formulaInl" alt="$F(z_b ) = K_{sat} \times min{1, (\theta_l /\theta_p )/[1 – 1/(2b + 3)]^{(2b + 3)}$" src="form_743.png"/></p>
<p>This flow rate is multiplied by a drainage parameter XDRAIN, which is set to 0 if the soil is underlain by an impermeable layer (as in a bog), and to 1 otherwise.</p>
<p>Between soil layers, values of <img class="formulaInl" alt="$K(z)$" src="form_744.png"/> and <img class="formulaInl" alt="$\Psi(z)$" src="form_739.png"/> must be determined. This requires the estimation of soil properties at the layer interfaces. For <img class="formulaInl" alt="$\theta_l$" src="form_226.png"/>, <img class="formulaInl" alt="$\theta_p$" src="form_90.png"/> and <img class="formulaInl" alt="$d(\theta_l)/dz$" src="form_745.png"/>, slightly different approaches are followed if the permeable soil layer thickness DELZW increases with depth (the normal case), or if it decreases between one soil layer and the next (indicating the presence of an impermeable barrier at some depth in the second layer). In the first case, the pore volume THPBND, liquid water content THLBND, and liquid water gradient DTHLDZ are simply calculated as arithmetic averages of the values above and below the interface. This has the effect of weighting the interface values towards the upper layer values, roughly emulating a surfaceward exponential decay curve of liquid water content. In the second case, in order to avoid a spurious weighting towards the lower layer, the gradients of liquid water content and pore volume between the upper and lower layers are calculated as linear relations, and then solved for the values at the interface.</p>
<p>The Clapp and Hornberger b parameter at the interface is calculated as a simple average of the values in the upper and lower soil layers. The saturated hydraulic conductivity <img class="formulaInl" alt="$K_{sat,bnd}$" src="form_746.png"/> is calculated as a harmonic mean, and the saturated soil moisture suction <img class="formulaInl" alt="$\Psi_{sat,bnd}$" src="form_747.png"/> as a geometric mean, of the top and bottom layer values:</p>
<p><img class="formulaInl" alt="$ K_{sat,bnd} = K_{sat,t} K_{sat,b} ( \Delta z_{g,w,,t} + \Delta z_{g,w,,b} ) / ( K_{sat,t} \Delta z_{g,w,b} + K_{sat,b} \Delta z_{g,w,t} ) $" src="form_748.png"/></p>
<p><img class="formulaInl" alt="$ \Psi_{sat,bnd} = \Psi_{sat,t}^{\Delta zg,w,t/(\Delta zg,w,t + \Delta zg,w,b)} \Psi_{sat,b}^{\Delta zg,w,b/(\Delta zg,w,t + \Delta zg,w,b)} $" src="form_749.png"/></p>
<p>Finally, K(z), <img class="formulaInl" alt="$\Psi(z)$" src="form_739.png"/> and F(z) at the interface are calculated from the equations given above. At the end of the loop, if set to zero behind the soil layer LZF containing the wetting front, and the flow rate at the bottom of LZF is constrained to be <img class="formulaInl" alt="$\geq$" src="form_272.png"/> 0.</p>
<p>In the next several loops, checks are carried out to ascertain whether the theoretically determined flow rates at the soil layer interfaces can be supported by the water contents in the layers. At the beginning of loop 250, the soil surface evaporation rate is addressed. A trial liquid water content THTEST is calculated for the first soil layer, reflecting the removal of the evaporated water. If THTEST is less than the minimum soil water content, F(0) is set to zero and <img class="formulaInl" alt="$\theta_l$" src="form_226.png"/> is set to <img class="formulaInl" alt="$\theta_{l,min}$" src="form_750.png"/>. The excess surface flux that was not met by the removed liquid water is converted to a frozen water content, and an attempt is made to remove it from the frozen water in the layer. (The energy involved in converting the required frozen water mass to liquid water is obtained by decreasing the water temperature of the layer.) The frozen water content of the layer is adjusted to reflect the removal of the required amount. If the demand exceeds the supply of frozen water available, the frozen water content is set to zero, the diagnostic evaporative flux QFG at the soil surface is adjusted, and the remaining water flux not able to be met by the first soil layer is assigned to the variable WLOST.</p>
<p>In the remainder of the 250 loop, checks are carried out for soil layers with liquid water contents already effectively equal to <img class="formulaInl" alt="$\theta_{l,min}$" src="form_750.png"/>. If the flux at the top of the layer is upward and that at the bottom of the layer is downward, both are set to zero. If both are downward, only the flux at the bottom is set to zero; if both are upward, only the flux at the top is set to zero. If the soil layer is an organic one and the liquid water content is less than the layer retention capacity THLRET and the flux at the bottom of the layer is downward, it is set to zero.</p>
<p>In the 300 loop, checks are carried out for soil layers with liquid water contents already effectively equal to THLMAX. If the flux at the top of the layer is downward and that at the bottom of the layer is upward, both are set to zero. If both are downward, then if the top flux is greater than the bottom flux, it is set equal to the bottom flux. If both are upward, then if magnitude of the bottom flux is greater than that of the top flux, it is set equal to the top flux.</p>
<p>In the 400 loop, for each soil layer THTEST is recalculated as the liquid water content resulting from the updated boundary fluxes, and is compared with a residual value THLTHR. For organic soil layers deeper than the first layer, THLTHR is set to the minimum of <img class="formulaInl" alt="$\theta_{l,ret}$" src="form_751.png"/> and <img class="formulaInl" alt="$\theta_l$" src="form_226.png"/>, since only evapotranspiration can cause the soil moisture to fall below the retention capacity. (The first layer is excepted because surface evaporation can drive its moisture content below <img class="formulaInl" alt="$\theta_{l,ret}$" src="form_751.png"/>.) For mineral soils, <img class="formulaInl" alt="$\theta_{l,min}$" src="form_750.png"/> is set to THLMIN. If THTEST &lt; THLTHR, then if the flow at the bottom of the soil layer is downward, it is recalculated as the sum of the flow at the top of the layer plus the amount of water that must be removed to make the liquid water content of the layer equal to THLTHR. If the flow at the bottom of the layer is upward, the flow at the top of the layer is recalculated as the sum of the flow at the bottom of the layer minus the amount of water that must be removed to make the liquid water content of the layer equal to THLTHR. THTEST of the current layer is then reset to THLTHR, and THTEST of the overlying and underlying layers (if any) are recalculated using the new interface fluxes.</p>
<p>In the 500 loop, for each soil layer THTEST is compared with THLMAX. If THTEST &gt; THLMAX, two temporary variables are defined: WLIMIT as the amount of water required to raise the liquid water content of the soil layer to THLMAX, and WEXCES as the amount of water representing the excess of THTEST over THLMAX. If the flux at the top of the layer is downward and the flux at the bottom of the layer is upward, then if the negative of the flux at the bottom of the layer is greater than WLIMIT, it is set equal to -WLIMIT and the flux at the top is set to zero; otherwise WEXCES is subtracted from the flux at the top. If both the flux at the top and the flux at the bottom are downward, then WEXCES is subtracted from the flux at the top. If both are upward, then WEXCES is added to the flux at the bottom, and a correction is applied to the flux at the bottom of the underlying layer. Finally, THTEST is recalculated for all the soil layers using the new interface fluxes.</p>
<p>In the first part of the 600 loop, a correction is performed in the unlikely event that as a result of the above adjustments, the flux at the bottom of the last permeable soil layer has become upward. If this occurs, all of the fluxes above are corrected by the inverse of this same amount. However, this will result in a small spurious upward water flux at the surface. Since the liquid water flows are now accounted for, an attempt is made, as in loop 250, to remove the required water from the frozen water store in the first layer. The excess that cannot be supplied from this source is assigned to WLOST.</p>
<p>In the second part of the 600 loop, the temperatures TFDT of the water fluxes at the top and bottom of the layers in the permeable soil profile are set equal to the temperatures of the water in the first and last layers respectively. The flow at the bottom of the profile and the temperature of the flow are used to update BASFLW and TBASFL, the baseflow from the current subarea and its temperature, and RUNOFF and TRUNOF, the total runoff from the grid cell in question and its temperature.</p>
<p>In the 700 loop, for each successive soil layer the temperature of the water flux at the bottom of the layer is first assigned. If the flux is downward, TFDT is set to the temperature of the water in the current layer; if it is upward, TFDT is set to the temperature of the water in the layer below. The temperature of the water in the current layer is then updated using the FDT and TFDT values at the top and bottom of the layer, and the liquid water content of the layer is set to THTEST.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="GRDRAN_8f.html">GRDRAN.f</a></li>
    <li class="footer">Generated on Fri Aug 10 2018 14:49:11 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
