<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>CLASSIC: Competition_scheme_competition</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__competition__scheme__competition.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Competition_scheme_competition</div>  </div>
</div><!--header-->
<div class="contents">

<p>Canadian Terrestrial Ecosystem Model (CTEM) PFT Competition Subroutine.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="memitem:ga008cbfcefd33aaccb8f2b81cf8326451"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__competition__scheme__competition.html#ga008cbfcefd33aaccb8f2b81cf8326451">competition_scheme::competition</a> (iday, il1, il2, nilg, nol2pfts, nppveg, dofire, leapnow, pftexist, geremort, intrmort, gleafmas, bleafmas, stemmass, rootmass, litrmass, soilcmas, grclarea, lambda, burnvegf, sort, pstemmass, pgleafmass, fcancmx, fcanmx, vgbiomas, gavgltms, gavgscms, bmasveg, add2allo, colrate, mortrate)</td></tr>
<tr class="separator:ga008cbfcefd33aaccb8f2b81cf8326451"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Canadian Terrestrial Ecosystem Model (CTEM) PFT Competition Subroutine. </p>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="ga008cbfcefd33aaccb8f2b81cf8326451"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public competition_scheme::competition </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>iday</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nilg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ican), intent(in)&#160;</td>
          <td class="paramname"><em>nol2pfts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>nppveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>dofire</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>leapnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>pftexist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>geremort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>intrmort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>gleafmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>bleafmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>stemmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>rootmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,iccp1), intent(inout)&#160;</td>
          <td class="paramname"><em>litrmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,iccp1), intent(inout)&#160;</td>
          <td class="paramname"><em>soilcmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>grclarea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>lambda</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>burnvegf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(icc), intent(in)&#160;</td>
          <td class="paramname"><em>sort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>pstemmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>pgleafmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>fcancmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,ican), intent(inout)&#160;</td>
          <td class="paramname"><em>fcanmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>vgbiomas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>gavgltms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>gavgscms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>bmasveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>add2allo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>colrate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>mortrate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">iday</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>set competition parameters according to the model chosen</p>
<p>First, let's adjust the fractions if fire is turned on.</p>
<p>Since the biomass pools could have changed, update bmasveg.</p>
<p>Do our usual initialization</p>
<p>initial rank/superiority order for simulating competition. since crops are not in competition their rank doesn't matter and therefore we only have icc-2 ranks corresponding to the remaining pfts. the first icc-4 are tree pfts and the last two are the c3 and c4 grasses.</p>
<p>Estimate colonization and mortality rate for each pft, except for crops whose fractional coverage is prescribed.</p>
<p>colonization rate (1/day). the factor (deltat/963.62) converts npp from u-mol co2-c/m2.sec -&gt; kg c/m2.day</p>
<p>mortality rate is the sum of growth related mortality, intrinsic mortality, and an additional mortality that kicks in when long term averaged bioclimatic conditions become unfavourable for a pft. this last term is based on the binary array pftexist.</p>
<p>&mdash;&gt; from here on we assume that we only have icc-numcrops pfts &lt;-&mdash; since crops are not part of the competition.</p>
<p>based on npp for each pft find the competition ranks / superiority order for simulating competition. note that crops are not in competition, so the competition is between the remaining pfts. in addition pfts which shouldn't exist in the grid cell because of unfavourable values of long-term climatic conditions are considered inferior.</p>
<p>bubble sort according to colonization rates NOTE - this only works if no tree species are indexed at positions &gt; numtreepfts, i.e. the trees must be a contiguous unit at the start of the indexes. JM Jun 2014</p>
<p>the rank of c3 and c4 grass is also determined on the basis of their npp but grasses are always assumed to be inferior to tree pfts</p>
<p>with the ranks of all pfts in all grid cells we can now simulate competition between them. for lotka-volterra eqns we need a minimum seeding fraction otherwise the pfts will not expand at all.</p>
<p>arrange colonization and mortality rates, and fractions, according to superiority ranks</p>
<p>update fractions and check if all fractions are +ve</p>
<p>with the minimum seeding fraction prescription, especially for lotka volterra eqns the total veg fraction may exceed 1. to prevent this we need to adjust fractional coverage of all non-crop pfts that do not have the minimum fraction.</p>
<p>check again that total veg frac doesn't exceed 1.</p>
<p>map delfrac to chngfrac so that we get change in fraction corresponding to the actual number of pfts</p>
<p>&mdash;&gt; from here on we get back to our usual icc pfts &lt;-&mdash;</p>
<p>get bare fraction</p>
<p>check if a pft's fractional cover is increasing or decreasing</p>
<p>check if bare fraction increases or decreases</p>
<p>now that we know the change in fraction for every pft we use its npp for spatial expansion and litter generation. we also spread vegetation biomass uniformly over the new fractions, and generate additional litter from mortality if the fractions decrease.</p>
<p>three things can happen here</p>
<ol type="1">
<li>fraciord = 0, which means all npp that was used for expansion becomes litter, due to self/expansion thinning and mortality.</li>
<li>fraciord = 1, which means a part of or full npp is used for expansion but some litter may also be generated. the part of npp that is used for expansion needs to be allocated to leaves, stem, and root. rather than doing this here we will let the allocation part handle this. so allocation module will allocate not only the npp that is used for pure vertical expansion but also this npp. but we will do our part here and spread the vegetation biomass over the new increased fraction.</li>
<li>fraciord = -1, which means all of the npp is to be used for litter generation but in addition some more litter will be generated from mortality of the standing biomass.</li>
</ol>
<p>All npp used for expansion becomes litter plus there is additional mortality of the standing biomass. the npp that becomes litter is now spread over the whole grid cell. all biomass from fraction that dies due to mortality is also distributed over the litter pool of whole grid cell.</p>
<p>if bare fraction decreases then chop off the litter and soil c from the decreased fraction and add it to grsumlit &amp; grsumsoc for spreading over the whole grid cell. if bare fraction increases then spread its litter and soil c uniformly over the increased fraction.</p>
<p>if a pft is not supposed to exist as indicated by pftexist and its fractional coverage is really small then get rid of the pft all together and spread its live and dead biomass over the grid cell.</p>
<p>adjust litter and soil c mass densities for increase in barefrac over the bare fraction.</p>
<p>spread litter and soil c over all pfts and the barefrac</p>
<p>get fcanmxs for use by class based on the new fcancmxs</p>
<p>update grid averaged vegetation biomass, and litter and soil c densities</p>
<p>and finally we check the c balance. we were supposed to use a fraction of npp for competition. some of it is used for expansion (this is what we save for allocation), and the rest becomes litter. so for each pft the total c mass in vegetation and litter pools must all add up to the same value as before competition.</p>
<p>check balance over the bare fraction </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Oct 4 2017 16:31:08 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
