<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: Configuring the model outputs via the CLASSIC code and Output Variable Editor (OVE)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('xmlSystem.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Configuring the model outputs via the CLASSIC code and Output Variable Editor (OVE) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>All CLASSIC model outputs are written to netcdf files. Outputs are first specified in an xml file where the relevant metadata is assigned. Then within the CLASSIC code the variable of interest is appropriately prepared for writing at the half-hourly, daily, monthly, or annual timestep (see <a class="el" href="xmlSystem.html#writeOutput">Editing the CLASSIC code to write the output variable</a>).</p>
<p>The Output Variable Editor (OVE) is a web interface that allows a user to configure the output variables for the CLASSIC. Using this interface the user can load an existing XML file and add/remove variables and variants. Once the changes are complete, the user may download an updated version of the XML configuration file.</p>
<h1><a class="anchor" id="xmlStruct"></a>
The XML Document Structure</h1>
<p>The XML document follows a hierarchical structure which has the <b>variableSet</b> as a root node. This node has a number of <b>group</b> child nodes, as well as attributes such as <em>type, version and created</em>. The <b>group</b> nodes have a number of <b>variable</b> child nodes.</p>
<p>The <b>variable</b> nodes feature several attributes (e.g. <em>id, includeBareGround</em>) and fields (e.g. <em>standardName, longName, shortName,</em> etc. They also have a collection of <b>variant</b> child nodes. These variants are the individual instances of the variable, which can be identified by the unique <b>nameInCode</b> identifier. They also have a specific <b>timeFrequency</b> and <b>outputForm</b>.</p>
<p>Example of xml: </p><pre class="fragment">    &lt;?xml version="1.0"?&gt;
    &lt;variableSet type="CLASS" version="1.2" created="2018/8/7"&gt;
        &lt;group type="class"&gt;
            &lt;variable id="0" includeBareGround="false" dormant="false"&gt;
                &lt;standardName&gt;Net Shortwave Surface Radiation&lt;/standardName&gt;
                &lt;longName&gt;Net downward shortwave radiation at the surface&lt;/longName&gt;
                &lt;shortName&gt;rss&lt;/shortName&gt;
                &lt;defaultUnits&gt;W/$m^2$&lt;/defaultUnits&gt;
                &lt;variant&gt;
                    &lt;timeFrequency&gt;annually&lt;/timeFrequency&gt;
                    &lt;outputForm&gt;grid&lt;/outputForm&gt;
                    &lt;nameInCode&gt;fsstar_yr&lt;/nameInCode&gt;
                    &lt;units&gt;W/$m^2$&lt;/units&gt;
                &lt;/variant&gt;
                &lt;variant&gt;
                    &lt;timeFrequency&gt;monthly&lt;/timeFrequency&gt;
                    &lt;outputForm&gt;grid&lt;/outputForm&gt;
                    &lt;nameInCode&gt;fsstar_mo&lt;/nameInCode&gt;
                    &lt;units&gt;W/$m^2$&lt;/units&gt;
                &lt;/variant&gt;

                ...

              &lt;/variable&gt;
          &lt;/group&gt;
      &lt;/variableSet&gt;
</pre><h1>Output Variable Editor (OVE)</h1>
<h2>Opening Instructions</h2>
<p>The <em>Output Variable Editor</em> folder is located in the <em>tools</em> folder of your local CLASS directory. Open tools/outputVariableEditor/index.html in your favorite browser and edit the output variable descriptors using the web interface.</p>
<h2>Work flow</h2>
<p>The various process steps are seen on the top of the page as tabs. The user first loads the existing XML document as a template, then optionally add/removes variables, then edits the variants associated with the variables, and finally generates the output XML that included the new variables and variant changes. </p><h3>Load the Existing XML</h3>
<p>Browse to an existing XML file to add/remove variables and variants. Once the file has been selected, press the "Load XML" button to load the data. An existing file is provided in the configurationFiles folder. Choose the one with the newest version number. </p><h3>Add/Remove Variable</h3>
<p>Fill in the <b>Standard Name</b>, <b>Short Name</b>, <b>Long Name</b>, <b>Units</b> fields and select a <b>Group</b> to classify the new variable. Select the <b>Include bare ground</b> check-box, if the variable includes bare ground. One may also use <b>Add variable group</b> to add a group or <b>Remove variable</b> to delete an existing variable. </p><h3>Variants editor</h3>
<p>In the variants editor, the user can find a list of all of the existing variables. Click on one to find a detailed description of the variable as well as a list of potential variants. Check the box for particular variant and enter the desired <b>name in code</b>. </p><h3>Output XML</h3>
<p>Once all the variable and variant changes are complete, proceed to the <b>Output XML</b> tab, where one can preview the newly generated XML document. Also, the website will trigger a download command, so the generated XML document will be pushed to the user for download.</p>
<h1>Validation / Schema</h1>
<p>A relaxNG schema is provided for validation purposes. In order to validate the XML Document, navigate to the schema folder and use the following command:</p>
<p><code>java -jar jing.jar schema_1.0.xml path/myFile.xml</code></p>
<p>where schema_1.0.xml is the current version of the schema and path/myFile.xml is the XML Document file of your choosing.</p>
<p>The schema will produce warnings and errors if there is any problem with the XML file, but it will <b>not</b> produce any output at all if everything is alright.</p>
<h1>Manual editing</h1>
<p>There are certain functionalities that the present interface is lacking, like editing existing variable names, removing groups, editing groups and so on. These tasks can be easily achieved by manually editing the XML input file.</p>
<p><b>Do not manually edit the id fields of the variables, as that can cause serious problems with the variables</b></p>
<h1><a class="anchor" id="writeOutput"></a>
Editing the CLASSIC code to write the output variable</h1>
<p>Then within the CLASSIC code (<a class="el" href="prepareOutputs_8f90.html">prepareOutputs.f90</a>) the variable of interest is appropriately prepared for writing at the half-hourly (<a class="el" href="namespaceprepareoutputs.html#af363dbf48f4618d1adcb1e5fa1161c6c">prepareoutputs::class_hh_w</a>), daily (<a class="el" href="namespaceprepareoutputs.html#a8fa1c2a12397238a1a32b796551ecc66">prepareoutputs::ctem_daily_aw</a>, <a class="el" href="namespaceprepareoutputs.html#a18c24a70d604520e0f2a34a2a7153472">prepareoutputs::class_daily_aw</a>), monthly (<a class="el" href="namespaceprepareoutputs.html#a4be038dcf93a44466ab9f60f232b9b03">prepareoutputs::ctem_monthly_aw</a>, <a class="el" href="namespaceprepareoutputs.html#ad6787b79a64921237e744e2f49e2f913">prepareoutputs::class_monthly_aw</a>) or annual (<a class="el" href="namespaceprepareoutputs.html#abb8ffec344831a43919578de7b7d25c2">prepareoutputs::ctem_annual_aw</a>, <a class="el" href="namespaceprepareoutputs.html#a51e741e1f96716eabe956fc291d94177">prepareoutputs::class_annual_aw</a>) timestep.</p>
<p>All writes to the netcdf file in <a class="el" href="prepareOutputs_8f90.html">prepareOutputs.f90</a> use some form of the following: </p><pre class="fragment">    call writeOutput1D(lonLocalIndex,latLocalIndex,'laimaxg_mo' ,timeStamp,'lai', [laimaxg_mo(i,m,:)])
</pre><p>Here there are two important considerations. First is the <b>key</b> ('laimaxg_mo' in this example). The key is used to associate this write to the appropriate netcdf output file, called the nameInCode in the xml file. The <b>shortName</b> (here it is 'lai') is the name of the variable in the output netcdf file. You will see the nameInCode and shortName in the xml snippet <a class="el" href="xmlSystem.html#xmlStruct">above</a>. So your nameInCode and shortName within <a class="el" href="prepareOutputs_8f90.html" title="Central module that handles all CTEM preparation and writing of output files. ">prepareOutputs.f90</a> and in your xml file must match for the proper netcdf to match to the proper model variable to be output. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">CLASSIC main page</a></li>
    <li class="footer">Generated on Fri Nov 9 2018 11:01:14 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
