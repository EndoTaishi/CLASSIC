<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: competition_scheme Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacecompetition__scheme.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">competition_scheme Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Performs competition between PFTs for space.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a8976936d6f76c8619f6602153b8355f9"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecompetition__scheme.html#a8976936d6f76c8619f6602153b8355f9">bioclim</a> (iday, ta, precip, netrad, il1, il2, nilg, leapnow, tcurm, srpcuryr, dftcuryr, inibioclim, tmonth, anpcpcur, anpecur, gdd5cur, surmncur, defmncur, srplscur, defctcur, twarmm, tcoldm, gdd5, aridity, srplsmon, defctmon, anndefct, annsrpls, annpcp, dry_season_length)</td></tr>
<tr class="memdesc:a8976936d6f76c8619f6602153b8355f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates bioclimatic parameters required to determine existance of PFTs.  <a href="#a8976936d6f76c8619f6602153b8355f9">More...</a><br /></td></tr>
<tr class="separator:a8976936d6f76c8619f6602153b8355f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a4345a1807f52b8da4f0cdd9f0f71f91f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecompetition__scheme.html#a4345a1807f52b8da4f0cdd9f0f71f91f">existence</a> (iday, il1, il2, nilg, sort, nol2pfts, twarmm, tcoldm, gdd5, aridity, srplsmon, defctmon, anndefct, annsrpls, annpcp, pftexist, dry_season_length)</td></tr>
<tr class="memdesc:a4345a1807f52b8da4f0cdd9f0f71f91f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines if a PFT can exist in a grid cell based on climatic conditions.  <a href="#a4345a1807f52b8da4f0cdd9f0f71f91f">More...</a><br /></td></tr>
<tr class="separator:a4345a1807f52b8da4f0cdd9f0f71f91f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a008cbfcefd33aaccb8f2b81cf8326451"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecompetition__scheme.html#a008cbfcefd33aaccb8f2b81cf8326451">competition</a> (iday, il1, il2, nilg, nol2pfts, nppveg, dofire, leapnow, pftexist, geremort, intrmort, gleafmas, bleafmas, stemmass, rootmass, litrmass, soilcmas, grclarea, lambda, burnvegf, sort, pstemmass, pgleafmass, fcancmx, fcanmx, vgbiomas, gavgltms, gavgscms, bmasveg, add2allo, colrate, mortrate)</td></tr>
<tr class="memdesc:a008cbfcefd33aaccb8f2b81cf8326451"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the competition between PFTs based on Lotka-Volterra eqns. ot its modified forms. either option may be used.  <a href="#a008cbfcefd33aaccb8f2b81cf8326451">More...</a><br /></td></tr>
<tr class="separator:a008cbfcefd33aaccb8f2b81cf8326451"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Performs competition between PFTs for space. </p>
<p>Competition between PFTs in CTEM is based upon modified L&ndash;V equations <a class="el" href="citelist.html#CITEREF_Arora2006-pp">[8]</a> <a class="el" href="citelist.html#CITEREF_Arora2006-ax">[9]</a>. The L&ndash;V equations <b>[lotka1925elements]</b> <a class="el" href="citelist.html#CITEREF_Volterra1926-iz">[85]</a> have been adapted from their initial application for simulating predator&ndash;prey interactions in ecosystem models as described below.</p>
<p>Competition parametrization</p>
<p>The change in fractional coverage ( <img class="formulaInl" alt="$f$" src="form_428.png"/>) of a PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> through time, <img class="formulaInl" alt="$\frac{\mathrm{d}f_\alpha}{\mathrm{d}t}$" src="form_430.png"/>, is expressed as the result of mortality, and competition and colonization (CC) interactions with the other PFTs present in a grid cell and bare ground, collectively represented as <img class="formulaInl" alt="$B$" src="form_431.png"/> where <img class="formulaInl" alt="$\alpha \notin B$" src="form_432.png"/>: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{concepteqn} \frac{\mathrm{d}f_\alpha}{\mathrm{d}t} = g(f_\alpha, f_B) - m_{\alpha} f_\alpha. \]" src="form_433.png"/>
</p>
<p>The CC interactions are represented symbolically by the <img class="formulaInl" alt="$g(f_\alpha, f_B)$" src="form_434.png"/> function. Mortality is assumed to be proportional to the number density of plants and represented by the mortality term, <img class="formulaInl" alt="$m_{\alpha} f_\alpha$" src="form_435.png"/>. The PFT-dependent mortality rate ( <img class="formulaInl" alt="$m_{\alpha}$" src="form_436.png"/>; <img class="formulaInl" alt="$day^{-1}$" src="form_437.png"/>) (described further in Sect. mort}) produces bare ground via a number of processes, and that bare ground is subsequently available for colonization. We consider the fractional coverage for <img class="formulaInl" alt="$N$" src="form_438.png"/> PFTs plus bare ground ( <img class="formulaInl" alt="$f_{N+1}$" src="form_439.png"/> = <img class="formulaInl" alt="$f_{bare}$" src="form_440.png"/>) where <img class="formulaInl" alt="$\sum_{j=1}^{N+1} f_{j}=1$" src="form_441.png"/>. For competition between unequal competitors, the PFTs are ranked in terms of their dominance. If PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> is the most dominant, it will invade the area of other PFTs and the bare ground ( <img class="formulaInl" alt="$f_B$" src="form_442.png"/>, <img class="formulaInl" alt="$\alpha \notin B$" src="form_432.png"/>). Woody PFTs are all more dominant than grass PFTs since trees can successfully invade grasses by overshading them <a class="el" href="citelist.html#CITEREF_Siemann2003-jl">[77]</a> and thus are ranked higher. Within tree or grass PFTs the dominance rank of a PFT is calculated based upon its colonization rate ( <img class="formulaInl" alt="$c_\alpha$" src="form_443.png"/>; <img class="formulaInl" alt="$day^{-1}$" src="form_437.png"/>) with higher colonization rates giving a higher dominance ranking. For the general case of PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> with a dominance rank of <img class="formulaInl" alt="$i$" src="form_444.png"/>, we describe the ranking from most dominant to least as 1, 2, <img class="formulaInl" alt="${\ldots}$" src="form_445.png"/>, <img class="formulaInl" alt="$i-1$" src="form_446.png"/>, <img class="formulaInl" alt="$i$" src="form_444.png"/>, <img class="formulaInl" alt="$i+1$" src="form_447.png"/>, <img class="formulaInl" alt="${\ldots}$" src="form_445.png"/>, <img class="formulaInl" alt="$N$" src="form_438.png"/>. Equation (concepteqn}) can then be reformulated following a phenomenological approach as</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\mathrm{d}f_\alpha}{\mathrm{d}t} = f^b_\alpha(c_{\alpha, i+1}f_{i+1} +c_{\alpha, i+2}f_{i+2} +\ldots+c_{\alpha,N}f_{N})\nonumber\\ - f_\alpha(c_{1,\alpha}f^b_1 + c_{2,\alpha}f^b_2 + \ldots + c_{(i-1), \alpha}f^b_{i-1})\nonumber\\ - m_{\alpha} f_\alpha,\label{full} \]" src="form_448.png"/>
</p>
<p>where the exponent <img class="formulaInl" alt="$b$" src="form_449.png"/> is an empirical parameter, which controls the behaviour of the L&ndash;V equations. In the original L&ndash;V formulation, <img class="formulaInl" alt="$b$" src="form_449.png"/> is 1, but we modify the L&ndash;V relations by using <img class="formulaInl" alt="$b = 0$" src="form_450.png"/> following <a class="el" href="citelist.html#CITEREF_Arora2006-pp">[8]</a> <a class="el" href="citelist.html#CITEREF_Arora2006-ax">[9]</a> (implications of this choice are expanded upon below). The fractional cover of PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> then changes depending on the gains it makes into the area of less dominant PFTs and the losses it suffers due to mortality and encroachment by more dominant PFTs. The rate of change of the bare fraction, <img class="formulaInl" alt="$f_{bare}$" src="form_440.png"/>, is expressed as</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{barecol} \frac{\mathrm{d}f_{bare}}{\mathrm{d}t} = \sum_{\beta=1}^{N} (m_\beta f_\beta - c_{\beta, {bare}}f^b_\beta f_{bare}). \]" src="form_451.png"/>
</p>
<p>The rate at which PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> invades another PFT <img class="formulaInl" alt="$\beta$" src="form_452.png"/> is given by</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{coloniz} c_{\alpha,\beta}f^b_\alpha f_{\beta} = c_\alpha \left(\frac{c_{\alpha,\beta}}{c_\alpha} \right)f^b_\alpha f_{\beta} = c_\alpha \delta_{\alpha,\beta} f^b_\alpha f_{\beta}. \]" src="form_453.png"/>
</p>
<p>A PFT invading bare ground has an unimpeded <img class="formulaInl" alt="$\textit{invasion}$" src="form_454.png"/> rate, <img class="formulaInl" alt="$c_\alpha$" src="form_443.png"/>. The ratio of the invasion rate by PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> into area covered by another PFT <img class="formulaInl" alt="$\beta$" src="form_452.png"/> and its unimpeded invasion rate ( <img class="formulaInl" alt="$\frac{c_{\alpha,\beta}}{c_\alpha}$" src="form_455.png"/>) gives the relative efficiency of colonization, termed <img class="formulaInl" alt="$\delta_{\alpha,\beta}$" src="form_456.png"/>, which is a scalar between 0 and 1. <img class="formulaInl" alt="$\delta$" src="form_457.png"/> is 1 for invasion of any PFT into bare ground and 1 for tree PFT invasion into grass PFTs. If a PFT <img class="formulaInl" alt="$\beta$" src="form_452.png"/> has a lower dominance ranking than another PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> then <img class="formulaInl" alt="$\delta_{\beta,\alpha} =0$" src="form_458.png"/> implying that sub-dominant PFTs do not invade dominant PFTs, but get invaded by them, i.e. <img class="formulaInl" alt="$\delta_{\alpha,\beta}=1$" src="form_459.png"/>. Equation (full}) can then be written more succinctly for each PFT as</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{compact} \frac{\mathrm{d}f_\alpha}{\mathrm{d}t} = \sum_{\beta=1}^{N+1} (c_{\alpha} \delta_{\alpha,\beta}f^b_\alpha f_\beta - c_{\beta} \delta_{\beta,\alpha} f_\alpha f^b_\beta) - m_{\alpha} f_\alpha. \]" src="form_460.png"/>
</p>
<p>The value of parameter <img class="formulaInl" alt="$b$" src="form_449.png"/> is related to the manner in which two PFTs interact, represented by <img class="formulaInl" alt="$f_{\alpha}^b f_{\beta}$" src="form_461.png"/>, in Eqs. (full})&ndash;(coloniz}). As a result, the value of <img class="formulaInl" alt="$b$" src="form_449.png"/> affects the equilibrium solution for fractional coverage of PFTs as well as how <img class="formulaInl" alt="$f_i$" src="form_462.png"/> evolves over time.</p>
<p>For the usual form of the L&ndash;V equations with <img class="formulaInl" alt="$b=\delta=1$" src="form_463.png"/>, and for the case of a grid cell with two PFTs, the competition&ndash;colonization equations are</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\mathrm{d}f_{1}} {\mathrm{d}t} = c_1 f_1 ( f_2 + f_{bare}) - m_1 f_1 \nonumber \\ = c_1 f_1 ( 1 - f_1) - m_1 f_1, \\ \frac{\mathrm{d}f_{2}} {\mathrm{d}t} = c_2 f_2 f_{bare} - c_1 f_1 f_2 - m_2 f_2 \nonumber \\ = c_2 f_2 (1 - f_1 - f_2) - c_1 f_1 f_2 - m_2 f_2\label{cc_eq_b_eq_1_2}, \]" src="form_464.png"/>
</p>
<p>where the dominant PFT 1 invades PFT 2 and the bare fraction, and PFT 2 invades only the bare fraction. The equilibrium solutions for $f_1$ and $f_2$ in this case are</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ f_1=max \left[ \frac{c_1 - m_1}{c_1}, 0 \right], \vspace*{-4mm} \]" src="form_465.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ f_2 = max \left[ \frac{c_2 - c_2 f_1 - c_1 f_1 - m_2}{c_2}, 0 \right] \nonumber \\ = max \left[ \frac{(c_2 - m_2)-(1+\frac{c_2}{c_1})(c_1-m_1)}{c_2},0 \right],\label{f2_eq_b_eq_1} \]" src="form_466.png"/>
</p>
<p>In Eq. (f2_eq_b_eq_1}), as long as <img class="formulaInl" alt="$(c_1 - m_1)$" src="form_467.png"/> &gt; <img class="formulaInl" alt="$(c_2 - m_2)$" src="form_468.png"/> the equilibrium solution for <img class="formulaInl" alt="$f_2$" src="form_469.png"/> will always be zero and coexistence is not possible.</p>
<p>For <img class="formulaInl" alt="$b=0$" src="form_470.png"/> and <img class="formulaInl" alt="$\delta=1$" src="form_471.png"/>, the competition&ndash;colonization equations are</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\mathrm{d}f_{1}} {\mathrm{d}t} = c_1 ( f_2 + f_{bare}) - m_1 f_1 \nonumber \\ = c_1 ( 1 - f_1) - m_1 f_1, \\ \frac{\mathrm{d}f_{2}} {\mathrm{d}t} = c_2 f_{bare} - c_1 f_2 - m_2 f_2 \nonumber \\ = c_2 (1 - f_1 - f_2) - c_1 f_2 - m_2 f_2,\label{cc_eq_b_eq_0_1} \]" src="form_472.png"/>
</p>
<p>and the corresponding equilibrium fractions are</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{f_equil_b_eq_0_1} f_1 = \frac{c_1}{c_1 + m_1}, \vspace*{-4mm} \]" src="form_473.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{f_equil_b_eq_0_2} f_2 = \frac{c_2(1 - f_1)}{(c_1 + c_2 + m_2)}. \]" src="form_474.png"/>
</p>
<p>In Eqs. (f_equil_b_eq_0_1}) and (f_equil_b_eq_0_2}), as long as <img class="formulaInl" alt="$m_1&gt; 0$" src="form_475.png"/> and <img class="formulaInl" alt="$c_2 &gt; 0$" src="form_476.png"/>, then PFT 2 will always exist and equilibrium coexistence is possible. Values of parameter <img class="formulaInl" alt="$b$" src="form_449.png"/> between 1 and 0 yield equilibrium values of <img class="formulaInl" alt="$f_2$" src="form_469.png"/> that vary between 0 (Eq. f2_eq_b_eq_1}) and those obtained using Eq. (f_equil_b_eq_0_2}). <img class="formulaInl" alt="$b=0$" src="form_470.png"/> yields a maximum value of equilibrium <img class="formulaInl" alt="$f_2$" src="form_469.png"/> allowing PFT 2 to coexist maximally.</p>
<p>In the standard L&ndash;V equations for predator&ndash;prey interactions coexistence is possible because the predator depends on prey for its food and so the predator population suffers as the prey population declines. This is in contrast to the application of the equations for competition between PFTs where the dominant PFT does not depend on sub-dominant PFTs for its existence and is thus able to exclude them completely. The PFTs interact with each other through the invasion term <img class="formulaInl" alt="$(-c_{\beta} \delta_{\beta,\alpha} f_\alpha f^b_\beta)$" src="form_477.png"/> in Eq. (compact}), where <img class="formulaInl" alt="$\delta_{\alpha,\beta} = 1$" src="form_478.png"/> or <img class="formulaInl" alt="$0$" src="form_56.png"/> depending on whether PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> can or cannot invade PFT <img class="formulaInl" alt="$\beta$" src="form_452.png"/>, respectively, as mentioned earlier. This interaction through invasion is represented by <img class="formulaInl" alt="$-c_1 f_1 f_2$" src="form_479.png"/> in Eq.( cc_eq_b_eq_1_2}) (for <img class="formulaInl" alt="$b=1$" src="form_480.png"/>) and by <img class="formulaInl" alt="$-c_1 f_2$" src="form_481.png"/> in Eq. (cc_eq_b_eq_0_1}) (for <img class="formulaInl" alt="$b=0$" src="form_470.png"/>). The magnitude of this interaction thus depends on the value of parameter $b$. When $b=1$ the interaction is proportional to the product of the fractional coverage of the two PFTs ( <img class="formulaInl" alt="$f_1 f_2$" src="form_482.png"/>). When <img class="formulaInl" alt="$b=0$" src="form_470.png"/>, the interaction is proportional to the fractional coverage of the PFT being invaded ( <img class="formulaInl" alt="$f_2$" src="form_469.png"/>). The use of <img class="formulaInl" alt="$b=0$" src="form_470.png"/> thus reduces the product term <img class="formulaInl" alt="$f_{\alpha}^b f_{\beta}$" src="form_461.png"/> to <img class="formulaInl" alt="$f_\beta$" src="form_483.png"/> and implies that the invasion of sub-dominant PFT <img class="formulaInl" alt="$\beta$" src="form_452.png"/> does not depend on the current fractional coverage of the dominant PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/>. This case may be thought of as corresponding to the general availability of the seeds of the dominant PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> that may germinate and invade the coverage of the sub-dominant PFT <img class="formulaInl" alt="$\beta$" src="form_452.png"/> provided the climate is favourable, even if PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/> does not exist in the grid cell, i.e. <img class="formulaInl" alt="$f_\alpha = 0$" src="form_484.png"/> (in the case where <img class="formulaInl" alt="$f_\alpha = 0$" src="form_484.png"/>, the PFT is always assumed to have a dormant seed bank in the grid cell given the long lifetimes of seeds and their wide dispersion). In contrast, in the standard version of the L&ndash;V equations, as implemented for predator&ndash;prey interactions, <img class="formulaInl" alt="$b$" src="form_449.png"/> always equals <img class="formulaInl" alt="$1$" src="form_485.png"/> since the amount of predation, and hence the reduction in the number of prey, depends on the product of the number of predators and the number of prey. Using <img class="formulaInl" alt="$b=0$" src="form_470.png"/> is thus consistent with invasion of the sub-dominant PFT <img class="formulaInl" alt="$\beta$" src="form_452.png"/> being unaffected by the fractional coverage of the dominant PFT <img class="formulaInl" alt="$\alpha$" src="form_429.png"/>.</p>
<p>Colonization rate</p>
<p>The PFT-dependent colonization rate ( <img class="formulaInl" alt="$c_\alpha$" src="form_443.png"/>; <img class="formulaInl" alt="$day^{-1}$" src="form_437.png"/>) is calculated based on the fraction ( <img class="formulaInl" alt="$\Lambda_\alpha$" src="form_486.png"/>) of positive NPP ( <img class="formulaInl" alt="$kg\,C\,m^{-2}\,day^{-1}$" src="form_487.png"/>) that is used for spatial expansion</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{c_a} c_\alpha = {\Lambda_\alpha\, NPP_\alpha\,\xi_{\alpha}}, \]" src="form_488.png"/>
</p>
<p>where <img class="formulaInl" alt="$\xi_{\alpha}$" src="form_489.png"/> ( <img class="formulaInl" alt="$(kg\,C)^{-1}\,m^{2}$" src="form_490.png"/>) is the inverse sapling density calculated as the reciprocal of vegetation biomass ( <img class="formulaInl" alt="$C_{veg,\alpha}$" src="form_491.png"/>; <img class="formulaInl" alt="$kg\,C\,m^{-2}$" src="form_492.png"/>) multiplied by a PFT-dependent constant ( <img class="formulaInl" alt="$S_{sap,\alpha}$" src="form_493.png"/>; unitless; see also <a class="el" href="ctem__params_8f90.html" title="This module holds CTEM globally accessible parameters. ">ctem_params.f90</a>)</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{xi} \xi_{\alpha}=\frac{1}{S_{sap,\alpha}\,\max[0.25,\min(5.0, C_{veg,\alpha})]}. \]" src="form_494.png"/>
</p>
<p>The fraction of NPP used for spatial expansion, <img class="formulaInl" alt="$\Lambda_\alpha$" src="form_486.png"/>, is calculated using the leaf area index ( <img class="formulaInl" alt="${LAI}_\alpha$" src="form_495.png"/>; <img class="formulaInl" alt="$m^2\,leaf\,(m^{2}\,ground)^{-1}$" src="form_496.png"/>) of a PFT</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Lambda_{\alpha}=\min(\lambda_{max}, \max (\lambda_{1,\alpha}, \lambda_{2,\alpha})), \vspace*{-4mm} \]" src="form_497.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ if LAI_\alpha \leq LAI_{min,\alpha}:\nonumber \\ \quad \lambda_{1,\alpha} =0 \nonumber \\ if LAI_{min,\alpha} &lt; LAI_\alpha &lt; LAI_{max,\alpha}:\nonumber \\ \quad \lambda_{1,\alpha} =\frac{LAI_\alpha - LAI_{min,\alpha}} {LAI_{max,\alpha} - LAI_{min,\alpha}} \lambda_{max} \nonumber \\ if LAI_\alpha \geq LAI_{max,\alpha}:\nonumber \\ \quad \lambda_{1,\alpha} =\lambda_{max} \label{lam1} \vspace*{-4mm} \]" src="form_498.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ if LAI_\alpha &gt; 0.25 LAI_{min,\alpha}:\nonumber \\ \quad \lambda_{2,\alpha} =\cosh(0.115(LAI_\alpha - 0.25 LAI_{min,\alpha})) - 1 \nonumber \\ if LAI_\alpha \leq 0.25 LAI_{min,\alpha}: \nonumber \\ \quad \lambda_{2,\alpha} = 0\label{lam2} \]" src="form_499.png"/>
</p>
<p>The original formulation of <a class="el" href="citelist.html#CITEREF_Arora2006-pp">[8]</a> only considered <img class="formulaInl" alt="$\lambda_{1,\alpha}$" src="form_500.png"/> but here we adjust the parametrization with the addition of <img class="formulaInl" alt="$\lambda_{2,\alpha}$" src="form_501.png"/>, which ensures that a small fraction of NPP is used for spatial expansion even at very low LAI values. This additional constraint allows for improved fractional coverage of grasses in arid regions. Similar to <img class="formulaInl" alt="$S_{sap,\alpha}$" src="form_493.png"/>, <img class="formulaInl" alt="$LAI_{min,\alpha}$" src="form_502.png"/> and <img class="formulaInl" alt="$LAI_{max,\alpha}$" src="form_503.png"/> are PFT-dependent parameters (see also <a class="el" href="ctem__params_8f90.html" title="This module holds CTEM globally accessible parameters. ">ctem_params.f90</a>).</p>
<p>The value of <img class="formulaInl" alt="$\lambda_{max}$" src="form_504.png"/> is set to 0.1 so that a maximum of 10\,{%} of daily NPP can be used for spatial expansion. Finally, <img class="formulaInl" alt="$\Lambda_\alpha$" src="form_486.png"/> is set to zero for tree PFTs when they are in a full leaf-out mode and all NPP is being used for leaf expansion (see Appendix phenol}).</p>
<p>Bioclimatic conditions determination</p>
<p>The mortality associated with bioclimatic criteria, <img class="formulaInl" alt="$m_{bioclim}$" src="form_505.png"/>, ensures that PFTs do not venture outside their bioclimatic envelopes. The bioclimatic criteria that determine PFT existence are listed in Table tab:pftparams} for tree PFTs. Bioclimatic limits are not used for the <img class="formulaInl" alt="$C_3$" src="form_506.png"/> and <img class="formulaInl" alt="$C_4$" src="form_507.png"/> grass PFTs. The bioclimatic limits represent physiological limits to PFT survival that are either not captured in the model or processes that are not sufficiently described by empirical observations to allow their parametrization. Some examples of the latter include a plant's resistance to frost damage and xylem cavitation limits due to moisture stress. The bioclimatic criteria include the minimum coldest month air temperature ( <img class="formulaInl" alt="$T^{cold}_{min}$" src="form_508.png"/>), the maximum coldest month air temperature ( <img class="formulaInl" alt="$T^{cold}_{max}$" src="form_509.png"/>), the maximum warmest month air temperature ( <img class="formulaInl" alt="$T^{warm}_{max}$" src="form_510.png"/>), the minimum number of annual growing degree days above <img class="formulaInl" alt="$5\,C$" src="form_511.png"/> ( <img class="formulaInl" alt="$GDD5_{min}$" src="form_512.png"/>), the minimum annual aridity index (ratio of potential evapotranspiration to precipitation; <img class="formulaInl" alt="$arid_{min}$" src="form_513.png"/>) and the minimum dry season length in a year ( <img class="formulaInl" alt="$dryseason_{min}$" src="form_514.png"/>), where the dry season length represents the number of consecutive months with precipitation less than potential evaporation. The bioclimatic indices are updated on a 25 year timescale ( <img class="formulaInl" alt="$T=25$" src="form_515.png"/>) such that the slowly changing value of a bioclimatic index <img class="formulaInl" alt="$X(t+1)$" src="form_516.png"/> for time <img class="formulaInl" alt="$t+1$" src="form_517.png"/> is updated using its previous year's value <img class="formulaInl" alt="$X(t)$" src="form_518.png"/> and its value <img class="formulaInl" alt="$x(t)$" src="form_519.png"/> for the current year as</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \label{efold} X(t+1)=X(t)e^{-1/T} + x(t) (1 - e^{-1/T}). \]" src="form_520.png"/>
</p>
<p>Equation (efold}) implies that <img class="formulaInl" alt="$63\,{\%}$" src="form_521.png"/> of a sudden change in the value of a bioclimatic index <img class="formulaInl" alt="$\Delta x$" src="form_522.png"/> is reflected in <img class="formulaInl" alt="$X(t)$" src="form_518.png"/> in <img class="formulaInl" alt="$T$" src="form_523.png"/> years <img class="formulaInl" alt="$(1-e^{T(-1/T)}= 1-e^{-1} = 0.63)$" src="form_524.png"/>, while <img class="formulaInl" alt="$86\,{\%}$" src="form_525.png"/> of the change is reflected in <img class="formulaInl" alt="$2T$" src="form_526.png"/> years <img class="formulaInl" alt="$(1-e^{2T(-1/T)}= 1-e^{-2} = 0.86) $" src="form_527.png"/>. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a8976936d6f76c8619f6602153b8355f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8976936d6f76c8619f6602153b8355f9">&#9670;&nbsp;</a></span>bioclim()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public competition_scheme::bioclim </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>iday</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>precip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>netrad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nilg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>leapnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>tcurm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>srpcuryr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>dftcuryr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(inout)&#160;</td>
          <td class="paramname"><em>inibioclim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(12,nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>tmonth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>anpcpcur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>anpecur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>gdd5cur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>surmncur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>defmncur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>srplscur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>defctcur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>twarmm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>tcoldm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>gdd5</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>aridity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>srplsmon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>defctmon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>anndefct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>annsrpls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>annpcp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>dry_season_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates bioclimatic parameters required to determine existance of PFTs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nilg</td><td>day of the year</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nilg</td><td>no. of grid cells in latitude circle (this is passed in as either ilg or nlat depending on mos/comp)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il1</td><td>il1=1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il2</td><td>il2=nilg</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ta</td><td>mean daily temperature, k</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">precip</td><td>daily precipitation (mm/day)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">netrad</td><td>daily net radiation (w/m2)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">inibioclim</td><td>switch telling if bioclimatic parameters are being initialized from scratch (false) or being initialized from some spun up values(true).</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">leapnow</td><td>true if this year is a leap year. Only used if the switch 'leap' is true.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tcurm</td><td>temperature of the current month (c)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">srpcuryr</td><td>water surplus for the current year</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dftcuryr</td><td>water deficit for the current year</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tmonth</td><td>monthly temperatures</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">anpcpcur</td><td>annual precipitation for current year (mm)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">anpecur</td><td>annual potential evaporation for current year (mm)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gdd5cur</td><td>growing degree days above 5 c for current year</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">surmncur</td><td>number of months with surplus water for current year</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">defmncur</td><td>number of months with water deficit for current year</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">srplscur</td><td>water surplus for the current month</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">defctcur</td><td>water deficit for the current month</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">twarmm</td><td>temperature of the warmest month (c)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tcoldm</td><td>temperature of the coldest month (c)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gdd5</td><td>growing degree days above 5 c</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">aridity</td><td>aridity index, ratio of potential evaporation to precipitation</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">srplsmon</td><td>number of months in a year with surplus water i.e. precipitation more than potential evaporation</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">defctmon</td><td>number of months in a year with water deficit i.e. precipitation less than potential evaporation</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">anndefct</td><td>annual water deficit (mm)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">annsrpls</td><td>annual water surplus (mm)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">annpcp</td><td>annual precipitation (mm)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dry_season_length</td><td>annual maximum dry month length (months) </td></tr>
  </table>
  </dd>
</dl>
<p>Find current month</p>
<p>Find if we are at end of month or not</p>
<p>Update monthly temperature for the current month, and other variables. at the end of the month we will have average of all daily temperatures for the current month.</p>
<p>If its the end of the month then store the monthly temperature and set tcurm equal to zero. also check if this month had water deficit or surplus</p>
<p>this loop doubles up the size of the "wet_dry_mon_index" matrix</p>
<p>If its the end of year, then find the temperature of the warmest and the coldest month</p>
<p>Update long term moving average of bioclimatic parameters in an e-folding sense </p>

</div>
</div>
<a id="a008cbfcefd33aaccb8f2b81cf8326451"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a008cbfcefd33aaccb8f2b81cf8326451">&#9670;&nbsp;</a></span>competition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public competition_scheme::competition </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>iday</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nilg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ican), intent(in)&#160;</td>
          <td class="paramname"><em>nol2pfts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>nppveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>dofire</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>leapnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>pftexist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>geremort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>intrmort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>gleafmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>bleafmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>stemmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>rootmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,iccp1), intent(inout)&#160;</td>
          <td class="paramname"><em>litrmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,iccp1), intent(inout)&#160;</td>
          <td class="paramname"><em>soilcmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>grclarea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>lambda</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>burnvegf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(icc), intent(in)&#160;</td>
          <td class="paramname"><em>sort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>pstemmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>pgleafmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>fcancmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,ican), intent(inout)&#160;</td>
          <td class="paramname"><em>fcanmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>vgbiomas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>gavgltms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(inout)&#160;</td>
          <td class="paramname"><em>gavgscms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>bmasveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>add2allo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>colrate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>mortrate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the competition between PFTs based on Lotka-Volterra eqns. ot its modified forms. either option may be used. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">iday</td><td>day of the year</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nilg</td><td>no. of grid cells in latitude circle (this is passed in as either ilg or nlat depending on mos/comp)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il1</td><td>il1=1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il2</td><td>il2=nilg</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dofire</td><td>if true then we have disturbance on.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grclarea</td><td>grid cell area, km^2</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sort</td><td>index for correspondence between 9 ctem pfts and size 12 of parameter vectors</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nol2pfts</td><td>number of level 2 ctem pfts</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pftexist</td><td>indicating pfts exist (T) or not (F)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">leapnow</td><td>true if this year is a leap year. Only used if the switch 'leap' is true.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">geremort</td><td>growth related mortality (1/day)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">intrmort</td><td>intrinsic (age related) mortality (1/day)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lambda</td><td>fraction of npp that is used for spatial expansion</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">burnvegf</td><td>fractional areas burned, for 9 ctem pfts</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pstemmass</td><td>stem mass from previous timestep, is value before fire. used by burntobare subroutine</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgleafmass</td><td>root mass from previous timestep, is value before fire. used by burntobare subroutine</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">nppveg</td><td>npp for each pft type /m2 of vegetated area u-mol co2-c/m2.sec</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bmasveg</td><td>total (gleaf + stem + root) biomass for each ctem pft, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gleafmas</td><td>green leaf mass for each of the 9 ctem pfts, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bleafmas</td><td>brown leaf mass for each of the 9 ctem pfts, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">stemmass</td><td>stem mass for each of the 9 ctem pfts, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rootmass</td><td>root mass for each of the 9 ctem pfts, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">litrmass</td><td>litter mass for each of the 9 ctem pfts + bare, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">soilcmas</td><td>soil carbon mass for each of the 9 ctem pfts + bare, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fcancmx</td><td>fractional coverage of ctem's 9 pfts</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fcanmx</td><td>fractional coverage of class' 4 pfts</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vgbiomas</td><td>grid averaged vegetation biomass, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gavgltms</td><td>grid averaged litter mass, kg c/m2</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gavgscms</td><td>grid averaged soil c mass, kg c/m2</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">add2allo</td><td>npp kg c/m2.day that is used for expansion and subsequently allocated to leaves, stem, and root via the allocation part of the model.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">colrate</td><td>colonization rate (1/day)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mortrate</td><td>mortality rate </td></tr>
  </table>
  </dd>
</dl>
<p>set competition parameters according to the model chosen</p>
<p>First, let's adjust the fractions if fire is turned on.</p>
<p>Since the biomass pools could have changed, update bmasveg.</p>
<p>Do our usual initialization</p>
<p>initial rank/superiority order for simulating competition. since crops are not in competition their rank doesn't matter and therefore we only have icc-2 ranks corresponding to the remaining pfts. the first icc-4 are tree pfts and the last two are the c3 and c4 grasses.</p>
<p>Estimate colonization and mortality rate for each pft, except for crops whose fractional coverage is prescribed.</p>
<p>colonization rate (1/day). the factor (deltat/963.62) converts npp from u-mol co2-c/m2.sec -&gt; kg c/m2.day</p>
<p>mortality rate is the sum of growth related mortality, intrinsic mortality, and an additional mortality that kicks in when long term averaged bioclimatic conditions become unfavourable for a pft. this last term is based on the binary array pftexist.</p>
<p>&mdash;&gt; from here on we assume that we only have icc-numcrops pfts &lt;-&mdash; since crops are not part of the competition.</p>
<p>based on npp for each pft find the competition ranks / superiority order for simulating competition. note that crops are not in competition, so the competition is between the remaining pfts. in addition pfts which shouldn't exist in the grid cell because of unfavourable values of long-term climatic conditions are considered inferior.</p>
<p>bubble sort according to colonization rates NOTE - this only works if no tree species are indexed at positions &gt; numtreepfts, i.e. the trees must be a contiguous unit at the start of the indexes. JM Jun 2014</p>
<p>the rank of c3 and c4 grass is also determined on the basis of their npp but grasses are always assumed to be inferior to tree pfts</p>
<p>with the ranks of all pfts in all grid cells we can now simulate competition between them. for lotka-volterra eqns we need a minimum seeding fraction otherwise the pfts will not expand at all.</p>
<p>arrange colonization and mortality rates, and fractions, according to superiority ranks</p>
<p>update fractions and check if all fractions are +ve</p>
<p>with the minimum seeding fraction prescription, especially for lotka volterra eqns the total veg fraction may exceed 1. to prevent this we need to adjust fractional coverage of all non-crop pfts that do not have the minimum fraction.</p>
<p>check again that total veg frac doesn't exceed 1.</p>
<p>map delfrac to chngfrac so that we get change in fraction corresponding to the actual number of pfts</p>
<p>&mdash;&gt; from here on we get back to our usual icc pfts &lt;-&mdash;</p>
<p>get bare fraction</p>
<p>check if a pft's fractional cover is increasing or decreasing</p>
<p>check if bare fraction increases or decreases</p>
<p>now that we know the change in fraction for every pft we use its npp for spatial expansion and litter generation. we also spread vegetation biomass uniformly over the new fractions, and generate additional litter from mortality if the fractions decrease.</p>
<p>three things can happen here</p>
<ol type="1">
<li>fraciord = 0, which means all npp that was used for expansion becomes litter, due to self/expansion thinning and mortality.</li>
<li>fraciord = 1, which means a part of or full npp is used for expansion but some litter may also be generated. the part of npp that is used for expansion needs to be allocated to leaves, stem, and root. rather than doing this here we will let the allocation part handle this. so allocation module will allocate not only the npp that is used for pure vertical expansion but also this npp. but we will do our part here and spread the vegetation biomass over the new increased fraction.</li>
<li>fraciord = -1, which means all of the npp is to be used for litter generation but in addition some more litter will be generated from mortality of the standing biomass.</li>
</ol>
<p>All npp used for expansion becomes litter plus there is additional mortality of the standing biomass. the npp that becomes litter is now spread over the whole grid cell. all biomass from fraction that dies due to mortality is also distributed over the litter pool of whole grid cell.</p>
<p>if bare fraction decreases then chop off the litter and soil c from the decreased fraction and add it to grsumlit &amp; grsumsoc for spreading over the whole grid cell. if bare fraction increases then spread its litter and soil c uniformly over the increased fraction.</p>
<p>if a pft is not supposed to exist as indicated by pftexist and its fractional coverage is really small then get rid of the pft all together and spread its live and dead biomass over the grid cell.</p>
<p>adjust litter and soil c mass densities for increase in barefrac over the bare fraction.</p>
<p>spread litter and soil c over all pfts and the barefrac</p>
<p>get fcanmxs for use by class based on the new fcancmxs</p>
<p>update grid averaged vegetation biomass, and litter and soil c densities</p>
<p>and finally we check the c balance. we were supposed to use a fraction of npp for competition. some of it is used for expansion (this is what we save for allocation), and the rest becomes litter. so for each pft the total c mass in vegetation and litter pools must all add up to the same value as before competition.</p>
<p>check balance over the bare fraction </p>

</div>
</div>
<a id="a4345a1807f52b8da4f0cdd9f0f71f91f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4345a1807f52b8da4f0cdd9f0f71f91f">&#9670;&nbsp;</a></span>existence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public competition_scheme::existence </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>iday</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nilg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(icc), intent(in)&#160;</td>
          <td class="paramname"><em>sort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ican), intent(in)&#160;</td>
          <td class="paramname"><em>nol2pfts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>twarmm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>tcoldm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>gdd5</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>aridity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>srplsmon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>defctmon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>anndefct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>annsrpls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>annpcp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(nilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>pftexist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nilg), intent(in)&#160;</td>
          <td class="paramname"><em>dry_season_length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determines if a PFT can exist in a grid cell based on climatic conditions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">iday</td><td>day of the year</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nilg</td><td>no. of grid cells in latitude circle (this is passed in as either ilg or nlat depending on mos/comp)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il1</td><td>il1=1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il2</td><td>il2=nilg</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sort</td><td>index for correspondence between 9 ctem pfts and size 12 of parameter vectors</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nol2pfts</td><td>number of level 2 ctem pfts</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">twarmm</td><td>temperature of the warmest month (c)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tcoldm</td><td>temperature of the coldest month (c)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gdd5</td><td>growing degree days above 5 c</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">aridity</td><td>aridity index, ratio of potential evaporation to precipitation</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">srplsmon</td><td>number of months in a year with surplus water i.e. precipitation more than potential evaporation</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">defctmon</td><td>number of months in a year with water deficit i.e. precipitation less than potential evaporation</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">anndefct</td><td>annual water deficit (mm)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">annsrpls</td><td>annual water surplus (mm)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">annpcp</td><td>annual precipitation (mm)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dry_season_length</td><td>length of dry season (months)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pftexist</td><td>binary array indicating pfts exist (=1) or not (=0) </td></tr>
  </table>
  </dd>
</dl>
<hr/>
 <h2>Constants and parameters are located in <a class="el" href="ctem__params_8f90.html" title="This module holds CTEM globally accessible parameters. ">ctem_params.f90</a> </h2>
<p>go through all grid cells and based on bioclimatic parameters decide if a given pft should exist or not.</p>
<p>needleleaf evergreen</p>
<p>needleleaf deciduous</p>
<p>broadleaf evergreen</p>
<p>broadleaf deciduous cold (see note below pft 5 too)</p>
<p>broadleaf deciduous dry</p>
<p>We don't want both broadleaf species co-existing so if it has PFT 5 remove PFT 4.</p>
<p>c3 and c4 crops</p>
<p>c3 grass</p>
<p>if(tcoldm(i).le.tcoldmax(sort(j)))then</p>
<p>else pftexist(i,j)=.false. endif</p>
<p>c4 grass</p>
<p>if(tcoldm(i).ge.tcoldmin(sort(j)))then</p>
<p>else pftexist(i,j)=.false. endif </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacecompetition__scheme.html">competition_scheme</a></li>
    <li class="footer">Generated on Thu Aug 9 2018 16:27:38 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
