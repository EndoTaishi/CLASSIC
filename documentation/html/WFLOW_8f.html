<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: src/WFLOW.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('WFLOW_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">WFLOW.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Evaluates infiltration of water into soil under saturated conditions.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a7a3409d93e2e44adae8e38e9ddd99f97"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="WFLOW_8f.html#a7a3409d93e2e44adae8e38e9ddd99f97">wflow</a> (WMOVE, TMOVE, LZF, NINF, TRMDR, TPOND, ZPOND, R, TR, EVAP, PSIF, GRKINF, THLINF, THLIQX, TBARWX, DELZX, ZBOTX, FMAX, ZF, DZF, DTFLOW, THLNLZ, THLQLZ, DZDISP, WDISP, WABS, ITER, NEND, ISIMP, IGRN, IG, IGP1, IGP2, ILG, IL1, IL2, JL, N)</td></tr>
<tr class="separator:a7a3409d93e2e44adae8e38e9ddd99f97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Evaluates infiltration of water into soil under saturated conditions. </p>
<dl class="section author"><dt>Author</dt><dd>D. Verseghy, M. Lazare, Y. Delage, J. P. Blanchette </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a7a3409d93e2e44adae8e38e9ddd99f97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a3409d93e2e44adae8e38e9ddd99f97">&#9670;&nbsp;</a></span>wflow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wflow </td>
          <td>(</td>
          <td class="paramtype">real, dimension (ilg,igp2)&#160;</td>
          <td class="paramname"><em>WMOVE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,igp2)&#160;</td>
          <td class="paramname"><em>TMOVE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>LZF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>NINF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TRMDR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TPOND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>ZPOND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension        (ilg)&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension       (ilg)&#160;</td>
          <td class="paramname"><em>TR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>EVAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg,igp1)&#160;</td>
          <td class="paramname"><em>PSIF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg,igp1)&#160;</td>
          <td class="paramname"><em>GRKINF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg,igp1)&#160;</td>
          <td class="paramname"><em>THLINF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg,igp1)&#160;</td>
          <td class="paramname"><em>THLIQX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg,igp1)&#160;</td>
          <td class="paramname"><em>TBARWX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg,igp1)&#160;</td>
          <td class="paramname"><em>DELZX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg,igp1)&#160;</td>
          <td class="paramname"><em>ZBOTX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>FMAX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension       (ilg)&#160;</td>
          <td class="paramname"><em>ZF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>DZF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>DTFLOW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>THLNLZ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>THLQLZ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>DZDISP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>WDISP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>WABS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>ITER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>NEND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg)&#160;</td>
          <td class="paramname"><em>ISIMP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>IGRN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IGP1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IGP2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ILG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>JL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>N</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wmove</td><td>Water movement matrix <img class="formulaInl" alt="$[m^3 m^{-2}]$" src="form_1482.png"/></td></tr>
    <tr><td class="paramname">tmove</td><td>Temperature matrix associated with ground water movement [C]</td></tr>
    <tr><td class="paramname">lzf</td><td>Index of soil layer in which wetting front is located</td></tr>
    <tr><td class="paramname">ninf</td><td>Number of levels involved in water movement</td></tr>
    <tr><td class="paramname">trmdr</td><td>Time remaining in current time step [s]</td></tr>
    <tr><td class="paramname">tpond</td><td>Temperature of ponded water [C]</td></tr>
    <tr><td class="paramname">zpond</td><td>Depth of ponded water <img class="formulaInl" alt="$[m] (z_p)$" src="form_407.png"/></td></tr>
    <tr><td class="paramname">r</td><td>Rainfall rate at ground surface <img class="formulaInl" alt="$[m s^{-1}]$" src="form_122.png"/></td></tr>
    <tr><td class="paramname">tr</td><td>Temperature of rainfall [C]</td></tr>
    <tr><td class="paramname">evap</td><td>Surface evaporation rate <img class="formulaInl" alt="$[m s^{-1}]$" src="form_122.png"/></td></tr>
    <tr><td class="paramname">psif</td><td>Soil water suction across the wetting front <img class="formulaInl" alt="$[m] (\Psi_f)$" src="form_1501.png"/></td></tr>
    <tr><td class="paramname">grkinf</td><td>Hydraulic conductivity of soil behind the wetting front <img class="formulaInl" alt="$[m s^{-1}] (K)$" src="form_1502.png"/></td></tr>
    <tr><td class="paramname">thlinf</td><td>Volumetric liquid water content behind the wetting front <img class="formulaInl" alt="$[m^3 m^{-3}]$" src="form_221.png"/></td></tr>
    <tr><td class="paramname">thliqx</td><td>Volumetric liquid water content of soil layer <img class="formulaInl" alt="$[m^3 m^{-3}]$" src="form_221.png"/></td></tr>
    <tr><td class="paramname">tbarwx</td><td>Temperature of water in soil layer [C]</td></tr>
    <tr><td class="paramname">delzx</td><td>Permeable depth of soil layer <img class="formulaInl" alt="$[m] (\Delta z_{z,w})$" src="form_1503.png"/></td></tr>
    <tr><td class="paramname">zbotx</td><td>Depth of bottom of soil layer [m]</td></tr>
    <tr><td class="paramname">fmax</td><td>Maximum infiltration rate, defined as minimum value of GRKINF</td></tr>
    <tr><td class="paramname">zf</td><td>Depth of the wetting front <img class="formulaInl" alt="$[m] (z_f)$" src="form_1504.png"/></td></tr>
    <tr><td class="paramname">igrn</td><td>Flag to indicate whether infiltration is occurring </td></tr>
  </table>
  </dd>
</dl>
<p>General calculations performed: The infiltration rate <img class="formulaInl" alt="$F_{inf}$" src="form_1483.png"/> under saturated conditions is calculated as</p>
<p><img class="formulaInl" alt="$F_{inf} = K_{inf} [(\Psi_f + z_f + z_p)/z_f ]$" src="form_1505.png"/></p>
<p>where <img class="formulaInl" alt="$K_{inf}$" src="form_763.png"/> is the hydraulic conductivity of the soil behind the wetting front, <img class="formulaInl" alt="$\Psi_f$" src="form_1486.png"/> is the soil moisture suction across the wetting front, <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> is the depth of the wetting front, and <img class="formulaInl" alt="$z_p$" src="form_949.png"/> is the depth of water ponded on the surface. Since <img class="formulaInl" alt="$\Psi_f$" src="form_1486.png"/> will vary by soil layer, and <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> and <img class="formulaInl" alt="$z_p$" src="form_949.png"/> will vary with time, the period of infiltration is divided into two-minute segments. A maximum iteration flag NEND is defined as the number of iteration segments plus 100, as a safeguard against runaway iterations. Since the surface infiltration rate will be limited by the lowest infiltration rate encountered, a maximum infiltration rate FMAX is defined as the minimum value of GRKINF, the hydraulic conductivity behind the wetting front, in all of the soil layers above and including that containing the wetting front.</p>
<p>In loop 200, a check is performed to determine whether the liquid water content of the current soil layer, THLIQX, equals or exceeds that behind the wetting front, THLINF. If so, the depth of the wetting front is reset to the depth of the soil layer. The water content of the soil layer is assigned to the level of the water movement matrix WMOVE corresponding to the soil layer index plus 1, and the temperature of the water in the layer is assigned to the same level of the matrix TMOVE. FMAX is recalculated, and the flags LZF and NINF are each incremented by 1. The flag ISIMP is set to 1, indicating that the following calculations are to be bypassed for this iteration.</p>
<p>If ISIMP is not 1, the time period DTFLOW applying to the current iteration loop is set to two minutes or to the remainder of the time step, whichever is less. If GRKINF for the current soil layer is not vanishingly small, the flag ISIMP is set to -2. Otherwise, it is deemed that infiltration is suppressed, and the temperature and depth of water ponded on the surface are simply updated. The temperature of the ponded water is calculated as the weighted average of the current pond temperature and the rainfall added to it. The ponded water remaining after rainfall and evaporation have taken place is calculated as ZPTEST. If ZPTEST is less than zero, it is deduced that evaporation must have removed the ponded water before the end of the current iteration loop. If this is the case, the time period of the current iteration loop is recalculated as the amount of time required for the difference between the evaporation and the rainfall rates to consume the ponded water, and the pond depth ZPOND is set to zero. Otherwise, ZPOND is set to ZPTEST. Finally, ISIMP is set to -1.</p>
<p>The 400 loop addresses the infiltration process under saturated conditions. Such infiltration is modelled as “piston flow”. First the current infiltration rate FINF is calculated using the equation given above. If the wetting front has passed the bottom of the lowest soil layer, PSIF Cis neglected. If FINF is greater than the rainfall rate R, FINF is set equal to R; if FINF is greater than CFMAX, FINF is set equal to FMAX. If the wetting front has not passed the bottom of the lowest soil layer, the change in depth of the wetting front DZF over the current time interval is calculated from the amount of infiltrating water WINF and the volumetric water content behind the wetting front, THLINF. The amount of soil water WDISP displaced by this movement of the wetting front is calculated from DZF and THLIQX, and the depth to which this water penetrates, DZDISP, is calculated as WDISP/(THLINF – THLIQX). The amount of soil water WABS entrained by the movement of WDISP itself is calculated as the product of DZDISP and THLIQX. The change in depth of the wetting front, behind which the liquid water content of the soil layer is THLINF, is now the sum of the depth represented by infiltration of water at the surface, DZF, and the depth represented by displacement of the pre-existing soil water, DZDISP. If this change in depth causes the wetting front to move beyond the bottom of the current soil layer, DTFLOW is recalculated as the amount of time required for the composite wetting front to reach the bottom of the soil layer, and DZF, WDISP, DZDISP and WABS are likewise recalculated. As in the case for ISIMP = -1, the temperature of the ponded water on the surface is calculated as the weighted average of the current pond temperature and the rainfall added to it. The ponded water remaining after rainfall, infiltration and evaporation have taken place is calculated as ZPTEST. If ZPTEST is less than zero, it is deduced that infiltration and evaporation must have removed the ponded water before the end of the current iteration loop. If this is the case, the time period of the current iteration loop is recalculated as the amount of time required for the infiltration and evaporation minus the rainfall to consume the ponded water. The pond depth ZPOND is set to zero; if the wetting front has not passed the bottom of the lowest soil layer, DZF, WDISP, DZDISP and WABS are recalculated. Otherwise, ZPOND is set to ZPTEST. Finally, the first layer of the water movement matrix WMOVE is incremented with the amount of the infiltrated water, and the first layer of the matrix TMOVE with the temperature of the infiltrated water. The last layer of WMOVE is incremented by WDISP+WABS, and the depth of the wetting front by DZF+DZDISP.</p>
<p>In the 500 loop, if ISIMP &lt; 0 (i.e. water movement has occurred), the time remaining in the current time step is recalculated. If the wetting front is at a soil layer boundary, if the time remaining is non-zero, if the wetting front is still within the modelled soil column, and if the calculated water content behind the wetting front is greater than zero, FMAX is updated, and LZF and NINF are incremented by 1. The NINF level of the TMOVE matrix is set to the water temperature of the new soil layer.</p>
<p>At the end of the iteration pass, checks are done in the 600 loop to ascertain whether the number of iteration passes is still less than NEND, whether either ponded water still exists or rain is still falling, and whether there is still time remaining in the current time step. If these conditions are all fulfilled, the counter NPNTS representing the number of points in the current vector of mosaic tiles for which infiltration is still occurring is incremented by 1. Otherwise, the iteration flag for the current tile is changed from 1 to 0, signaling the end of the saturated infiltration calculations for that tile.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="WFLOW_8f.html">WFLOW.f</a></li>
    <li class="footer">Generated on Wed Nov 21 2018 15:59:12 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
