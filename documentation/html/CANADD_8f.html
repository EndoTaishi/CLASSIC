<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: src/CANADD.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('CANADD_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">CANADD.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Calculates canopy interception of rainfall and snowfall, and determines rainfall/snowfall rates at ground surface as a result of throughfall and unloading.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ae4481b561c2022da57ec7a4dacf6a9df"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="CANADD_8f.html#ae4481b561c2022da57ec7a4dacf6a9df">canadd</a> (IWATER, R, TR, S, TS, RAICAN, SNOCAN, TCAN, CHCAP, HTCC, ROFC, ROVG, PCPN, PCPG, FI, FSVF, CWLCAP, CWFCAP, CMASS, RHOSNI, TSURX, RDRIP, SDRIP, ILG, IL1, IL2, JL)</td></tr>
<tr class="separator:ae4481b561c2022da57ec7a4dacf6a9df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Calculates canopy interception of rainfall and snowfall, and determines rainfall/snowfall rates at ground surface as a result of throughfall and unloading. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ae4481b561c2022da57ec7a4dacf6a9df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4481b561c2022da57ec7a4dacf6a9df">&#9670;&nbsp;</a></span>canadd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine canadd </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IWATER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>TR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>TS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>RAICAN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>SNOCAN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>TCAN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>CHCAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>HTCC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>ROFC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>ROVG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>PCPN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>PCPG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>FI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>FSVF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>CWLCAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>CWFCAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>CMASS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg)&#160;</td>
          <td class="paramname"><em>RHOSNI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TSURX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>RDRIP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>SDRIP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ILG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>JL</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>Rainfall rate over subarea in question <img class="formulaInl" alt="$[m s^{-1}]$" src="form_122.png"/></td></tr>
    <tr><td class="paramname">tr</td><td>Temperature of rainfall [C]</td></tr>
    <tr><td class="paramname">s</td><td>Snowfall rate over subarea in question <img class="formulaInl" alt="$[m s^{-1}]$" src="form_122.png"/></td></tr>
    <tr><td class="paramname">ts</td><td>Temperature of snowfall [C]</td></tr>
    <tr><td class="paramname">raican</td><td>Intercepted liquid water stored on the canopy <img class="formulaInl" alt="$[kg m^{-2}] (W_{l,c})$" src="form_123.png"/></td></tr>
    <tr><td class="paramname">snocan</td><td>Intercepted frozen water stored on the canopy <img class="formulaInl" alt="$[kg m^{-2}] (W_{f,c})$" src="form_124.png"/></td></tr>
    <tr><td class="paramname">tcan</td><td>Temperature of vegetation canopy <img class="formulaInl" alt="$[K] (T_c)$" src="form_125.png"/></td></tr>
    <tr><td class="paramname">chcap</td><td>Heat capacity of vegetation canopy <img class="formulaInl" alt="$[J m^{-2} K^{-1}] (C_c)$" src="form_126.png"/></td></tr>
    <tr><td class="paramname">htcc</td><td>Internal energy change of canopy due to changes in temperature and/or mass <img class="formulaInl" alt="$[W m^{-2}] (I_c)$" src="form_127.png"/></td></tr>
    <tr><td class="paramname">rofc</td><td>Liquid/frozen water runoff from vegetation <img class="formulaInl" alt="$[kg m^{-2} s^{-1}]$" src="form_128.png"/></td></tr>
    <tr><td class="paramname">rovg</td><td>Liquid/frozen water runoff from vegetation to ground surface <img class="formulaInl" alt="$[kg m^{-2} s^{-1}]$" src="form_128.png"/></td></tr>
    <tr><td class="paramname">pcpn</td><td>Precipitation incident on snow pack <img class="formulaInl" alt="$[kg m^{-2} s^{-1}]$" src="form_128.png"/></td></tr>
    <tr><td class="paramname">pcpg</td><td>Precipitation incident on ground <img class="formulaInl" alt="$[kg m^{-2} s^{-1}]$" src="form_128.png"/></td></tr>
    <tr><td class="paramname">fi</td><td>Fractional coverage of subarea in question on modelled area <img class="formulaInl" alt="$[ ] (X_i)$" src="form_129.png"/></td></tr>
    <tr><td class="paramname">fsvf</td><td>Sky view factor of surface under vegetation canopy [ ]</td></tr>
    <tr><td class="paramname">cwlcap</td><td>Interception storage capacity of vegetation for liquid water <img class="formulaInl" alt="$[kg m^{-2}]$" src="form_130.png"/></td></tr>
    <tr><td class="paramname">cwfcap</td><td>Interception storage capacity of vegetation for frozen water <img class="formulaInl" alt="$[kg m^{-2}] (W_{f,max})$" src="form_131.png"/></td></tr>
    <tr><td class="paramname">cmass</td><td>Mass of vegetation canopy <img class="formulaInl" alt="$[kg m^{-2}]$" src="form_130.png"/></td></tr>
    <tr><td class="paramname">rhosni</td><td>Density of fresh snow <img class="formulaInl" alt="$[kg m^{-3}]$" src="form_132.png"/></td></tr>
    <tr><td class="paramname">tsurx</td><td>Ground or snow surface temperature of subarea [K] </td></tr>
  </table>
  </dd>
</dl>
<p>The calculations in this subroutine are performed if the rainfall or snowfall rates over the modelled area are greater than zero, or if the intercepted liquid water RAICAN or frozen water SNOCAN is greater than zero (to allow for unloading). The throughfall of rainfall or snowfall incident on the canopy, RTHRU or STHRU, is calculated from FSVF, the canopy gap fraction or sky view factor. The remaining rainfall or snowfall is assigned to interception, as RINT and SINT. The resulting temperature of liquid water on the canopy, TRCAN, is calculated as a weighted average of RAICAN at the canopy temperature TCAN, and RINT at the rainfall temperature TR. The resulting temperature of frozen water on the canopy, TSCAN, is calculated as a weighted average of SNOCAN at the canopy temperature TCAN, and SINT at the snowfall temperature TS.</p>
<p>Calculations are now done to ascertain whether the total liquid water on the canopy exceeds the liquid water interception capacity CWLCAP. If such is the case, this excess is assigned to RDRIP, water dripping off the canopy. The rainfall rate reaching the surface under the canopy is calculated as RDRIP + RTHRU, and the temperature of this water flux is calculated as a weighted average of RDRIP at a temperature of TRCAN, and RTHRU at the original rainfall temperature TR. The remaining intercepted water becomes CWLCAP. Otherwise, the rainfall rate reaching the surface under the canopy is set to RTHRU, and the liquid water on the canopy RAICAN is augmented by RINT.</p>
<p>Interception and unloading of snow on the canopy is calculated using a more complex method. The amount of snow intercepted during a snowfall event over a time step, <img class="formulaInl" alt="$\Delta W_{f,i}$" src="form_133.png"/> , or SLOAD, is obtained from the initial intercepted snow amount <img class="formulaInl" alt="$W_{f,c}$" src="form_134.png"/> and the interception capacity <img class="formulaInl" alt="$W_{f,max}$" src="form_36.png"/> , following Hedstrom and Pomeroy (1998), as:</p>
<p><img class="formulaInl" alt="$\Delta W_{f,i} = (W_{f,max} – W_{f,c} ) [1 – exp(-S_{int} /W_{f,max} )]$" src="form_135.png"/></p>
<p>where <img class="formulaInl" alt="$S_{int}$" src="form_136.png"/> is the amount of snow incident on the canopy during the time step. The amount of snow not stored by interception, SWXCES, is calculated as SINT – SLOAD. Between and during precipitation events, snow is unloaded from the canopy through wind gusts and snow densification. These effects of these processes are estimated using an empirical exponential relationship for the snow unloading rate <img class="formulaInl" alt="$W_{f,u}$" src="form_137.png"/> or SNUNLD, again following Hedstrom and Pomeroy (1998):</p>
<p><img class="formulaInl" alt="$W_{f,u} = {W_{f,c} + \Delta W_{f,i} } exp (-U \Delta t)$" src="form_138.png"/></p>
<p>where U is a snow unloading coefficient, assigned a value of <img class="formulaInl" alt="$0.1 d^{-1}$" src="form_139.png"/> or <img class="formulaInl" alt="$1.157 * 10^{-6} s{-1}$" src="form_140.png"/>. The sum of SWXCES and SNUNLD is assigned to SDRIP, the snow or frozen water falling off the canopy. The snowfall rate reaching the surface under the canopy is calculated as SDRIP + STHRU, and the temperature of this water flux is calculated as a weighted average of SDRIP at a temperature of TSCAN, and STHRU at the original snowfall temperature TS. The frozen water stored on the canopy is recalculated as SNOCAN + SINT – SWXCES - SNUNLD. Otherwise, the snowfall rate reaching the surface under the canopy is set to STHRU, and SNOCAN is augmented by SINT.</p>
<p>In the final section of the subroutine, the initial heat capacity and temperature of the canopy are saved in temporary variables. The new canopy heat capacity is calculated as a weighted average over the specific heats of the liquid and frozen water stored on the canopy and the canopy mass. The canopy temperature is calculated as a weighted average over the stored liquid and frozen water at the updated temperatures TRCAN and TSCAN, and the vegetation mass at the original temperature TCAN. Then the change in internal energy <img class="formulaInl" alt="$I_c$" src="form_141.png"/> of the vegetation canopy as a result of the water movement above is calculated as the difference in <img class="formulaInl" alt="$I_c$" src="form_141.png"/> before and after these processes: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Delta I_c = X_i \Delta [C_c T_c ] / \Delta t \]" src="form_142.png"/>
</p>
<p> where <img class="formulaInl" alt="$C_c$" src="form_143.png"/> represents the canopy heat capacity, <img class="formulaInl" alt="$T_c$" src="form_144.png"/> the canopy temperature, <img class="formulaInl" alt="$\Delta t$" src="form_145.png"/> the length of the time step, and <img class="formulaInl" alt="$X_i$" src="form_39.png"/> the fractional coverage of the subarea under consideration relative to the modelled area.</p>
<p>Finally, the rainfall and snowfall temperatures are converted to degrees C. (In the absence of precipitation, both are set equal to the surface temperature of the subarea to avoid floating point errors in later subroutines.) For subareas with a snow cover (IWATER = 2), the water running off the canopy and the precipitation incident on the snow pack are updated using RDRIP and SDRIP. For subareas without snow cover (IWATER = 1), the water running off the canopy is updated using RDRIP and SDRIP, the precipitation incident on the snow pack is augmented by SDRIP, and the precipitation incident on bare ground is augmented by RDRIP.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="CANADD_8f.html">CANADD.f</a></li>
    <li class="footer">Generated on Fri Aug 10 2018 14:49:11 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
