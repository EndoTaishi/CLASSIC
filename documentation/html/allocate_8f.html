<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: src/allocate.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('allocate_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">allocate.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Performs allocation of carbon gained by photosynthesis into plant structural pools.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ac0ca89fb52b50245b0c781a7dadb2d71"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="allocate_8f.html#ac0ca89fb52b50245b0c781a7dadb2d71">allocate</a> (lfstatus, thliq, ailcg, ailcb, il1, il2, sand, clay, rmatctem, gleafmas, stemmass, rootmass, sort, nol2pfts, fcancmx, isand, afrleaf, afrstem, afrroot, wtstatus, ltstatus, THFC, THLW)</td></tr>
<tr class="separator:ac0ca89fb52b50245b0c781a7dadb2d71"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Performs allocation of carbon gained by photosynthesis into plant structural pools. </p>
<dl class="section author"><dt>Author</dt><dd>Vivek Arora, Joe Melton</dd></dl>
<p>Positive NPP is allocated daily to the leaf, stem and root components, which generally causes their respective biomass to increase, although the biomass may also decrease depending on the autotrophic respiration flux of a component. Negative NPP generally causes net carbon loss from the components. While CTEM offers the ability to use both specified constant or dynamically calculated allocation fractions for leaves, stems and roots, in practice the dynamic allocation fractions are primarily used. The formulation used in CTEM v. 2.0 differs from that for CTEM v. 1.0 as described in Arora and Boer (2005) <a class="el" href="citelist.html#CITEREF_Arora2005-6b1">[6]</a> only in the parameter values.</p>
<p>The dynamic allocation to the live plant tissues is based on the light, water and leaf phenological status of vegetation. The preferential allocation of carbon to the different tissue pools is based on three assumptions: (i) if soil moisture is limiting, carbon should be preferentially allocated to roots for greater access to water, (ii) if LAI is low, carbon should be allocated to leaves for enhanced photosynthesis and finally (iii) carbon is allocated to the stem to increase vegetation height and lateral spread of vegetation when the increase in LAI results in a decrease in light penetration.</p>
<p>The vegetation water status, <img class="formulaInl" alt="$W$" src="form_0.png"/>, is determined as a linear scalar quantity that varies between 0 and 1 for each PFT and calculated by weighting the degree of soil saturation ( <img class="formulaInl" alt="$\phi_{i} (\theta_{i} )$" src="form_1516.png"/>) with the fraction of roots in each soil layer</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ W = \phi_{root} = \sum_{i=1}^g \phi_{i}(\theta_{i}) r_{i}. \hspace{10pt}[Eqn 1]\]" src="form_1517.png"/>
</p>
<p>The light status, <img class="formulaInl" alt="$L$" src="form_2.png"/>, is parametrized as a function of LAI and nitrogen extinction coefficient, <img class="formulaInl" alt="$k_\mathrm{n}$" src="form_3.png"/> (PFT-dependent; see also <a class="el" href="classic__params_8f90.html" title="This module holds CLASSIC globally accessible parameters. ">classic_params.f90</a>), as for trees and crops:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ L = \exp(-k_\mathrm{n} LAI) ;\hspace{10pt}[Eqn 2]\]" src="form_1518.png"/>
</p>
<p>and for grasses:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ L = \max\left(0,1-\frac{LAI}{4.5}\right). \hspace{10pt}[Eqn 3]\]" src="form_1519.png"/>
</p>
<p>For PFTs with a stem component (i.e. tree and crop PFTs), the fractions of positive NPP allocated to stem ( <img class="formulaInl" alt="$a_{fS}$" src="form_5.png"/>), leaf ( <img class="formulaInl" alt="$a_{fL}$" src="form_6.png"/>) and root ( <img class="formulaInl" alt="$a_{fR}$" src="form_7.png"/>) components are calculated as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ a_{fS}=\frac{\epsilon_\mathrm{S}+\omega_\mathrm{a}(1-L)}{1+\omega_\mathrm{a}(2-L-W)}, \hspace{10pt}[Eqn 4] \]" src="form_1520.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ a_{fR}=\frac{\epsilon_\mathrm{R}+ \omega_\mathrm{a}(1-W)}{1+\omega_\mathrm{a}(2-L-W)}, \hspace{10pt}[Eqn 5]\]" src="form_1521.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ a_{fL}=\frac{\epsilon_\mathrm{L}}{1+\omega_\mathrm{a}(2-L-W)}= 1-a_{fS}-a_{fR}. \hspace{10pt}[Eqn 6]\]" src="form_1522.png"/>
</p>
<p>The base allocation fractions for each component (leaves &ndash; <img class="formulaInl" alt="$\epsilon_\mathrm{L}$" src="form_11.png"/>, stem &ndash; <img class="formulaInl" alt="$\epsilon_\mathrm{S}$" src="form_12.png"/>, and roots &ndash; <img class="formulaInl" alt="$\epsilon_\mathrm{R}$" src="form_13.png"/>) are PFT-dependent (see also <a class="el" href="classic__params_8f90.html" title="This module holds CLASSIC globally accessible parameters. ">classic_params.f90</a>) and sum to 1, i.e. <img class="formulaInl" alt="$\epsilon_\mathrm{L} + \epsilon_\mathrm{S} + \epsilon_\mathrm{R} = 1$" src="form_14.png"/>. The parameter <img class="formulaInl" alt="$\omega_\mathrm{a}$" src="form_15.png"/>, which varies by PFT (see also <a class="el" href="classic__params_8f90.html" title="This module holds CLASSIC globally accessible parameters. ">classic_params.f90</a>), determines the sensitivity of the allocation scheme to changes in <img class="formulaInl" alt="$W$" src="form_0.png"/> and <img class="formulaInl" alt="$L$" src="form_2.png"/>. Larger values of <img class="formulaInl" alt="$\omega_\mathrm{a}$" src="form_15.png"/> yield higher sensitivity to changes in <img class="formulaInl" alt="$L$" src="form_2.png"/> and <img class="formulaInl" alt="$W$" src="form_0.png"/>.</p>
<p>Grasses do not have a stem component (i.e. <img class="formulaInl" alt="$a_{fS}=0$" src="form_16.png"/>) and the allocation fractions for leaf and root components are given by</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ a_{fL}=\frac{\epsilon_\mathrm{L}+\omega_\mathrm{a} L}{1+\omega_\mathrm{a}(1+L-W)} ;\hspace{10pt}[Eqn 7]\]" src="form_1523.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ a_{fR}=\frac{\epsilon_\mathrm{R}+\omega_\mathrm{a}(1-W)}{1+\omega_\mathrm{a}(1+L-W)}. \hspace{10pt}[Eqn 8]\]" src="form_1524.png"/>
</p>
<p>The above equations (4-8) ensure that the allocation fractions add up to one ( <img class="formulaInl" alt="$a_{fL} + a_{fR} + a_{fS} = 1$" src="form_18.png"/>).</p>
<p>The dynamic allocation fractions are superseded under three conditions. First, during the leaf onset for crops and deciduous trees, all carbon must be allocated to leaves ( <img class="formulaInl" alt="$a_{fL} = 1$" src="form_19.png"/>, <img class="formulaInl" alt="$a_{fS} = a_{fR} = 0$" src="form_20.png"/>). Second, the proportion of stem plus root biomasses to leaf biomass must satisfy the relationship: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ C_\mathrm{S} + C_\mathrm{R} = \eta C_\mathrm{L}^{\kappa}, \hspace{10pt}[Eqn 9]\]" src="form_1525.png"/>
</p>
<p>where <img class="formulaInl" alt="$C_\mathrm{S}$" src="form_22.png"/>, <img class="formulaInl" alt="$C_\mathrm{R}$" src="form_23.png"/> and <img class="formulaInl" alt="$C_\mathrm{L}$" src="form_24.png"/> are the carbon in the stem, root and leaves, respectively. The parameter <img class="formulaInl" alt="$\eta$" src="form_25.png"/> is PFT-specific (see also <a class="el" href="classic__params_8f90.html" title="This module holds CLASSIC globally accessible parameters. ">classic_params.f90</a>) and parameter <img class="formulaInl" alt="$\kappa$" src="form_26.png"/> has a value of 1.6 for trees and crops and 1.2 for grasses. Both parameters are based on the Frankfurt Biosphere Model (FBM) Ludeke et al. (1994) <a class="el" href="citelist.html#CITEREF_Ludeke1994-px">[60]</a>. This constraint (Eq. 9) is based on the physical requirement of sufficient stem and root tissues to support a given leaf biomass. As grasses have no stem component, Eq. 9 determines their root to shoot ratio (i.e. the ratio of belowground to aboveground biomass). The final condition ensures that a minimum realistic root to shoot ratio is maintained for all PFTs ( <img class="formulaInl" alt="${lr}_{min}$" src="form_27.png"/>, see also <a class="el" href="classic__params_8f90.html" title="This module holds CLASSIC globally accessible parameters. ">classic_params.f90</a>). Root mass is required for nutrient and water uptake and support for the aboveground biomass. If the minimum root to shoot ratio is not being maintained, carbon is allocated preferentially to roots. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ac0ca89fb52b50245b0c781a7dadb2d71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0ca89fb52b50245b0c781a7dadb2d71">&#9670;&nbsp;</a></span>allocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine allocate </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>lfstatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>thliq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>ailcg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>ailcb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>sand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>clay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc,ignd)&#160;</td>
          <td class="paramname"><em>rmatctem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>gleafmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>stemmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>rootmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(icc)&#160;</td>
          <td class="paramname"><em>sort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ican)&#160;</td>
          <td class="paramname"><em>nol2pfts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>fcancmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>isand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>afrleaf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>afrstem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>afrroot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>wtstatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>ltstatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>THFC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>THLW</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">il1</td><td>input: il1=1</td></tr>
    <tr><td class="paramname">il2</td><td>input: il2=ilg</td></tr>
    <tr><td class="paramname">lfstatus</td><td>input: leaf status. an integer indicating if leaves are in "max. growth", "normal growth", "fall/harvest", or "no leaves" mode. see phenolgy subroutine for more details.</td></tr>
    <tr><td class="paramname">sort</td><td>input: index for correspondence between 9 pfts and the 12 values in parameters vectors</td></tr>
    <tr><td class="paramname">nol2pfts</td><td>input: number of level 2 ctem pfts</td></tr>
    <tr><td class="paramname">ailcg</td><td>input: green or live leaf area index</td></tr>
    <tr><td class="paramname">ailcb</td><td>input: brown or dead leaf area index</td></tr>
    <tr><td class="paramname">thliq</td><td>input: liquid soil moisture content in 3 soil layers</td></tr>
    <tr><td class="paramname">thlw</td><td>input: wilting point soil moisture content</td></tr>
    <tr><td class="paramname">thfc</td><td>input: field capacity soil moisture content</td></tr>
    <tr><td class="paramname">rootmass</td><td>input: root mass for each of the 9 ctem pfts, kg c/m2</td></tr>
    <tr><td class="paramname">rmatctem</td><td>input: fraction of roots in each soil layer for each pft</td></tr>
    <tr><td class="paramname">gleafmas</td><td>input: green or live leaf mass in kg c/m2, for the 9 pfts</td></tr>
    <tr><td class="paramname">stemmass</td><td>input: stem mass for each of the 9 ctem pfts, kg c/m2</td></tr>
    <tr><td class="paramname">sand</td><td>input: percentage sand</td></tr>
    <tr><td class="paramname">clay</td><td>input: percentage clay</td></tr>
    <tr><td class="paramname">afrleaf</td><td>output: allocation fraction for leaves</td></tr>
    <tr><td class="paramname">afrstem</td><td>output: allocation fraction for stem</td></tr>
    <tr><td class="paramname">afrroot</td><td>output: allocation fraction for root</td></tr>
    <tr><td class="paramname">fcancmx</td><td>input: max. fractional coverage of ctem's 9 pfts, but this can be modified by land-use change, and competition between pfts</td></tr>
    <tr><td class="paramname">wtstatus</td><td>output: soil water status (0 dry -&gt; 1 wet)</td></tr>
    <tr><td class="paramname">ltstatus</td><td>output: light status </td></tr>
  </table>
  </dd>
</dl>
<p>Calculate liquid soil moisture content, and wilting and field capacity soil moisture contents averaged over the root zone. note that while the soil moisture content is same under the entire gcm grid cell, soil moisture averaged over the rooting depth is different for each pft because of different fraction of roots present in each soil layer.</p>
<p>Using liquid soil moisture content together with wilting and field capacity soil moisture contents averaged over the root zone, find soil water status.</p>
<p>Calculate light status as a function of lai and light extinction parameter. for now set nitrogen status equal to 1, which means nitrogen is non-limiting.</p>
<p>allocation to roots is determined by min. of water and nitrogen status</p>
<p>now that we know water, light, and nitrogen status we can find allocation fractions for leaves, stem, and root components. note that allocation formulae for grasses are different from those for trees and crops, since there is no stem component in grasses.</p>
<p>if using constant allocation factors then replace the dynamically calculated allocation fractions.</p>
<p>make sure allocation fractions add to one</p>
<p>the allocation fractions calculated above are overridden by two rules.</p>
<p>rule 1 which states that at the time of leaf onset which corresponds to leaf status equal to 1, more c is allocated to leaves so that they can grow asap. in addition when leaf status is "fall/harvest" then nothing is allocated to leaves.</p>
<p>rule 2 overrides rule 1 above and makes sure that we do not allow the amount of leaves on trees and crops (i.e. pfts 1 to 7) to exceed an amount such that the remaining woody biomass cannot support. if this happens, allocation to leaves is reduced and most npp is allocated to stem and roots, in a proportion based on calculated afrstem and afrroot. for grasses this rule essentially constrains the root:shoot ratio, meaning that the model grasses can't have lots of leaves without having a reasonable amount of roots.</p>
<p>make sure that root:shoot ratio is at least equal to rtsrmin. if not allocate more to root and decrease allocation to stem.</p>
<p>finally check if all allocation fractions are positive and check again they all add to one.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="allocate_8f.html">allocate.f</a></li>
    <li class="footer">Generated on Fri Nov 9 2018 11:01:13 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
