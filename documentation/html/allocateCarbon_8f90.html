<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: src/allocateCarbon.f90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('allocateCarbon_8f90.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Modules</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">allocateCarbon.f90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Performs allocation of carbon gained by photosynthesis into plant structural pools.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Modules</h2></td></tr>
<tr class="memitem:namespaceallocateCarbon"><td class="memItemLeft" align="right" valign="top">module &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceallocateCarbon.html">allocateCarbon</a></td></tr>
<tr class="memdesc:namespaceallocateCarbon"><td class="mdescLeft">&#160;</td><td class="mdescRight">Positive NPP is allocated daily to the leaf, stem and root components, which generally causes their respective biomass to increase, although the biomass may also decrease depending on the autotrophic respiration flux of a component. Negative NPP generally causes net carbon loss from the components. While CTEM offers the ability to use both specified constant or dynamically calculated allocation fractions for leaves, stems and roots, in practice the dynamic allocation fractions are primarily used. The formulation used in CTEM v. 2.0 differs from that for CTEM v. 1.0 as described in Arora and Boer (2005) <a class="el" href="citelist.html#CITEREF_Arora2005-6b1">[6]</a> only in the parameter values. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:afc0495b5c8f58b0458ce04db74a07c46"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="allocateCarbon_8f90.html#afc0495b5c8f58b0458ce04db74a07c46">allocatecarbon::updatepoolsallocaterepro</a> (il1, il2, ilg, sort, ailcg, lfstatus, nppveg, PFTCompetition, pftexist, gppveg, rmsveg, rmrveg, rmlveg, fcancmx, useTracer, tracerNPP, rmsTracer, rmrTracer, tracerRML, tracerGPP, lambda, afrleaf, afrstem, afrroot, gleafmas, stemmass, rootmass, bleafmas, tracerGLeafMass, tracerStemMass, tracerRootMass, tracerBLeafMass, reprocost, ntchlveg, ntchsveg, ntchrveg, repro_cost_g, tracerReproCost)</td></tr>
<tr class="memdesc:afc0495b5c8f58b0458ce04db74a07c46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs allocation of carbon gained by photosynthesis into plant structural pools.  <a href="allocateCarbon_8f90.html#afc0495b5c8f58b0458ce04db74a07c46">More...</a><br /></td></tr>
<tr class="separator:afc0495b5c8f58b0458ce04db74a07c46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a19a819ec675188073ca3ab8fec3fb92c"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="allocateCarbon_8f90.html#a19a819ec675188073ca3ab8fec3fb92c">allocatecarbon::allocate</a> (lfstatus, thliq, ailcg, ailcb, il1, il2, ilg, sand, clay, rmatctem, gleafmas, stemmass, rootmass, sort, fcancmx, isand, THFC, THLW, afrleaf, afrstem, afrroot, wtstatus, ltstatus)</td></tr>
<tr class="memdesc:a19a819ec675188073ca3ab8fec3fb92c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs allocation of carbon gained by photosynthesis into plant structural pools.  <a href="allocateCarbon_8f90.html#a19a819ec675188073ca3ab8fec3fb92c">More...</a><br /></td></tr>
<tr class="separator:a19a819ec675188073ca3ab8fec3fb92c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Performs allocation of carbon gained by photosynthesis into plant structural pools. </p>
<dl class="section author"><dt>Author</dt><dd>Vivek Arora, Joe Melton </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="file_a19a819ec675188073ca3ab8fec3fb92c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#file_a19a819ec675188073ca3ab8fec3fb92c">&#9670;&nbsp;</a></span>allocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public allocatecarbon::allocate </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>lfstatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>thliq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>ailcg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>ailcb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ilg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>sand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>clay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc,ignd)&#160;</td>
          <td class="paramname"><em>rmatctem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>gleafmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>stemmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>rootmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(icc)&#160;</td>
          <td class="paramname"><em>sort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>fcancmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>isand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>THFC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,ignd)&#160;</td>
          <td class="paramname"><em>THLW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>afrleaf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>afrstem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>afrroot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>wtstatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc)&#160;</td>
          <td class="paramname"><em>ltstatus</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs allocation of carbon gained by photosynthesis into plant structural pools. </p>
<dl class="section author"><dt>Author</dt><dd>Vivek Arora and Joe Melton</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">il1</td><td>input: il1=1</td></tr>
    <tr><td class="paramname">il2</td><td>input: il2=ilg</td></tr>
    <tr><td class="paramname">lfstatus</td><td>input: leaf status. an integer indicating if leaves are in "max. growth", "normal growth", "fall/harvest", or "no leaves" mode. see phenolgy subroutine for more details.</td></tr>
    <tr><td class="paramname">sort</td><td>input: index for correspondence between 9 pfts and the 12 values in parameters vectors</td></tr>
    <tr><td class="paramname">ailcg</td><td>input: green or live leaf area index</td></tr>
    <tr><td class="paramname">ailcb</td><td>input: brown or dead leaf area index</td></tr>
    <tr><td class="paramname">thliq</td><td>input: liquid soil moisture content in 3 soil layers</td></tr>
    <tr><td class="paramname">thlw</td><td>input: wilting point soil moisture content</td></tr>
    <tr><td class="paramname">thfc</td><td>input: field capacity soil moisture content</td></tr>
    <tr><td class="paramname">rootmass</td><td>input: root mass for each of the 9 ctem pfts, kg c/m2</td></tr>
    <tr><td class="paramname">rmatctem</td><td>input: fraction of roots in each soil layer for each pft</td></tr>
    <tr><td class="paramname">gleafmas</td><td>input: green or live leaf mass in kg c/m2, for the 9 pfts</td></tr>
    <tr><td class="paramname">stemmass</td><td>input: stem mass for each of the 9 ctem pfts, kg c/m2</td></tr>
    <tr><td class="paramname">sand</td><td>input: percentage sand</td></tr>
    <tr><td class="paramname">clay</td><td>input: percentage clay</td></tr>
    <tr><td class="paramname">afrleaf</td><td>output: allocation fraction for leaves</td></tr>
    <tr><td class="paramname">afrstem</td><td>output: allocation fraction for stem</td></tr>
    <tr><td class="paramname">afrroot</td><td>output: allocation fraction for root</td></tr>
    <tr><td class="paramname">fcancmx</td><td>input: max. fractional coverage of ctem's 9 pfts, but this can be modified by land-use change, and competition between pfts</td></tr>
    <tr><td class="paramname">wtstatus</td><td>output: soil water status (0 dry -&gt; 1 wet)</td></tr>
    <tr><td class="paramname">ltstatus</td><td>output: light status </td></tr>
  </table>
  </dd>
</dl>
<p>Calculate liquid soil moisture content, and wilting and field capacity soil moisture contents averaged over the root zone. note that while the soil moisture content is same under the entire gcm grid cell, soil moisture averaged over the rooting depth is different for each pft because of different fraction of roots present in each soil layer.</p>
<p>Using liquid soil moisture content together with wilting and field capacity soil moisture contents averaged over the root zone, find soil water status.</p>
<p>Calculate light status as a function of lai and light extinction parameter. for now set nitrogen status equal to 1, which means nitrogen is non-limiting.</p>
<p>allocation to roots is determined by min. of water and nitrogen status</p>
<p>now that we know water, light, and nitrogen status we can find allocation fractions for leaves, stem, and root components. note that allocation formulae for grasses are different from those for trees and crops, since there is no stem component in grasses.</p>
<p>if using constant allocation factors then replace the dynamically calculated allocation fractions.</p>
<p>make sure allocation fractions add to one</p>
<p>the allocation fractions calculated above are overridden by two rules.</p>
<p>rule 1 which states that at the time of leaf onset which corresponds to leaf status equal to 1, more c is allocated to leaves so that they can grow asap. in addition when leaf status is "fall/harvest" then nothing is allocated to leaves.</p>
<p>for grasses we use the usual allocation even at leaf onset</p>
<p>rule 2 overrides rule 1 above and makes sure that we do not allow the amount of leaves on trees and crops (i.e. pfts 1 to 7) to exceed an amount such that the remaining woody biomass cannot support. if this happens, allocation to leaves is reduced and most npp is allocated to stem and roots, in a proportion based on calculated afrstem and afrroot. for grasses this rule essentially constrains the root:shoot ratio, meaning that the model grasses can't have lots of leaves without having a reasonable amount of roots.</p>
<p>make sure that root:shoot ratio is at least equal to rtsrmin. if not allocate more to root and decrease allocation to stem.</p>
<p>finally check if all allocation fractions are positive and check again they all add to one.</p>

</div>
</div>
<a id="file_afc0495b5c8f58b0458ce04db74a07c46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#file_afc0495b5c8f58b0458ce04db74a07c46">&#9670;&nbsp;</a></span>updatepoolsallocaterepro()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public allocatecarbon::updatepoolsallocaterepro </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ilg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(icc), intent(in)&#160;</td>
          <td class="paramname"><em>sort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>ailcg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>lfstatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>nppveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>PFTCompetition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>pftexist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>gppveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>rmsveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>rmrveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>rmlveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>fcancmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>useTracer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>tracerNPP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>rmsTracer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>rmrTracer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>tracerRML</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(in)&#160;</td>
          <td class="paramname"><em>tracerGPP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>lambda</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>afrleaf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>afrstem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>afrroot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>gleafmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>stemmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>rootmass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>bleafmas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>tracerGLeafMass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>tracerStemMass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>tracerRootMass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(inout)&#160;</td>
          <td class="paramname"><em>tracerBLeafMass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>reprocost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>ntchlveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>ntchsveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>ntchrveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(out)&#160;</td>
          <td class="paramname"><em>repro_cost_g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,icc), intent(out)&#160;</td>
          <td class="paramname"><em>tracerReproCost</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs allocation of carbon gained by photosynthesis into plant structural pools. </p>
<dl class="section author"><dt>Author</dt><dd>Vivek Arora and Joe Melton</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ilg</td><td>Number of grid cells in latitude circle</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il1</td><td>il1=1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il2</td><td>il2=ilg</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pftcompetition</td><td>logical boolean telling if competition between pfts is on or not</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">usetracer</td><td>Switch for use of a model tracer. If useTracer is 0 then the tracer code is not used. useTracer = 1 turns on a simple tracer that tracks pools and fluxes. The simple tracer then requires that the tracer values in the init_file and the tracerCO2file are set to meaningful values for the experiment being run. useTracer = 2 means the tracer is 14C and will then call a 14C decay scheme. useTracer = 3 means the tracer is 13C and will then call a 13C fractionation scheme.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sort</td><td>index for correspondence between 9 pfts and 12 values in the parameter vectors</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ailcg</td><td>Green LAI for ctem's pfts <img class="formulaInl" alt="$(m^2 leaf/m^2 ground)$" src="form_1672.png"/></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lfstatus</td><td>leaf phenology status</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nppveg</td><td>NPP for individual pfts, ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pftexist</td><td>True if PFT is present in tile.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gppveg</td><td>Gross primary productivity per PFT ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rmsveg</td><td>Maintenance respiration for stem for the CTEM pfts in u mol co2/m2. sec</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rmrveg</td><td>Maintenance respiration for root for the CTEM pfts in u mol co2/m2. sec</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rmlveg</td><td>Leaf maintenance respiration per PFT ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fcancmx</td><td>max. fractional coverage of CTEM's pfts, but this can be modified by land-use change, and competition between pfts</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tracernpp</td><td>tracer NPP for individual pfts, ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rmstracer</td><td>Tracer maintenance respiration for stem for the CTEM pfts ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rmrtracer</td><td>Tracer maintenance respiration for root for the CTEM pfts both ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tracerrml</td><td>Tracer leaf maintenance respiration ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tracergpp</td><td>Tracer GPP ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">afrleaf</td><td>allocation fraction for leaves</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">afrstem</td><td>allocation fraction for stem</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">afrroot</td><td>allocation fraction for root</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">lambda</td><td>Fraction of npp that is to be used for horizontal expansion (lambda) during the next day (i.e. this will be determining the colonization rate in competition)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gleafmas</td><td>green leaf mass for each of the ctem pfts, <img class="formulaInl" alt="$(kg C/m^2)$" src="form_1670.png"/></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bleafmas</td><td>brown leaf mass for each of the ctem pfts, <img class="formulaInl" alt="$(kg C/m^2)$" src="form_1670.png"/></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">stemmass</td><td>stem mass for each of the ctem pfts, <img class="formulaInl" alt="$(kg C/m^2)$" src="form_1670.png"/></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rootmass</td><td>root mass for each of the ctem pfts, <img class="formulaInl" alt="$(kg C/m^2)$" src="form_1670.png"/></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tracerstemmass</td><td>Tracer mass in the stem for each of the CTEM pfts, <img class="formulaInl" alt="$kg c/m^2$" src="form_535.png"/></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tracerrootmass</td><td>Tracer mass in the root for each of the CTEM pfts, <img class="formulaInl" alt="$kg c/m^2$" src="form_535.png"/></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tracergleafmass</td><td>Tracer mass in the green leaf pool for each of the CTEM pfts, <img class="formulaInl" alt="$kg c/m^2$" src="form_535.png"/></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tracerbleafmass</td><td>Tracer mass in the brown leaf pool for each of the CTEM pfts, <img class="formulaInl" alt="$kg c/m^2$" src="form_535.png"/></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">reprocost</td><td>Cost of making reproductive tissues, only non-zero when NPP is positive ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ntchlveg</td><td>fluxes for each pft: Net change in leaf biomass, u-mol CO2/m2.sec</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ntchsveg</td><td>fluxes for each pft: Net change in stem biomass, u-mol CO2/m2.sec</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ntchrveg</td><td>fluxes for each pft: Net change in root biomass, the net change is the difference between allocation and autotrophic respiratory fluxes, u-mol CO2/m2.sec</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">repro_cost_g</td><td>Tile-level cost of making reproductive tissues, only non-zero when NPP is positive ( <img class="formulaInl" alt="$\mu mol CO_2 m^{-2} s^{-1}$" src="form_1671.png"/>) </td></tr>
  </table>
  </dd>
</dl>
<p>Estimate fraction of npp that is to be used for horizontal expansion (lambda) during the next day (i.e. this will be determining the colonization rate in competition).</p>
<p>Maintenance respiration also reduces leaf, stem, and root biomass. when NPP for a given pft is positive then this is taken care by allocating positive NPP amongst the leaves, stem, and root component. when NPP for a given pft is negative then maintenance respiration loss is explicitly deducted from each component.</p>
<p>Remove the cost of making reproductive tissues. This cost can only be removed when NPP is positive.</p>
<p>i.e. if lfstatus == 4 (no leaves)</p>
<p>And since we do not have any real leaves on then we do not take into account CO2 uptake by imaginary leaves in carbon budget. rmlvgstp(i,j) should be zero because we set maintenance respiration from storage/imaginary leaves equal to zero. in loop 180</p>
<p>Since no real leaves are on, make allocation fractions equal to zero.</p>
<p>Calculate grid averaged value of C related to spatial expansion </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="allocateCarbon_8f90.html">allocateCarbon.f90</a></li>
    <li class="footer">Generated on Thu Jul 4 2019 12:03:55 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
