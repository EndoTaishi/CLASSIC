<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: main Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemain.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">main Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Main model driver for CLASSIC in stand-alone mode using specified boundary conditions and atmospheric forcing.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a29ddac21d7ed22408aa3cdcb2e617fa5"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemain.html#a29ddac21d7ed22408aa3cdcb2e617fa5">main_driver</a> (longitude, latitude, lonIndex, latIndex, lonLocalIndex, latLocalIndex)</td></tr>
<tr class="memdesc:a29ddac21d7ed22408aa3cdcb2e617fa5"><td class="mdescLeft">&#160;</td><td class="mdescRight"><h2>Dimension statements.</h2>
 <a href="#a29ddac21d7ed22408aa3cdcb2e617fa5">More...</a><br /></td></tr>
<tr class="separator:a29ddac21d7ed22408aa3cdcb2e617fa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main model driver for CLASSIC in stand-alone mode using specified boundary conditions and atmospheric forcing. </p>
<dl class="section author"><dt>Author</dt><dd>D. Verseghy, V. Arora, J. Melton, E. Chan This driver program initializes the run, reads in CLASSIC input files, manages the run and the coupling between CLASS and CTEM, calls subroutines that aggregate and write outputs, and closes the run for this grid cell. </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a29ddac21d7ed22408aa3cdcb2e617fa5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29ddac21d7ed22408aa3cdcb2e617fa5">&#9670;&nbsp;</a></span>main_driver()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public main::main_driver </td>
          <td>(</td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>longitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>latitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>lonIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>latIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>lonLocalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>latLocalIndex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h2>Dimension statements.</h2>
</p>
<h3>First set of definitions:</h3>
<p>Background variables, and prognostic and diagnostic variables normally provided by and/or used by the GCM. The suffix "rot" refers to variables existing on the mosaic grid on the current latitude circle. The suffix "gat" refers to the same variables after they have undergone a "gather" operation in which the two mosaic dimensions are collapsed into one. The suffix "row" refers both to grid-constant input variables. and to grid-averaged diagnostic variables.</p>
<p>The first dimension element of the "rot" variables refers to the number of grid cells on the current latitude circle. In this stand-alone version, this number is set to 1, the second dimension element of the "rot" variables refers to the maximum number of tiles in the mosaic. The first dimension element in the "gat" variables is given by the product of the first two dimension elements in the "rot" variables.</p>
<p>The majority of CTEM parameters are stored in <a class="el" href="classic__params_8f90.html" title="This module holds CLASSIC globally accessible parameters. ">classic_params.f90</a>. Also the CLASS and CTEM variables are stored in modules that we point to in this driver. We access the variables and parameters through use statements for modules:</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">latitude</td><td>Longitude/latitude of grid cell (degrees)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">latindex</td><td>Index of grid cell being run on the input files grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">latlocalindex</td><td>Index of grid cell being run on the output files grid </td></tr>
  </table>
  </dd>
</dl>
<p>NLTEST and NMTEST are the number of grid cells and the number of mosaic tiles per grid cell for this test run, respectively. This driver is set up to handle one grid cell with any number of mosaic tiles. These are given the values then of nlat and nmos.</p>
<p>The parameter JLAT is calculated from DLATROW as the nearest integer value,</p>
<p>The timestep counter N for the run is initialized to 0, the daily averaging counter NCOUNT is set to 1, and the total number of timesteps in the day NDAY is calculated as the number of seconds in a day (86400) divided by the timestep length DELT.</p>
<p>The grid-average height for the momentum diagnostic variables, ZDMROW, and for the energy diagnostic variables, ZDHROW, are hard-coded to the standard anemometer height of 10 m and to the screen height of 2 m respectively.</p>
<p>ZRFMROW and ZRFHROW, the reference heights at which the momentum variables (wind speed) and energy variables (temperature and specific humidity) are provided. In a run using atmospheric model forcing data, these heights would vary by time step, but since this version of the driver is set up to use field data, ZRFMROW and ZRFHROW refer to the measurement height of these variables, which is fixed. The value is read in from the job options file.</p>
<p>ZBLDROW, the atmospheric blending height. Technically this variable depends on the length scale of the patches of roughness elements on the land surface, but this is difficult to ascertain. Usually it is assigned a value of 50 m. The value is read in from the job options file.</p>
<p>Initialize variables in preparation for the run</p>
<p>Read in the model initial state</p>
<p>Read in the inputs for a run with biogeochemical component turned on</p>
<p>Regardless of whether lnduseon or not, we need to check the land cover that was read in and assign the CLASS PFTs as they are not read in when ctem_on.</p>
<p>Read in the meteorological forcing data to a suite of arrays</p>
<p>In preparation for the use of the random number generator by disaggMet, we need to provide a seed to allow repeatable results.</p>
<p>Now disaggregate the meteorological forcing to the right timestep for this model run (if needed; this is checked for in the subroutine)</p>
<p>As the last step in the initialization sequence, the subroutine CLASSB is called, to assign soil thermal and hydraulic properties on the basis of the textural information read in for each of the soil layers.</p>
<p>The do while loop marks the beginning of the time stepping loop for the actual run. N is incremented by 1, and the atmospheric forcing data for the current time step are updated for each grid cell or modelled area (see the manual section on “Data Requirements”).</p>
<p>Update the meteorological forcing data for current time step;</p>
<p>Generally only the total incoming shortwave radiation FSDOWN is available; so it is partitioned 50:50 between the incoming visible (FSVHROW) and near-infrared (FSIHROW) radiation. The first two elements of the generalized incoming radiation array, FSSBROL (used for both the ISNOALB=0 and ISNOALB=1 options) are set to FSVHROW and FSIHROW respectively. The air temperature TAROW is converted from degrees C to K. The zonal (ULROW) and meridional (VLROW) components of the wind speed are generally not used; only the overall wind speed UVROW is measured. However, CLASS does not require wind direction for its calculations, so ULROW is arbitrarily assigned the value of UVROW and VLROW is set to zero for this run. The input wind speed VMODROW is assigned the value of UVROW.</p>
<p>The cosine of the solar zenith angle COSZ is calculated from the day of the year, the hour, the minute and the latitude using basic radiation geometry, and (avoiding vanishingly small numbers) is assigned to CSZROW. The fractional cloud cover FCLOROW is commonly not available so a rough estimate is obtained by setting it to 1 when precipitation is occurring, and to the fraction of incoming diffuse radiation XDIFFUS otherwise (assumed to be 1 when the sun is at the horizon, and 0.10 when it is at the zenith). These calculations are done in findCloudiness</p>
<p>CLASSI evaluates a series of derived atmospheric variables</p>
<p>GATPREP assigns values to vectors governing the gather-scatter operations</p>
<p>CLASSG performs the gather operation, gathering variables from their positions as mosaic tiles within the modelled areas to long vectors of mosaic tiles</p>
<p>CLASSZ does the initial calculations for the energy and water balance checks;</p>
<p>CLASSA manages the calculation of albedos and other surface parameters;</p>
<p>CLASST calls the subroutines associated with the surface energy balance calculations</p>
<p>CLASSW calls the subroutines associated with the surface water balance calculations</p>
<p>CLASSZ completes the energy and water balance checks for the current time step</p>
<p>Accumulate variables not already accumulated but which are required by CTEM.</p>
<p>CLASSS performs the scatter operation, scattering the variables from the long vectors of mosaic tiles back onto the configuration of mosaic tiles within grid cells.</p>
<p>Now check if the met file is done, needs to loop more, or just continues to the next timestep</p>
<p>Increment the metTimeIndex to advance to the next timestep on the next time around</p>
<p>End of met array read-in reached, decide what to do</p>
<p>The lopcount is reached so the run must be over</p>
<p>Loop again so reset the metTimeIndex </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemain.html">main</a></li>
    <li class="footer">Generated on Thu Apr 11 2019 11:13:45 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
