<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>CLASSIC: main Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Modules&#160;List</span></a></li>
      <li><a href="namespacemembers.html"><span>Module&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemain.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">main Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Main model driver for CLASSIC in stand-alone mode using specified boundary conditions and atmospheric forcing.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a29ddac21d7ed22408aa3cdcb2e617fa5"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemain.html#a29ddac21d7ed22408aa3cdcb2e617fa5">main_driver</a> (longitude, latitude, lonIndex, latIndex, lonLocalIndex, latLocalIndex)</td></tr>
<tr class="separator:a29ddac21d7ed22408aa3cdcb2e617fa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main model driver for CLASSIC in stand-alone mode using specified boundary conditions and atmospheric forcing. </p>
<p>This driver program initializes the run, reads in CLASSIC input files, manages the run and the coupling between CLASS and CTEM, calls subroutines that aggregate and write outputs, and closes the run for this grid cell. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="a29ddac21d7ed22408aa3cdcb2e617fa5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public main::main_driver </td>
          <td>(</td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>longitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>latitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>lonIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>latIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>lonLocalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>latLocalIndex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">longitude</td><td><hr/>
 <h2>Dimension statements.</h2>
</td></tr>
  </table>
  </dd>
</dl>
<pre class="fragment">### first set of definitions:
background variables, and prognostic and diagnostic
variables normally provided by and/or used by the gcm.
 the suffix "rot" refers to variables existing on the
 mosaic grid on the current latitude circle.  the suffix
 "gat" refers to the same variables after they have undergone
 a "gather" operation in which the two mosaic dimensions
 are collapsed into one.  the suffix "row" refers both to
 grid-constant input variables. and to grid-averaged
 diagnostic variables.

 the first dimension element of the "rot" variables
 refers to the number of grid cells on the current
 latitude circle.  in this stand-alone version, this
 number is set to 1, the second dimension
 element of the "rot" variables refers to the maximum
 number of tiles in the mosaic.  the first
 dimension element in the "gat" variables is given by
 the product of the first two dimension elements in the
 "rot" variables.

The majority of CTEM parameters are stored in ctem_params.f90.
Also the CTEM variables are stored in modules that we point to
in this driver. We access the variables and parameters
through use statements for modules: </pre> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">latitude</td><td><hr/>
 <h2>Dimension statements.</h2>
</td></tr>
  </table>
  </dd>
</dl>
<pre class="fragment">### first set of definitions:
background variables, and prognostic and diagnostic
variables normally provided by and/or used by the gcm.
 the suffix "rot" refers to variables existing on the
 mosaic grid on the current latitude circle.  the suffix
 "gat" refers to the same variables after they have undergone
 a "gather" operation in which the two mosaic dimensions
 are collapsed into one.  the suffix "row" refers both to
 grid-constant input variables. and to grid-averaged
 diagnostic variables.

 the first dimension element of the "rot" variables
 refers to the number of grid cells on the current
 latitude circle.  in this stand-alone version, this
 number is set to 1, the second dimension
 element of the "rot" variables refers to the maximum
 number of tiles in the mosaic.  the first
 dimension element in the "gat" variables is given by
 the product of the first two dimension elements in the
 "rot" variables.

The majority of CTEM parameters are stored in ctem_params.f90.
Also the CTEM variables are stored in modules that we point to
in this driver. We access the variables and parameters
through use statements for modules: </pre> <p>NLTEST and NMTEST, the number of grid cells and the number of mosaic tiles per grid cell for this test run. This the driver is set up to handle one grid cell with any number of mosaic tiles. These are given the values then of nlat and nmos</p>
<p>The parameter JLAT is calculated from DLATROW as the nearest integer value,</p>
<p>The timestep counter N for the run is initialized to 0, the daily averaging counter NCOUNT is set to 1, and the total number of timesteps in the day NDAY is calculated as the number of seconds in a day (86400) divided by the timestep length DELT.</p>
<p>The grid-average height for the momentum diagnostic variables, ZDMROW, and for the energy diagnostic variables, ZDHROW, are hard-coded to the standard anemometer height of 10 m and to the screen height of 2 m respectively.</p>
<p>Regardless of whether lnduseon or not, we need to check the land cover that was read in and assign the CLASS PFTs as they are not read in when ctem_on.</p>
<p>In the 100 and 150 loops, further initial calculations are done. The limiting snow depth, ZSNL, is assigned its operational value of 0.10 m.</p>
<p>As the last step in the initialization sequence, the subroutine CLASSB is called, to assign soil thermal and hydraulic properties on the basis of the textural information read in for each of the soil layers.</p>
<p>The do while loop marks the beginning of the time stepping loop for the actual run. N is incremented by 1, and the atmospheric forcing data for the current time step are updated for each grid cell or modelled area (see the section on “Data Requirements”). In the dataset associated with the benchmark run, only the total incoming shortwave radiation FSDOWN is available; it is partitioned 50:50 between the incoming visible (FSVHROW) and near-infrared (FSIHROW) radiation. The first two elements of the generalized incoming radiation array, FSSBROL (used for both the ISNOALB=0 and ISNOALB=1 options) are set to FSVHROW and FSIHROW respectively. The air temperature TAROW is converted from degrees C to K. The zonal (ULROW) and meridional (VLROW) components of the wind speed are generally not used; only the overall wind speed UVROW is measured. However, CLASS does not require wind direction for its calculations, so ULROW is arbitrarily assigned the value of UVROW and VLROW is set to zero for this run. The input wind speed VMODROW is assigned the value of UVROW. The cosine of the solar zenith angle COSZ is calculated from the day of the year, the hour, the minute and the latitude using basic radiation geometry, and (avoiding vanishingly small numbers) is assigned to CSZROW. The fractional cloud cover FCLOROW is commonly not available so a rough estimate is obtained by setting it to 1 when precipitation is occurring, and to the fraction of incoming diffuse radiation XDIFFUS otherwise (assumed to be 1 when the sun is at the horizon, and 0.10 when it is at the zenith).</p>
<p>CLASSI evaluates a series of derived atmospheric variables</p>
<p>GATPREP assigns values to vectors governing the gather-scatter operations</p>
<p>CLASSG performs the gather operation, gathering variables from their positions as mosaic tiles within the modelled areas to long vectors of mosaic tiles</p>
<p>CLASSZ does the initial calculations for the energy and water balance checks;</p>
<p>CLASSA manages the calculation of albedos and other surface parameters;</p>
<p>CLASST calls the subroutines associated with the surface energy balance calculations</p>
<p>CLASSW calls the subroutines associated with the surface water balance calculations</p>
<p>CLASSZ completes the energy and water balance checks for the current time step</p>
<p>Accumulate variables not already accumulated but which are required by CTEM.</p>
<p>CLASSS performs the scatter operation, scattering the variables from the long vectors of mosaic tiles back onto the configuration of mosaic tiles within grid cells.</p>
<p>Now check if the met file is done, needs to loop more, or just continues to the next timestep</p>
<p>Increment the metTimeIndex to advance to the next timestep on the next time around</p>
<p>End of met array read in reached, decide what to do</p>
<p>The lopcount is reached so the run must be over</p>
<p>Loop again so reset the metTimeIndex </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemain.html">main</a></li>
    <li class="footer">Generated on Thu Oct 26 2017 11:36:04 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
