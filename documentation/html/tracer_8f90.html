<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: src/tracer.f90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tracer_8f90.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tracer.f90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Module containing all relevant subroutines for the model tracer.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a283a7636686a314244a7025bcf469ee8"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracer_8f90.html#a283a7636686a314244a7025bcf469ee8">tracermodule::decay14c</a> (il1, il2)</td></tr>
<tr class="memdesc:a283a7636686a314244a7025bcf469ee8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the decay of <img class="formulaInl" alt="$^{14}C$" src="form_1697.png"/> in the tracer pools.  <a href="tracer_8f90.html#a283a7636686a314244a7025bcf469ee8">More...</a><br /></td></tr>
<tr class="separator:a283a7636686a314244a7025bcf469ee8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1191f46e335ff369c767a229115420f1"><td class="memItemLeft" align="right" valign="top"><a id="a1191f46e335ff369c767a229115420f1"></a>
subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracer_8f90.html#a1191f46e335ff369c767a229115420f1">tracermodule::fractionate13c</a> ()</td></tr>
<tr class="memdesc:a1191f46e335ff369c767a229115420f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">13C tracer &ndash; NOT IMPLEMENTED YET. <br /></td></tr>
<tr class="separator:a1191f46e335ff369c767a229115420f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e634f86dc81fd9fbf188bacebb1a7cc"><td class="memItemLeft" align="right" valign="top">real function, dimension(nlat, nmos), public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracer_8f90.html#a2e634f86dc81fd9fbf188bacebb1a7cc">tracermodule::converttracerunits</a> (tracerco2conc)</td></tr>
<tr class="memdesc:a2e634f86dc81fd9fbf188bacebb1a7cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts the units of the tracers, depending on the tracer being simulated.  <a href="tracer_8f90.html#a2e634f86dc81fd9fbf188bacebb1a7cc">More...</a><br /></td></tr>
<tr class="separator:a2e634f86dc81fd9fbf188bacebb1a7cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab47297fd69d111c7095805609f16acba"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracer_8f90.html#ab47297fd69d111c7095805609f16acba">tracermodule::checktracerbalance</a> (il1, il2)</td></tr>
<tr class="memdesc:ab47297fd69d111c7095805609f16acba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks for balance between the tracer pools and the model normal C pools. The subroutine is called when the doTracerBalance logical is set to true in updateSimpleTracer and the model initFile is set up as described in the notes of updateSimpleTracer. checkTracerBalance uses the same tolerance for comparisions as balcar.  <a href="tracer_8f90.html#ab47297fd69d111c7095805609f16acba">More...</a><br /></td></tr>
<tr class="separator:ab47297fd69d111c7095805609f16acba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a183d5f89a8f7892ba163155ff771963e"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracer_8f90.html#a183d5f89a8f7892ba163155ff771963e">tracermodule::preptracer</a> (il1, il2, ilg, tracerCO2, tracerValue)</td></tr>
<tr class="memdesc:a183d5f89a8f7892ba163155ff771963e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tracks C flow through the system. No fractionation effects are applied in this subroutine. The tracer's value depends on how the model is initialized and the input file used.  <a href="tracer_8f90.html#a183d5f89a8f7892ba163155ff771963e">More...</a><br /></td></tr>
<tr class="separator:a183d5f89a8f7892ba163155ff771963e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3cf1db654c35816a9dff780ad8160908"><td class="memItemLeft" align="right" valign="top"><a id="a3cf1db654c35816a9dff780ad8160908"></a>
logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracer_8f90.html#a3cf1db654c35816a9dff780ad8160908">tracermodule::dotracerbalance</a> = .true.</td></tr>
<tr class="memdesc:a3cf1db654c35816a9dff780ad8160908"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logical to determine if the tracer pool balance check is performed. <br /></td></tr>
<tr class="separator:a3cf1db654c35816a9dff780ad8160908"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Module containing all relevant subroutines for the model tracer. </p>
<dl class="section author"><dt>Author</dt><dd>Joe Melton </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="file_ab47297fd69d111c7095805609f16acba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#file_ab47297fd69d111c7095805609f16acba">&#9670;&nbsp;</a></span>checktracerbalance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public tracermodule::checktracerbalance </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks for balance between the tracer pools and the model normal C pools. The subroutine is called when the doTracerBalance logical is set to true in updateSimpleTracer and the model initFile is set up as described in the notes of updateSimpleTracer. checkTracerBalance uses the same tolerance for comparisions as balcar. </p>
<dl class="section author"><dt>Author</dt><dd>Joe Melton</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">il1</td><td>other variables: il1=1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il2</td><td>other variables: il2=ilg </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="file_a2e634f86dc81fd9fbf188bacebb1a7cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#file_a2e634f86dc81fd9fbf188bacebb1a7cc">&#9670;&nbsp;</a></span>converttracerunits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real function, dimension(nlat,nmos), public tracermodule::converttracerunits </td>
          <td>(</td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>tracerco2conc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts the units of the tracers, depending on the tracer being simulated. </p>
<p>If the tracer is a simple tracer, no conversion of units is needed. If the tracer is <img class="formulaInl" alt="$^{14}C$" src="form_1697.png"/> then we apply a conversion as follows. Incoming units expected are <img class="formulaInl" alt="$\Delta ^{14}C$" src="form_1676.png"/> reported relative to the Modern standard, including corrections for age and fractionation following Stuiver and Polach 1977 <a class="el" href="citelist.html#CITEREF_Stuiver1977-yj">[79]</a></p>
<p><img class="formulaInl" alt="$\Delta ^{14}C = 1000 \left( \left[ 1 + \frac{\delta ^{14}C}{1000} \right] \frac{0.975^2}{1 + \frac{\delta ^{13}C}{1000}} - 1 \right)$" src="form_1698.png"/></p>
<p>Here <img class="formulaInl" alt="$\delta ^{14}C$" src="form_1699.png"/> is the measured value and <img class="formulaInl" alt="$\Delta ^{14}C$" src="form_1676.png"/> corrects for isotopic fractionation by mass-dependent processes. The 0.975 term is the fractionation of <img class="formulaInl" alt="$^{13}C$" src="form_1700.png"/> by photosynthesis. Since we have only one tracer we make a few simplifying assumptions. First we assume that no fractionation of <img class="formulaInl" alt="$^{14}C$" src="form_1697.png"/> occurs, thus 0.975 becomes 1 and the <img class="formulaInl" alt="$\delta ^{13}C$" src="form_1701.png"/> becomes 0. <img class="formulaInl" alt="$\Delta ^{14}C$" src="form_1676.png"/> then simplifies to <img class="formulaInl" alt="$\delta ^{14}C$" src="form_1699.png"/> and becomes:</p>
<p><img class="formulaInl" alt="$\Delta ^{14}C = \delta ^{14}C = 1000 \left(\frac{A_s}{A_{abs}} - 1 \right)$" src="form_1702.png"/></p>
<p>where the <img class="formulaInl" alt="$A_s$" src="form_1150.png"/> is the <img class="formulaInl" alt="$^{14}C/C$" src="form_1703.png"/> ratio in a given sample. We follow Koven et al. (2013) <a class="el" href="citelist.html#CITEREF_Koven2013-dd">[46]</a> in assuming a background preindustrial atmospheric <img class="formulaInl" alt="$^{14}C/C$" src="form_1703.png"/> ratio ( <img class="formulaInl" alt="$A_{abs}$" src="form_1704.png"/>) of <img class="formulaInl" alt="$10^{-12}$" src="form_1705.png"/>. Technically, the standard value of this is 0.2260 <img class="formulaInl" alt="$\pm$" src="form_1706.png"/> 0.0012 Bq/gC where a Bq is 433.2 x <img class="formulaInl" alt="$10^{-15}$" src="form_1707.png"/> mole ( <img class="formulaInl" alt="$^{14}C$" src="form_1697.png"/>). The <img class="formulaInl" alt="$^{14}C/C$" src="form_1703.png"/> ratio, or <img class="formulaInl" alt="$A_s$" src="form_1150.png"/> can then be solved to be:</p>
<p><img class="formulaInl" alt="$ A_s = 10^{-12}\left( \frac{\Delta ^{14}C}{1000} + 1 \right)$" src="form_1708.png"/></p>
<dl class="section author"><dt>Author</dt><dd>Joe Melton </dd></dl>

</div>
</div>
<a id="file_a283a7636686a314244a7025bcf469ee8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#file_a283a7636686a314244a7025bcf469ee8">&#9670;&nbsp;</a></span>decay14c()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public tracermodule::decay14c </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the decay of <img class="formulaInl" alt="$^{14}C$" src="form_1697.png"/> in the tracer pools. </p>
<p>Once a year we calculate the decay of <img class="formulaInl" alt="$^{14}C$" src="form_1697.png"/> in the tracer pools. This calculation is only called if useTracer == 2. If using spinfast to equilibrate the model we need to adjust the decay of 14C in the model soil C pool. Since spinfast increases the turnover time of soil C by the factor 1/spinfast, the 14C in the soils generated with a spinfast &gt; 1 will be too young by the same factor. Following Koven et al .2013 <a class="el" href="citelist.html#CITEREF_Koven2013-dd">[46]</a> we adjust for that faster equilbration by increasing the decay in the soil C tracer pool by spinfast. </p><dl class="section author"><dt>Author</dt><dd>Joe Melton</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">il1</td><td>other variables: il1=1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il2</td><td>other variables: il2=ilg </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="file_a183d5f89a8f7892ba163155ff771963e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#file_a183d5f89a8f7892ba163155ff771963e">&#9670;&nbsp;</a></span>preptracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public tracermodule::preptracer </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>il2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ilg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>tracerCO2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg), intent(out)&#160;</td>
          <td class="paramname"><em>tracerValue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tracks C flow through the system. No fractionation effects are applied in this subroutine. The tracer's value depends on how the model is initialized and the input file used. </p>
<p>The tracer trackes the C movement through the green leaf, brown leaf, root, stem, litter and soil C. Carbon that is incorporated into the plants are given a tracer value of tracerValue, which corresponds to that read in from the tracerCO2 file for the year simulated. As the simulation runs and C is transferred from the living pools to the detrital pools, the tracer also is transfered.</p>
<p>The subroutine contains a tracer pools balance check that should be run before using the tracer subroutines, in case any other model developments have not be added to the fluxes for the tracer pools but have been applied elsewhere. To do the balance check, set useTracer to 1 (for simple tracer). This ensure not fractionation or decay is performed on the tracer. Ensure that the initFile tracer pool sizes are the same as the model C pools otherwise it will fail immediately. Next set checkTracerBalance to True in the prepTracer code. This replaces the read in tracerCO2 value with a value of 1, which means the tracer is given the same amount of C as the normal C pools. Then at the end of prepTracer a small section of code is called that checks that the tracer C pools are the same size as the model C pools. If they differ it indicates a missing flux term in prepTracer or that the initFile was not set up with identical tracer and normal C pools at the start of the balance check.</p>
<dl class="section author"><dt>Author</dt><dd>Joe Melton</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">il1</td><td>other variables: il1=1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">il2</td><td>other variables: il2=ilg</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ilg</td><td>number of grid cells in this latitude band.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tracervalue</td><td>Temporary variable containing the tracer CO2 value to be used. Units vary.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tracerco2</td><td>Tracer CO2 value read in from tracerCO2File, units vary (simple: ppm, 14C <img class="formulaInl" alt="$\Delta ^{14}C$" src="form_1676.png"/>) </td></tr>
  </table>
  </dd>
</dl>
<p>If doTracerBalance is true, Check for mass balance for the tracer. First set the tracer CO2 value to 1 so it gets the same inputs as the model CO2 pools. Otherwise just use the read in tracerValue.</p>
<p>We don't need to do any conversion of the carbon that is uptaked in this timestep. We assume that the tracerValue should just be applied as is.</p>
<p>If the normal pools are empty, make the tracer pools the same. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="tracer_8f90.html">tracer.f90</a></li>
    <li class="footer">Generated on Thu Jul 4 2019 12:03:56 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
