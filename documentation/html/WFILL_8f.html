<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLASSIC: src/WFILL.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CLASSIC
   </div>
   <div id="projectbrief">Canadian Land Surface Scheme including Biogeochemical Cycles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('WFILL_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">WFILL.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Evaluates infiltration of water into soil under unsaturated conditions.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a1162b1442a4411742ce29b99d59d72cc"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="WFILL_8f.html#a1162b1442a4411742ce29b99d59d72cc">wfill</a> (WMOVE, TMOVE, LZF, NINF, ZF, TRMDR, R, TR, PSIF, GRKINF, THLINF, THLIQX, TBARWX, DELZX, ZBOTX, DZF, TIMPND, WADJ, WADD, IFILL, IFIND, IG, IGP1, IGP2, ILG, IL1, IL2, JL, N)</td></tr>
<tr class="separator:a1162b1442a4411742ce29b99d59d72cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Evaluates infiltration of water into soil under unsaturated conditions. </p>
<dl class="section author"><dt>Author</dt><dd>D. Verseghy, M. Lazare </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a1162b1442a4411742ce29b99d59d72cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1162b1442a4411742ce29b99d59d72cc">&#9670;&nbsp;</a></span>wfill()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wfill </td>
          <td>(</td>
          <td class="paramtype">real, dimension (ilg,igp2)&#160;</td>
          <td class="paramname"><em>WMOVE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,igp2)&#160;</td>
          <td class="paramname"><em>TMOVE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>LZF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>NINF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>ZF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TRMDR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (ilg)&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension    (ilg)&#160;</td>
          <td class="paramname"><em>TR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg,igp1)&#160;</td>
          <td class="paramname"><em>PSIF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,igp1)&#160;</td>
          <td class="paramname"><em>GRKINF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,igp1)&#160;</td>
          <td class="paramname"><em>THLINF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,igp1)&#160;</td>
          <td class="paramname"><em>THLIQX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(ilg,igp1)&#160;</td>
          <td class="paramname"><em>TBARWX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,igp1)&#160;</td>
          <td class="paramname"><em>DELZX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg,igp1)&#160;</td>
          <td class="paramname"><em>ZBOTX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension   (ilg)&#160;</td>
          <td class="paramname"><em>DZF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (ilg)&#160;</td>
          <td class="paramname"><em>TIMPND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>WADJ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (ilg)&#160;</td>
          <td class="paramname"><em>WADD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg)&#160;</td>
          <td class="paramname"><em>IFILL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension (ilg)&#160;</td>
          <td class="paramname"><em>IFIND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IGP1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IGP2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ILG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IL2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>JL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>N</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wmove</td><td>Water movement matrix <img class="formulaInl" alt="$[m^3 m^{-2}]$" src="form_1482.png"/></td></tr>
    <tr><td class="paramname">tmove</td><td>Temperature matrix associated with ground water movement [C}</td></tr>
    <tr><td class="paramname">lzf</td><td>Index of soil layer in which wetting front is located</td></tr>
    <tr><td class="paramname">ninf</td><td>Number of levels involved in water movement</td></tr>
    <tr><td class="paramname">zf</td><td>Depth of the wetting front [m]</td></tr>
    <tr><td class="paramname">trmdr</td><td>Remainder of time step after unsaturated infiltration ceases [s]</td></tr>
    <tr><td class="paramname">r</td><td>Rainfall rate at ground surface <img class="formulaInl" alt="$[m s^{-1}]$" src="form_122.png"/></td></tr>
    <tr><td class="paramname">tr</td><td>Temperature of rainfall [C]</td></tr>
    <tr><td class="paramname">psif</td><td>Soil water suction across the wetting front [m]</td></tr>
    <tr><td class="paramname">grkinf</td><td>Hydraulic conductivity of soil behind the wetting front <img class="formulaInl" alt="$[m s^{-1}]$" src="form_122.png"/></td></tr>
    <tr><td class="paramname">thlinf</td><td>Volumetric liquid water content behind the wetting front <img class="formulaInl" alt="$[m^3 m^{-3}]$" src="form_221.png"/></td></tr>
    <tr><td class="paramname">thliqx</td><td>Volumetric liquid water content of soil layer <img class="formulaInl" alt="$[m^3 m^{-3}]$" src="form_221.png"/></td></tr>
    <tr><td class="paramname">tbarwx</td><td>Temperature of water in soil layer [C]</td></tr>
    <tr><td class="paramname">delzx</td><td>Permeable depth of soil layer <img class="formulaInl" alt="$[m] (\Delta z_{g,w})$" src="form_222.png"/></td></tr>
    <tr><td class="paramname">zbotx</td><td>Depth of bottom of soil layer [m]</td></tr>
    <tr><td class="paramname">ifill</td><td>Flag indicating whether unsaturated infiltration is occurring </td></tr>
  </table>
  </dd>
</dl>
<p>The infiltration rate <img class="formulaInl" alt="$F_{inf}$" src="form_1483.png"/> under conditions of a constant water supply can be expressed, e.g. in Mein and Larson (1973), as</p>
<p><img class="formulaInl" alt="$F_{inf} = $" src="form_1484.png"/>K_{inf} <img class="formulaInl" alt="$ [(\Psi_f + z_f)/ z_f ]$" src="form_1485.png"/></p>
<p>where <img class="formulaInl" alt="$K_{inf}$" src="form_763.png"/> is the hydraulic conductivity of the soil behind the wetting front, <img class="formulaInl" alt="$\Psi_f$" src="form_1486.png"/> is the soil moisture suction across the wetting front, and <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> is the depth of the wetting front. It can be seen that <img class="formulaInl" alt="$F_{inf}$" src="form_1483.png"/> decreases with increasing <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> to an asymptotic value of <img class="formulaInl" alt="$K_{inf}$" src="form_763.png"/>. Thus, if the rainfall rate r is less than <img class="formulaInl" alt="$K_{inf}$" src="form_763.png"/>, the actual infiltration rate is limited by r, i.e. <img class="formulaInl" alt="$F_{inf} = r$" src="form_1488.png"/>. Otherwise, <img class="formulaInl" alt="$F_{inf}$" src="form_1483.png"/> will be equal to R until the right-hand side of the above equation becomes less than r, after which point the above equation applies and ponding of excess water begins on the surface. The depth of the wetting front at this time <img class="formulaInl" alt="$t_p$" src="form_1489.png"/> can be calculated by setting <img class="formulaInl" alt="$F_{inf}$" src="form_1483.png"/> equal to r in the above equation and solving for <img class="formulaInl" alt="$z_f$" src="form_1487.png"/>. This results in:</p>
<p><img class="formulaInl" alt="$z_f = \Psi_f /[r/K_{inf} – 1]$" src="form_1490.png"/></p>
<p>The amount of water added to the soil up to the time of ponding is <img class="formulaInl" alt="$t_p r$" src="form_1491.png"/>, or <img class="formulaInl" alt="$z_f (\theta_{inf} – \theta_l)$" src="form_1492.png"/>, where <img class="formulaInl" alt="$\theta_l$" src="form_226.png"/> and <img class="formulaInl" alt="$\theta_{inf}$" src="form_1493.png"/> are respectively the liquid water content of the soil before and after the wetting front has passed. Setting these two equal and solving for <img class="formulaInl" alt="$t_p$" src="form_1489.png"/> results in</p>
<p><img class="formulaInl" alt="$t_p = z_f (\theta_{inf} – \theta_l)/r$" src="form_1494.png"/></p>
<p>In the 100 loop, a check is done for each successive soil layer to compare the infiltration rate in the layer with the rainfall rate. If <img class="formulaInl" alt="$K_{inf} &lt; R$" src="form_1495.png"/>, a test calculation is performed to determine where the depth of the wetting front would theoretically occur at the ponding time <img class="formulaInl" alt="$t_p$" src="form_1489.png"/>. If the calculated value of <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> is less than the depth of the top of the soil layer, <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> is set to the depth of the top of the layer; if <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> falls within the soil layer, that value of <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> is accepted. In both cases, the index LZF is set to the index of the layer, and the flag IFIND, indicating that <img class="formulaInl" alt="$z_f$" src="form_1487.png"/>, has been successfully located, is set to 1. If the infiltration rate in the soil layer is greater than the rainfall rate, <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> is provisionally set to the bottom of the current layer, and LZF to the index of the next layer. IFIND remains zero. If the infiltration rate in the layer is vanishingly small, <img class="formulaInl" alt="$z_f$" src="form_1487.png"/> is set to the depth of the top of the current layer, LZF to the index of the overlying layer, and IFIND to 1.</p>
<p>If LZF is greater than 1, some adjustment to the equation for <img class="formulaInl" alt="$t_p$" src="form_1489.png"/> above is required to account for the fact that the values of <img class="formulaInl" alt="$\theta_{inf}$" src="form_1493.png"/> and <img class="formulaInl" alt="$\theta_l$" src="form_226.png"/> in the layer containing the wetting front may differ from those in the overlying layers. The equation for <img class="formulaInl" alt="$t_p$" src="form_1489.png"/> above can be rewritten as</p>
<p><img class="formulaInl" alt="$t_p = [z_f [\theta_{inf}(z_f) – \theta_l(z_f)] + w_{adj}]/r$" src="form_1496.png"/></p>
<p>where <img class="formulaInl" alt="$w_{adj}$" src="form_1497.png"/> is calculated as</p>
<p><img class="formulaInl" alt="$LZF-1$" src="form_1498.png"/></p>
<p><img class="formulaInl" alt="$w_{adj} = \Sigma[(\theta_{inf. i} – \theta_{l,i} ) – (\theta_{inf} (z_f) – \theta_l (z_f))] \Delta z_{g,w}$" src="form_1499.png"/></p>
<p><img class="formulaInl" alt="$i=1$" src="form_1500.png"/></p>
<p>The adjusting volume WADJ is calculated in loop 200, and the time to ponding TIMPND in loop 250. If TIMPND is greater than the amount of time remaining in the current time step TRMDR, then unsaturated infiltration is deemed to be occurring over the entire time step. In this case, the amount of water infiltrating over the time step is assigned to the first level of the water movement matrix WMOVE and to the accounting variable WADD, and the temperature of the infiltrating water is assigned to the first level of the matrix TMOVE.</p>
<p>In loop 300 WADD is partitioned over the soil profile by comparing in turn the liquid water content of each soil layer with the calculated liquid water content behind the wetting front THLINF, and decrementing WADD layer by layer until a layer is reached in which the remainder of WADD is insufficient to raise the liquid water content to THLINF. If this condition is reached, LZF is set to the index of the soil layer; the depth of the wetting front DZF within the layer, obtained as WADD/(THLINF-THLIQX), is added to the depth of the bottom of the overlying layer to obtain ZF.</p>
<p>In loop 400, the water content in each soil layer J existing above ZF is assigned to the J+1 level of the water movement matrix WMOVE, and the respective water temperatures are assigned to TMOVE.</p>
<p>If TIMPND &lt; TRMDR, the amount of water infiltrating between the start of the time step and TIMPND is again assigned to the first level of the water movement matrix WMOVE, and the temperature of the infiltrating water is assigned to the first level of the matrix TMOVE. The depth DZF of the wetting front within the layer containing it is calculated by subtracting the depth of the bottom of the overlying layer from ZF.</p>
<p>In loop 500, the water content in each soil layer J existing above ZF is assigned to the J+1 level of the water movement matrix WMOVE, and the respective water temperatures are assigned to TMOVE.</p>
<p>Finally, the time remaining in the current time step after the period of unsaturated infiltration is recalculated, and the counter NINF is set to LZF+1.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="WFILL_8f.html">WFILL.f</a></li>
    <li class="footer">Generated on Fri Mar 29 2019 15:25:21 for CLASSIC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
